define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(f,c,g,l){var a=null;var e="4400004401002001";var d="001";var k="002";var n="003";var j="004";var b=1;var i=10;var h=20;function m(){a=this;this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());this.selectCityCode=this.userInfo.areaCode;console.log("-----------selectCityCode:"+this.selectCityCode);this.selectCityName=l.getLocalName();this.isMoney=null;this.ipPassword=null;this.ipPassword_val="";this.selectTypeVal="0";this.orderPageJson={};this.successJson={};this.accepProvinceCode="";this.accepProvinceName="";this.accepCityCode="";this.accepCityName="";this.flatFee=null;this.userNumber=null;this.tollCompanyJSON={};this.tollCompanyArray=new Array();this.billInfo_selectType="001";this.billInfo_selectPaymentName="";this.billInfo_selectPaymentCode="";this.billInfo_stored="";this.billInfo_Month="";this.oldVal=null;this.selectDateInit=false;this.selectDate_arg=null;this.payType="0";this.checkBillCheck=false;this.SDMpayData={};this.productId="0030001";this.userAmountInput=null;this.userAmountInput_val="";this.noPwd=null;this.cashType="1";this.noInputMoney=false;this.deffered=null;this.paymentPlugin=null;this.businessName=""}m.prototype.initApp=function(){config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_SDM;var o=this;goTo(config.page.main,function(){o.btnInit();var p=true;f(".eachBlock").one("click",function(){var s=f(this).data("value");var t="#item"+s;f(this).addClass("eachhover");f(t).trigger("click");if(s=="1"){o.businessName="水费"}else{if(s=="2"){o.businessName="电费"}else{if(s=="3"){o.businessName="天然气"}else{if(s=="4"){o.businessName="煤气"}}}}p=false});var r=null;var q=function(s,u,v){o.goToBillQueries();o.selectTypeVal=s;if(s=="1"){o.businessName="水费"}else{if(s=="2"){o.businessName="电费"}else{if(s=="4"){o.businessName="天然气"}else{if(s=="3"){o.businessName="煤气"}}}}var t=f(v).find("img");if(r!=null){r.attr("src",r.attr("src").replace("_on","_off"))}r=t;t.attr("src",t.attr("src").replace("_off","_on"));if(p){console.log("== hide first page ==");f("#firstPage_id").addClass("firstPagehide");setTimeout(function(){f("#firstPage_id").hide()},800)}o.reCheck()};o.selectType=new c.BlockRadioGroup("brg_amount",null,q);o.itMobile=new c.InputText("mobile","mobile");o.isMoney=new c.InputText("id_money","number",function(s){if(s.replace(/\s/g,"").length==0){o.noPwd=true;o.oldVal=null}else{if(o.quickTranInfo==null||o.quickTranInfo==undefined){o.callQuickTradingQuery()}if(!o.noPwd&&o.IsNeedPassWord(g.yuan2fen(s))){o.noPwd=true}else{if(o.noPwd&&!o.IsNeedPassWord(g.yuan2fen(s))){o.noPwd=false}}}},function(){o.noPwd=true;o.oldVal=null},2)})};m.prototype.reCheck=function(){f("#btn_billInfo_wrap").show();f("#billShow").hide();f("#id_bills_show").html("")};m.prototype.gotoOrder=function(o){l.getRandomServices(function(p){var q=p;if(p.code===config.RES.SUCCESS){a.random=p.randNum}a.getSDMRecharge(o)},false)};m.prototype.queryStart=function(){var o=this;o.defferred=f.Deferred();showDialog()};m.prototype.queryEnd=function(){var o=this;var p={businessName:o.businessName,accountName:"水电煤",accouontValue:o.orderPageJson.customerName,rechargeMoney:o.orderPageJson.amount,rewardMoney:o.orderPageJson.reward,jfyBalance:o.orderPageJson.jfy_amount,tybBalance:o.orderPageJson.tyb_amount,enablePassword:o.noPwd,userInfo:o.userInfo,callback:o.gotoOrder};console.log("pluginParam = "+JSON.stringify(p));o.paymentPlugin=new c.paymentPlugin(p);dismissDialog();goTo(config.page.comfirm,function(){});o.defferred.resolve()};m.prototype.goPayAnimation=function(){console.log("done=========================");f("#order_comfirm").removeClass("backPayAnimation").addClass("goPayAnimation")};m.prototype.gotobuy=function(){var o=this;o.mobile_val=o.itMobile.getToEmptyValue();if(o.mobile_val.length>=1&&o.mobile_val.length<11){Bestpay.Toast.makeText("请输入11位的顾客手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(o.mobile_val.length==11&&!o.itMobile.getInputCheck()){Bestpay.Toast.makeText("您输入的手机号号码段不正确",Bestpay.Toast.LENGTH_SHORT);return}}if(this.orderPageJson.amount.length==0){Bestpay.Toast.makeText("请选择一期账单",Bestpay.Toast.LENGTH_SHORT);return}if(this.noInputMoney&&this.isMoney.getToEmptyValue().length>=1){if(this.isMoney.getToEmptyValue()*1==0){Bestpay.Toast.makeText("预存金额不能输入0，请输入大于0的金额",Bestpay.Toast.LENGTH_SHORT);return}else{if(this.isMoney.getToEmptyValue()*1<this.orderPageJson.amount*1){Bestpay.Toast.makeText("输入的金额不能小于应付金额",Bestpay.Toast.LENGTH_SHORT);return}else{o.orderPageJson.amount=o.isMoney.getToEmptyValue()}}}if(this.orderPageJson.amount*1==0&&this.billInfo_stored+""=="0"){Bestpay.Toast.makeText("应付金额为0时不能提交！",Bestpay.Toast.LENGTH_SHORT);return}o.itJudgeLocalStorage=new c.JudgeLocalStorage();o.itJudgeLocalStorage.checkOrder(o.orderPageJson.customerName,o.orderPageJson.amount*1,l.getCurrentTime(),function(){o.queryStart();var p=o.orderPageJson.amount*1;console.log("total_amount == "+p);o.getCommission(p,null);o.defferred.done(o.goPayAnimation)},o.businessName)};m.prototype.setBottomAblely=function(p){var o=this;var q=f("#btn_buy");if(!!p){console.log("ablezzz");q.removeClass("btn_buyGray").addClass("btn_buyBlue");q.on("click",function(){console.log("gotobuy click!!!");o.gotobuy()})}else{console.log("unablezzz");q.removeClass("btn_buyBlue").addClass("btn_buyGray");q.off("click")}};m.prototype.btnInit=function(){var o=this;this.selectType();console.log("btnInit -------------");document.getElementById("selectArea").onclick=function(){o.accepCityName="";goTo(config.page.selectPage,function(){o.accepProvinceCode="";f("#id_optionsBoxLeft").hide();f("#id_optionsBoxRight").hide();o.getAreaInfo()});if(o.selectCityName!==""){Bestpay.App.setTitle(o.selectCityName)}};document.getElementById("id_selectProBtn").onclick=function(){if(o.accepCityName==""){Bestpay.Toast.makeText("请选择完整的所在地区",Bestpay.Toast.LENGTH_SHORT);return}o.selectCityName=o.accepProvinceName+""+o.accepCityName;o.selectCityCode=o.accepCityCode;o.reCheck();back();o.getPartnerList()};document.getElementById("id_select_data").onclick=function(){if(o.selectDateInit){o.selectData=new c.showDialogClass("showDateChoiceDialog",function(p){o.selectDate_arg=p;f("#id_show_calendar").html(p);o.selectDateInit=false;o.reCheck()})}else{o.selectData=new c.showDialogClass("showDateModifyDialog",function(p){o.selectDate_arg=p;f("#id_show_calendar").html(p);o.reCheck()},o.selectDate_arg)}};document.getElementById("btn_billInfo").onclick=function(){o.checkBillCheck=false;o.billInfo_selectType=f("#id_userNumber").data("spanCode")!=""&&f("#id_userNumber").data("spanCode")==f("#id_userNumber").val()?"002":"001";if(o.userNumber.getToEmptyValue().length==0){Bestpay.Toast.makeText("请输入用户号",Bestpay.Toast.LENGTH_SHORT);return}if(o.billInfo_selectPaymentCode==""||o.billInfo_selectPaymentCode==null){Bestpay.Toast.makeText("请选择城市",Bestpay.Toast.LENGTH_SHORT);return}if(o.selectCityName.indexOf("上海市")>=0){o.userAmountInput_val=o.userAmountInput.getToEmptyValue();if(o.userAmountInput_val.length==0){Bestpay.Toast.makeText("请输入缴费金额!",Bestpay.Toast.LENGTH_SHORT);return}}showDialog(config.MSG.loading);o.getBillInfo()};document.getElementById("btn_buy").onclick=function(){o.gotobuy()}};m.prototype.selectType=function(){var o=this;var r=document.getElementById("brg_Type");var q=f(r).children();for(var p=0;p<q.size();p++){q[p].onclick=function(){o.selectTypeVal=f(this).data("value")+"";console.log("select type :"+o.selectTypeVal);o.selectCityCode=o.userInfo.areaCode;o.selectCityName=l.getLocalName();o.goToBillQueries()}}};m.prototype.goToBillQueries=function(){var p=this;if(p.userNumber==null){var r=function(s){if(!s.length){p.reCheck()}}}var q=function(){p.reCheck()};p.userNumber=new c.InputText("id_userNumber","sanCode",r,q);p.selectCityCode=this.userInfo.areaCode;p.selectCityName=l.getLocalName();p.billInfo_selectPaymentName="";p.billInfo_selectPaymentCode="";p.userAmountInput=new c.InputText("id_userAmount","number",null,null,2);p.userAmountInput.clearValue();f("#id_Area").html("");var o=document.getElementById("id_flatFee");f(o).find(".item-out").html('<div>缴费单位 </div><div class="textIndent box-f1"></div>');p.getPartnerList();f("#id_show_calendar").html(g.getDate_YYYY_MM_DD());p.selectDateInit=true};m.prototype.getPartnerList=function(){var o=this;o.tollCompanyArray=new Array();o.tollCompanyJSON={};o.userNumber.clearValue();if(o.flatFee!=null){o.flatFee.clearDropDownBox()}l.callCPSService({service:config.CPS.SDM_PARTNER_LIST,params:o.partnerListParams(),showLoading:true,success:o.partnerListSuccessCallback})};m.prototype.partnerListParams=function(){var o=this.selectCityCode+"";if(o.length==6&&o.indexOf("310")==0||o.indexOf("110")==0||o.indexOf("120")==0){o=o.substring(0,3)+"100"}else{if(o.length==6){o=o.substring(0,4)+"00"}}var p={accepTareaCode:o,acceptDate:g.getDate_YYYYMMDD()+""+g.getTime_HHMMSS()};p=l.setCPSCommonParams(p);return p};m.prototype.partnerListSuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("查询地市信息失败",o.content,"确定",o.code);return}var r=o.cities;var u=0;if(r.length>0){for(var q=0;q<r.length;q++){var t=r[q].busCode;var p=r[q].paymentName;var s=r[q].paymentCode;if(t==d&&a.selectTypeVal=="1"){a.tollCompanyArray.push(r[q]);a.tollCompanyJSON[p]=s}else{if(t==k&&a.selectTypeVal=="2"){a.tollCompanyArray.push(r[q]);a.tollCompanyJSON[p]=s;if(s+""==e){u++}}else{if(t==n&&a.selectTypeVal=="3"){a.tollCompanyArray.push(r[q]);a.tollCompanyJSON[p]=s}else{if(t==j&&a.selectTypeVal=="4"){a.tollCompanyArray.push(r[q]);a.tollCompanyJSON[p]=s}}}}}}console.log("selectCityCode=="+a.selectCityCode);if(u>0||a.selectCityCode.toString().slice(0,4)=="5201"){f("#id_select_data").show()}else{f("#id_select_data").hide()}a.initBillQueries()};m.prototype.initBillQueries=function(){f("#id_Area").html(this.selectCityName);var o=document.getElementById("id_flatFee");if(a.tollCompanyArray.length>1){o.onclick=function(){goTo(config.page.flatFee);a.flatFee=new c.dropDownBox("id_flatFee_show",this,a.tollCompanyJSON,function(s,q){a.billInfo_selectPaymentCode=s;a.billInfo_selectPaymentName=f(q).html();for(var r=0;r<a.tollCompanyArray.length;r++){if(a.tollCompanyArray[r].paymentCode==s){a.billInfo_stored=a.tollCompanyArray[r].stored}}f(o).find(".item-out").html("<div>"+a.billInfo_selectPaymentName+"</div>");a.reCheck();a.flatFee.clearDropDownBox();back()},function(){a.flatFee.clearDropDownBox();back()})};f(o).find(".btn-down").show();f(o).find(".item-out").html("<div>"+a.tollCompanyArray[0].paymentName+"</div>")}else{if(a.tollCompanyArray.length==1){o.onclick=function(){};f(o).find(".btn-down").hide();f(o).find(".item-out").html('<div>缴费单位</div><div class="textIndent box-f1">'+a.tollCompanyArray[0].paymentName+"</div>")}else{var p="亲，很抱歉!"+this.selectCityName+"的"+config.page.bill_queries.title+"业务暂未开通，敬请期待哟!";Bestpay.Dialog.showAlertTwoBtnDialog("查询地市信息失败",p,"切换城市","取消","",function(q){console.log(q);if(q.toString()=="1"){f("#selectArea").click()}else{if(q.toString()=="2"){back()}}});return}}if(this.selectCityName.indexOf("上海市")>=0){f("#id_userAmount_div").show();f("#id_div_tips_wrap").show()}else{f("#id_userAmount_div").hide();f("#id_div_tips_wrap").hide()}this.userAmountInput_val="";a.billInfo_selectPaymentCode=a.tollCompanyArray[0].paymentCode;a.billInfo_selectPaymentName=a.tollCompanyArray[0].paymentName;a.billInfo_stored=a.tollCompanyArray[0].stored};m.prototype.getBillInfo=function(){var o=this;l.callCPSService({async:false,service:config.CPS.SDM_BILL_QUERY,params:o.billInfoParams(),showLoading:false,success:o.billInfoSuccessCallback})};m.prototype.billInfoParams=function(){var o=this;var p=o.billInfo_selectPaymentCode.substring(6,12);if(o.billInfo_selectPaymentCode==e||o.selectCityCode.toString().slice(0,4)=="5201"){o.billInfo_Month=f("#id_show_calendar").html().replace("-","")}else{o.billInfo_Month=""}var q={acceptAreaCode:p,acceptDate:g.getDate_YYYYMMDD()+""+g.getTime_HHMMSS(),additem1:o.billInfo_selectPaymentCode,additem2:o.userAmountInput_val,billMonth:o.billInfo_Month,orderSeq:l.getOrderSeq,selectType:o.billInfo_selectType,selectValue:o.userNumber.getToEmptyValue()};q=l.setCPSCommonParams(q);return q};m.prototype.billInfoSuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){if(o.code=="006913"){Bestpay.Dialog.showAlertDialog("处理失败","该地市暂不支持水电煤缴费","确定",o.code);return}Bestpay.Dialog.showAlertDialog(config.TITLE.dialog_title,o.content,"确定",o.code);return}a.itMobile.clearValue();a.isMoney.clearValue();a.orderPageJson.paymentName=a.billInfo_selectPaymentName;a.orderPageJson.totalCount=o.totalCount;a.orderPageJson.systemNo=o.systemNo;a.orderPageJson.billStat=o.billStat;if(o.bills.length<=0){var r="没有查到交易记录";var q="091124";Bestpay.Dialog.showAlertDialog("处理失败",r,"确定",q);return}a.orderPageJson.bills=o.bills;a.orderPageJson.customerName=o.bills[0].customerName;a.orderPageJson.billNo=o.bills[0].billNo;var s=o.bills[0].balance;if(s*1>0){a.orderPageJson.balance=g.fen2yuan(s)}else{a.orderPageJson.balance=""}var p=o.billStat+"";if(p=="0"||p=="1"){b=i}else{if(p=="2"||p=="3"){b=h}}a.initConfirm()};m.prototype.getCommission=function(o,p){l.getCommission(config.BUS_TYPE.BUS_TYPE_SDM,config.BUS_CODE.SDM,config.BUS_CODE.SDM,o,function(q){var r=q;if(q.code===config.RES.SUCCESS){r.commission=g.fen2yuan(q.reward)}else{if(q.code===config.CODE.COMMOSSION_ERROR){r.code=config.RES.SUCCESS;r.commission="0.00"}else{r.code=config.RES.UNKNOWN_ERROR;r.content=config.RES.UNKNOWN_ERROR_MSG}}if(p!=null){p(r.commission)}else{a.orderPageJson.reward=r.commission;console.log("SDMpaySelf.userInfo.authenStatus=="+a.userInfo.authenStatus);if(a.userInfo.authenStatus=="A02"){console.log("SDMpaySelf.userInfo.hadEpt  "+a.userInfo.hadEpt);if(a.userInfo.hadEpt==1){a.getFinancialProducts()}else{a.fundAccountBalanceInquiry()}}else{a.fundAccountBalanceInquiry()}}},false)};m.prototype.getAmount=function(){var p="";var o=this.orderPageJson.billStat+"";var s=this.orderPageJson.bills;if(o=="0"||o=="1"){var r=0;for(var q=0;q<s.length;q++){r=r+s[q].billAmount*1+s[q].billDelay*1}p=r}else{if(o=="2"){p=s[0].billAmount*1+s[0].billDelay*1}else{if(o=="3"){p=s[0].billAmount*1+s[0].billDelay*1}}}console.log("酬金查询 总金额:"+p);return p};m.prototype.initConfirm=function(){var p=this;var o=this.orderPageJson.billStat+"";console.log("initConfirm==============");var s=this.orderPageJson.bills;f("#customerName").html(s[0].customerName);f("#number").html(s.length+"个");for(var q=0;q<s.length;q++){s[q].billAmount=g.fen2yuan(s[q].billAmount);s[q].billDelay=g.fen2yuan(s[q].billDelay);s[q].totalAmount=s[q].billAmount*1+s[q].billDelay*1;s[q].index=q}var r=new c.Template();r.template_MoreToOne("id_bills","id_bills_show",s);console.log("template成功");p.setBillStat(o);console.log("dismissDialog");p.setStored();a.callQuickTradingQuery();dismissDialog();f("#btn_billInfo_wrap").hide();f("#billShow").show()};m.prototype.setBillStat=function(p){var o=this;if(p==="0"){o.setBillSelect("default");o.setBillClick(true)}else{if(p==="1"){o.setBillSelect("all");o.setBillClick(false)}else{if(p==="2"){o.setBillSelect("default");o.setBillClick(false)}else{if(p==="3"){o.setBillSelect("none");o.setBillClick(true)}}}}};m.prototype.setBillSelect=function(p){var o=this;console.log("到选择项");if(p==="all"){f(".radio").addClass("radio-on");o.setAllBills()}else{if(p==="none"){f(".radio").removeClass("radio-on");o.orderPageJson.feePayment="";o.orderPageJson.amount=""}else{if(p==="default"){f(".radio").removeClass("radio-on");f(".radio").eq(0).addClass("radio-on");o.setSingleBill(0)}}}console.log("选择成功")};m.prototype.setBillClick=function(q){var o=this;var p;if(q){f(".radio").on("click",function(){if(f(this).hasClass("radio-on")){return}f(".radio").removeClass("radio-on");f(this).addClass("radio-on");p=f(this).data("code");o.setSingleBill(p)})}else{f(".radio").off("click")}};m.prototype.setSingleBill=function(q){var p=this;var s=this.orderPageJson.bills;var q=q*1;console.log("index==="+q);var r=s[q].billMonth;var u=s[q].billAmount;var o=s[q].billDelay;console.log("billAmount=="+u);console.log("billDelay=="+o);var t=u*1+o*1;console.log("totalAmount=="+t);p.orderPageJson.feePayment=r;p.orderPageJson.amount=t;f("#bills_total_amount").html(t.toFixed(2));console.log("feePayment=="+p.orderPageJson.feePayment);console.log("amount=="+p.orderPageJson.amount)};m.prototype.setAllBills=function(){var q=this;var s=this.orderPageJson.bills;var t=0;for(var r=0;r<s.length;r++){t=t+s[r].billAmount*1+s[r].billDelay*1}var p=[];for(var r=0,o=s.length;r<o;r++){p.push(s[r].billMonth)}q.orderPageJson.feePayment=p.join("|");q.orderPageJson.amount=t;console.log("显示多笔一次缴完=="+q.orderPageJson.feePayment);f("#bills_total_amount").html(t.toFixed(2))};m.prototype.setStored=function(){if(this.billInfo_stored+""=="0"){f("#id_money_out").hide();this.noInputMoney=false}else{if(this.orderPageJson.amount*1>0){f("#id_money").attr("placeholder","缴纳金额:请输入")}else{f("#id_money").attr("placeholder","预存金额:请输入")}f("#id_money_out").show();this.noInputMoney=true;this.callQuickTradingQuery()}};m.prototype.callQuickTradingQuery=function(){var o=this;l.callCPSService({async:false,service:config.CPS.QUICK_TRADING_QUERY,params:o.quickTradingQueryParams(),showLoading:true,success:o.quickTradingQuerySuccessCallback})};m.prototype.quickTradingQueryParams=function(){var o={};o=l.setCPSCommonParams(o);return o};m.prototype.quickTradingQuerySuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("处理失败",o.content,"确定",o.code);return}a.quickTranInfo={perAmount:o.perAmount,allamount:o.allamount,alltransaction:o.alltransaction};if(a.IsNeedPassWord(g.yuan2fen(a.orderPageJson.amount))){a.noPwd=true}else{a.noPwd=false}};m.prototype.IsNeedPassWord=function(p){var q=this.quickTranInfo;var o=this;console.log("amount : "+p);console.log("quickTranInfo : "+JSON.stringify(q));if(p*1<=1*q.perAmount&&(p*1+1*q.alltransaction)<=1*q.allamount){console.log("免密");return false}else{console.log("加密");return true}};m.prototype.getFinancialProducts=function(){var o=this;l.callCPSService({service:config.CPS.FINANCIAL_PRODUCTS,params:o.getFinancialProductsParams(),showLoading:false,success:o.getFinancialProductsSuccessCallback})};m.prototype.getFinancialProductsParams=function(){var o=this;var p={};p=l.setCPSCommonParams(p);return p};m.prototype.getFinancialProductsSuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){if(o.code==="018888"){a.fundAccountBalanceInquiry();return}else{Bestpay.Dialog.showAlertDialog("提醒",o.content,"确定",o.code);return}}var q=o.datas;for(var p=0;p<q.length;p++){a.orderPageJson.productId=q[p]["productId"];a.orderPageJson.userId=q[p]["userId"];a.orderPageJson.tyb_amount=g.fen2yuan(q[p]["balance"])}a.fundAccountBalanceInquiry()};m.prototype.fundAccountBalanceInquiry=function(){var o=this;l.callCPSService({service:config.CPS.CCOUNT_BALANCE_QUERY,params:o.fundAccountBalanceInquiryParams(),showLoading:false,success:o.fundAccountBalanceInquirySuccessCallback})};m.prototype.fundAccountBalanceInquiryParams=function(){var o=this;var p={bankMode:o.userInfo.bankMode};p=l.setCPSCommonParams(p);return p};m.prototype.fundAccountBalanceInquirySuccessCallback=function(A){if(A.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",A.content,"确定",A.code);return}console.log("资金账户余额查询 SAcc003出参======="+JSON.stringify(A));var y=A.dayLimit;var p=A.dayTotal;var r=y*1-p*1;var o=A.monthLimit;var u=A.monthTotal;var t=o*1-u*1;var w=A.motherBoard;var v=A.accountItems;for(var s=0;s<v.length;s++){var x=v[s]["acctType"];if(x!=null||x!="null"||x!="undefined"||x!=""){if("0007"==x){var q=v[s].activeBalance;a.orderPageJson.jfy_amount=g.fen2yuan(q);break}}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===a.userInfo.bankMode){var z="";if(y==="0"){z=w}else{if(w>r){z=r}else{z=w}}if(o==="0"){z=w}else{if(w>t){z=t}else{z=w}}a.orderPageJson.jfy_amount=g.fen2yuan(z);console.log("子卡＝＝＝＝SDMpaySelf.orderPageJson['jfy_amount']=="+a.orderPageJson.jfy_amount)}a.queryEnd()};m.prototype.getSDMRecharge=function(p){var o=this;l.callCPSService({async:false,service:config.CPS.SDM_PAY_BILL,params:o.SDMRechargeParams(p),showLoading:true,success:o.SDMRechargeSuccessCallback})};m.prototype.SDMRechargeParams=function(s){var o=this;var p="";if(s!=null&&s!=""){p=s}var r={systemNo:o.orderPageJson.systemNo,orderSeq:l.getOrderSeq(),acceptDate:g.getDate_YYYYMMDD()+""+g.getTime_HHMMSS(),operPassword:Bestpay.Security.encryptPassword(o.userInfo.staffCode,p,o.random),cashOrder:o.orderPageJson.feePayment,cashType:o.cashType,cashNumber:o.orderPageJson.billNo,operUser:o.userInfo.staffCode};var q=o.isMoney.getToEmptyValue();if(o.billInfo_stored=="0"){r.txnAmount=g.yuan2fen(o.orderPageJson.amount)}else{if(o.billInfo_stored=="1"&&q.length>0){r.txnAmount=g.yuan2fen(q)}else{if(o.billInfo_stored=="1"&&q.length==0){r.txnAmount=g.yuan2fen(o.orderPageJson.amount)}}}if(o.userInfo.hadEpt.toString()=="1"){r.costWay=o.paymentPlugin.getPayType();r.productId=o.productId;r.userId=o.orderPageJson.userId}console.log("支付接口 出参 == "+JSON.stringify(r));r=l.setCPSCommonParams(r);return r};m.prototype.SDMRechargeSuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){if(o.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",o.code,function(q){back();a.itJudgeLocalStorage.putLocalValue("","","","")});return}if(o.code=="009002"||o.code=="006751"){a.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.page_float);return}if(o.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,o.content,"确定",o.code,function(q){App.exitCompleteApp();a.itJudgeLocalStorage.putLocalValue("","","","")})}Bestpay.Dialog.showAlertDialog(config.TITLE.dialog_title,o.content,"确定",o.code,function(q){back();a.itJudgeLocalStorage.putLocalValue("","","","")});return}a.itJudgeLocalStorage.putLocalValue("","","","");var p=a.itMobile.getToEmptyValue();if(p.length>0){l.sendSmsCertificate(o.content,p,"")}a.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};m.prototype.getAreaInfo=function(){var o=this;l.callCPSService({async:false,service:config.CPS.COALWATERINFO_QUERY,params:o.areaInfoParams(),showLoading:true,success:o.areaInfoSuccessCallback})};m.prototype.areaInfoParams=function(){var o={areaCode:a.accepProvinceCode,payType:a.selectTypeVal};o=l.setCPSCommonParams(o);return o};m.prototype.areaInfoSuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){Bestpay.Toast.makeText(o.content+"("+o.code+")",Bestpay.Toast.LENGTH_SHORT);return}var q=o.orders;var s="";for(var p=0;p<q.length;p++){var r=q[p];s+='<span data-code="'+r.areaCode+'">'+r.areaName+"</span>"}if(a.accepProvinceCode==""){f("#id_optionsBoxLeft").html(s);f("#id_optionsBoxLeft").show();a.getProvinceCode()}else{f("#id_optionsBoxRight").html(s);f("#id_optionsBoxRight").show();a.getCityCode()}};m.prototype.getProvinceCode=function(){f("#id_optionsBoxLeft span").each(function(){f(this).on("click",function(){a.accepProvinceCode=f(this).data("code");a.accepProvinceName=f(this).html();Bestpay.App.setTitle(a.accepProvinceName);f("#id_optionsBoxLeft .selectSpan").removeClass("selectSpan");f(this).addClass("selectSpan");a.getAreaInfo()})})};m.prototype.getCityCode=function(){var o=this;f("#id_optionsBoxRight span").each(function(){f(this).on("click",function(){a.accepCityCode=f(this).data("code");a.accepCityName=f(this).html();Bestpay.App.setTitle(a.accepProvinceName+a.accepCityName);f("#id_optionsBoxRight .selectSpan").removeClass("selectSpan");f(this).addClass("selectSpan");o.selectCityName=o.accepProvinceName+""+o.accepCityName;o.selectCityCode=o.accepCityCode;o.reCheck();back();o.getPartnerList()})})};return m});