define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(g,d,f,c){var b=null;var a=document;function e(){b=this;this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());console.log("userInfo============="+JSON.stringify(userInfo));this.payType="0";this.random=null;this.itMobile=null;this.phoneNumber=null;this.phoneNumber3G=null;this.random=null;this.Recharge_Money=null;this.other_money=null;this.isInputOther=null;this.actionCode=null;this.quickTranInfo={};this.SPhn004custName="";this.SPhn004amount="";this.ifrefush="";this.ErrorNotice={notice:"未能查询到运营商",tokenLost:"请您重新登陆",errorPwd:"请输入6-12位支付密码",noPwd:"请输入您的支付密码"};this.ErrorPhone=false;this.flow_ErrorPhone=false;this.needPwd=true;this.YYS_FLAG=false;this.phonetrueoffalse=true;this.RECHARGETYPE="";this.BusiCode={TEL_TELECOM:"03010008",TEL_MOBILE_QX:"04010011",TEL_UNICOM_QX:"04010010"};this.orderPageJson={};this.successJson={};this.rechargeAmount=null;this.quickTranInfo=null;this.checkBillCheck=false;this.rechargeData={};this.productId="0030001";this.temrefush=false;this.selectMoney=null;this.defferred=null;this.selectPayType="0";this.selectPhoneMoneyList=null;this.businessName="充话费";this.phone_number=null;this.phone_number_val=null;this.mRechargeFlow="300";this.pecProductCode="";this.deviceInfo=JSON.parse(Bestpay.App.getDeviceInfo());this.clientVersion=this.deviceInfo.clientVersion.replace(/\./g,"")*1;this.systemType=this.deviceInfo.systemType.toLowerCase();this.flow_Data=null;this.ChinaTelecom_Data=[{M:"10M",Y:"2元",V:"10"},{M:"30M",Y:"5元",V:"30"},{M:"60M",Y:"10元",V:"60"},{M:"100M",Y:"10元",V:"100"},{M:"150M",Y:"20元",V:"150"},{M:"200M",Y:"15元",V:"200"},{M:"300M",Y:"30元",V:"300"},{M:"500M",Y:"30元",V:"500"},{M:"1G",Y:"50元",V:"1024"}];this.ChinaMobile_Data=[{M:"10M",Y:"3元",V:"10"},{M:"30M",Y:"5元",V:"30"},{M:"70M",Y:"10元",V:"70"},{M:"500M",Y:"30元",V:"500"},{M:"1G",Y:"50元",V:"1024"},{M:"2G",Y:"70元",V:"2048"},{M:"3G",Y:"100元",V:"3072"},{M:"4G",Y:"130元",V:"4096"},{M:"6G",Y:"180元",V:"6144"}];this.ChinaUnicom_Data=[{M:"20M",Y:"3元",V:"20"},{M:"50M",Y:"6元",V:"50"},{M:"100M",Y:"10元",V:"100"},{M:"200M",Y:"15元",V:"200"},{M:"500M",Y:"30元",V:"500"}];this.GridList=null;this.verify=null;this.actionName=null;this.mTxnAmount=null;this.provinceCode=null}e.prototype.initApp=function(){config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_TEL;var h=this;h.itJudgeLocalStorage=new d.JudgeLocalStorage();goTo(config.page.main,function(){var i=function(o){console.log("ronggang = "+o+" "+o.length);if(o.length>0){h.other_money=o}else{a.getElementById("brg_amount").onclick=h.selectMoney;h.other_money=null}};var n=function(){a.getElementById("brg_amount").onclick=h.selectMoney;h.other_money=null};var k=function(q){if(q.length==11){var o=document.getElementById("Mobile");var p=o.value;o.focus();o.value="";o.value=p;b.phoneNumber=q;g("#contactInfo").html("").hide();g("#loading_phone").show();b.phonetrueoffalse=false;console.log("33333");a.getElementById("brg_amount").onclick=h.selectMoney;b.getMobileNoTrack(q)}else{g("#payName_amount_parent55").hide()}};var j=function(o){g("#payName_amount_parent55").hide();g("#contactInfo").html("").hide();a.getElementById("brg_amount").onclick=h.selectMoney;h.phone_amount.clearValue();g("#selfNet").hide();h.phoneNumber=null;h.other_money=null;if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){if(o==null){NumberKeyBoard.keyNum=""}}};var m=function(q){if(q.length==11){var o=document.getElementById("phone_number");var p=o.value;o.focus();o.value="";o.value=p;g("#contactInfo_g").html("").hide();g("#loading_phone_g").show();b.phoneNumber3G=q;b.getMobileNoTrack(q)}};var l=function(o){g("#contactInfo_g").html("").hide();g("#flowbtn").hide();if(!!h.GridList){g("#flow_list_wrap").html("");g("#tip_change").html("")}if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){if(o==null){NumberKeyBoard.keyNum=""}}};h.phone_amount=new d.InputText("phone_amount","number",i,n);h.itMobile=new d.InputText("Mobile","phone",k,j);h.phone_number=new d.InputText("phone_number","phone",m,l);console.log("clientVersion=="+h.clientVersion);if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){g("#Mobile").on("click",function(){NumberKeyBoard.initPwdId("Mobile",k,j,11,"close");NumberKeyBoard.InitnumKeyboard()});g("#phone_number").click(function(){NumberKeyBoard.initPwdId("phone_number",m,l,11,"close");NumberKeyBoard.InitnumKeyboard()})}h.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};h.btnInit()})};e.prototype.btnInit=function(){var h=this;h.selectType=new d.BlockRadioGroup("select_pay","full_phone",function(i){h.selectPayType=i;if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){NumberKeyBoard.HidenumKeyboard()}if(i=="0"){g("#phone_type").show();g("#flow_type").hide();h.businessName="充话费"}else{g("#phone_type").hide();g("#flow_type").show();h.businessName="充流量"}});h.brgAmount="50";h.selectMoney=function(){var i=this;g("#page_select_money").html("");goTo(config.page.select_money);h.phoneRechareDiaLog=new d.dropDownBox("page_select_money",this,h.selectPhoneMoneyList,function(j,k){h.phoneRechareDiaLog.clearDropDownBox();if(j=="0"){g("#select_amount_list").hide();g("#phone_amount").show();back();h.isInputOther=true;i.onclick=null;return}h.isInputOther=false;g("#select_amount_list").show();g("#phone_amount").hide();var l=g(k).text();g("#brg_amount_val").html(l);h.brgAmount=j;back()},function(){back()})};a.getElementById("brg_amount").onclick=h.selectMoney;document.getElementById("btn_next_g").onclick=function(){h.checkBillCheck=false;h.validation()};document.getElementById("btn_next").onclick=function(){if(b.phonetrueoffalse==true){h.checkBillCheck=false;h.temrefush=false;h.verdify()}}};e.prototype.getMobileNoTrack=function(i){var h=this;g("#flow_list_wrap").html("");if(h.selectPayType=="0"){g("#Mobile").attr("readonly",true)}else{g("#phone_number").attr("readonly",true)}if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){NumberKeyBoard.HidenumKeyboard()}c.callCPSService({service:config.CPS.PHONE_AREA,params:h.mobileNoTrackParams(),showLoading:false,isNoSuccess:h.rmobileNoTrackisNoSuccessCallback,setTime:600000,success:h.rmobileNoTrackSuccessCallback,error:h.mobileNoTrackErrorCallback})};e.prototype.mobileNoTrackParams=function(){var h=this;var i={type:"50",isQryUserInfo:"Y"};if(h.selectPayType=="0"){i.phone=h.phoneNumber}else{i.phone=h.phoneNumber3G}i=c.setCPSCommonParams(i);console.log("手机归属地查询 SPhn004入参======="+JSON.stringify(i));return i};e.prototype.rmobileNoTrackisNoSuccessCallback=function(h){if(b.selectPayType=="0"){g("#loading_phone").hide();g("#Mobile").attr("readonly",false)}else{g("#loading_phone_g").hide();g("#phone_number").attr("readonly",false)}};e.prototype.rmobileNoTrackSuccessCallback=function(k){console.log("手机归属地查询 SPhn004出参========"+JSON.stringify(k));g("#loading_phone").hide();g("#loading_phone_g").hide();g("#payName_parent_img").attr("src","../lib/img/ic_refresh2.png");g("#payamout_parent_img").hide();g("#Mobile").attr("readonly",false);g("#phone_number").attr("readonly",false);if(k.code==="000000"){b.actionName=k.actionName;b.provinceCode=k.actionCode;b.SPhn004custName=k.custName;b.SPhn004amount=k.amount;b.ifrefush=k.ifrefush;b.queryType=k.queryType;if(b.selectPayType=="1"){g("#contactInfo_g").show();if(!b.actionName){g("#contactInfo_g").html(b.ErrorNotice.notice);b.flow_ErrorPhone=false;return}else{g("#contactInfo_g").html(k.provinceName+k.cityName+b.actionName);g("#flowbtn").show();b.flow_ErrorPhone=true;if("1000"===b.provinceCode){b.flow_Data=b.ChinaTelecom_Data;b.orderPageJson.prodCode="00000098";b.orderPageJson.rechargeType_flow=1;g("#tip_change").html("提示 ：<br>1.即时生效，当月结束后失效。<br>2.其中60M、150M、300M自充值之日起90天内有效。")}else{if("3000"===b.provinceCode){b.flow_Data=b.ChinaMobile_Data;b.orderPageJson.prodCode="00000100";b.orderPageJson.rechargeType_flow=2;g("#tip_change").html("提示 ：<br>即时生效，当月结束后失效。")}else{if("2000"===b.provinceCode){b.flow_Data=b.ChinaUnicom_Data;b.orderPageJson.prodCode="00000099";b.orderPageJson.rechargeType_flow=3;g("#tip_change").html("提示 ：<br>即时生效，当月结束后失效。")}}}var i=[];for(var h=0,j=b.flow_Data.length;h<j;h++){i[h]="";i[h]+="<div>"+b.flow_Data[h].M+"</div>";i[h]+='<div class="font14">'+b.flow_Data[h].Y+"</div>"}b.GridList=new d.GridList(i,2);var l=b.GridList.getHTML();document.getElementById("flow_list_wrap").appendChild(l)}}else{g("#contactInfo").show();if(!b.actionName){g("#contactInfo").html(b.ErrorNotice.notice);b.ErrorPhone=false;b.phonetrueoffalse=false}else{g("#contactInfo").html(k.provinceName+k.cityName+b.actionName);b.ErrorPhone=true;b.phonetrueoffalse=true}g("#payName_parent").find("span").html(b.SPhn004custName);g("#payamout_parent").find("span").html(b.SPhn004amount);if(b.SPhn004custName&&b.SPhn004amount&&(b.actionName.indexOf("电信")>0)){g("#payName_amount_parent55").show()}else{g("#payName_amount_parent55").hide()}b.phone_amount.clearValue();console.log("provinceCode=="+b.provinceCode);b.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};if("1000"===b.provinceCode){b.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500","其他金额":"0"};b.phone_amount.clearValue();b.RECHARGETYPE=b.BusiCode.TEL_TELECOM;b.pecProductCode="00000008"}else{if("3000"===b.provinceCode){b.phone_amount.clearValue();b.RECHARGETYPE=b.BusiCode.TEL_MOBILE_QX;b.pecProductCode="00000009";g("#select_amount_list").show();g("#phone_amount").hide()}else{if("2000"===b.provinceCode){b.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};b.phone_amount.clearValue();b.RECHARGETYPE=b.BusiCode.TEL_UNICOM_QX;b.pecProductCode="00000010";g("#select_amount_list").show();g("#phone_amount").hide()}else{b.phone_amount.clearValue();g("#contactInfo").html(b.ErrorNotice.notice);g("#select_amount_list").show();g("#phone_amount").hide();return}}}}}else{g("#loading_phone").hide();g("#loading_phone_g").hide();console.log("ddeeeeeeeeeee");if(b.selectPayType=="0"){g("#contactInfo").show();g("#contactInfo").html(b.ErrorNotice.notice)}else{g("#contactInfo_g").show();g("#contactInfo_g").html(b.ErrorNotice.notice)}}};e.prototype.mobileNoTrackErrorCallback=function(h){if(b.selectPayType=="0"){g("#loading_phone").hide();g("#contactInfo").show();g("#contactInfo").html(b.ErrorNotice.notice);g("#Mobile").attr("readonly",false)}else{g("#loading_phone_g").hide();g("#contactInfo_g").show();g("#contactInfo_g").html(b.ErrorNotice.notice);g("#phone_number").attr("readonly",false)}};e.prototype.alertDoubleBtn=function(h,n,m,k,j,l,i,o){document.getElementById(h).style.display="block";document.getElementById(n).innerHTML=j;document.getElementById(m).innerHTML=l;document.getElementById(m).onclick=function(){i()};document.getElementById(k).onclick=function(){o()}};e.prototype.back1=function(){Bestpay.User.login()};e.prototype.back2=function(){Bestpay.App.exitCompleteApp()};e.prototype.verdify=function(){var j=this;var h=null;var i=j.itMobile.getToEmptyValue();console.log("phoneRechareSelf.ErrorPhone==========================="+b.ErrorPhone);if(i==null||i.length==0){Bestpay.Toast.makeText("请输入手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(i.length>=1&&i.length<11){Bestpay.Toast.makeText("您输入的手机号码长度错误",Bestpay.Toast.LENGTH_SHORT);return}else{if(!b.ErrorPhone){Bestpay.Toast.makeText("请输入正确的手机号码",Bestpay.Toast.LENGTH_SHORT);return}}}j.Recharge_Money=j.brgAmount;if(j.isInputOther==true&&j.phone_amount.getToEmptyValue().length==0){Bestpay.Toast.makeText("请输入5—500元的整数充值金额",Bestpay.Toast.LENGTH_SHORT);return}if(j.other_money&&g("#phone_amount").val().length>0){if(j.other_money<5||j.other_money>500){Bestpay.Toast.makeText("请输入5—500元的整数充值金额",Bestpay.Toast.LENGTH_SHORT);return}j.Recharge_Money=j.other_money}j.itJudgeLocalStorage.checkOrder(j.itMobile.getToEmptyValue(),j.Recharge_Money,c.getCurrentTime(),function(){console.log("123moblie = "+i);console.log("123self.Recharge_Money = "+j.Recharge_Money);console.log("123self.getCurrentTime  = "+c.getCurrentTime());if(j.RECHARGETYPE==j.BusiCode.TEL_TELECOM){j.actionCode=j.BusiCode.TEL_TELECOM}else{j.actionCode=j.phoneNumber}j.getPremium()},j.businessName)};e.prototype.getPremium=function(){var h=this;c.callCPSService({service:config.CPS.PREMIUM_QUERY,params:h.getPremiumQueryParams(),showLoading:false,success:h.getPremiumQuerySuccessCallback})};e.prototype.getPremiumQueryParams=function(){var h=this;var i={actionCode:h.actionCode,faceAmount:f.yuan2fen(h.Recharge_Money),phone:h.phoneNumber,prodCode:"003"};i=c.setCPSCommonParams(i);console.log("溢价查询"+JSON.stringify(i));return i};e.prototype.getPremiumQuerySuccessCallback=function(h){console.log("溢价查询回调----------------->"+JSON.stringify(h));if("000000"==h.code){var i=h.amount;var j=h.concession;b.rechargeAmount=i*1+j*1;console.log("rechargeAmount------------->"+b.rechargeAmount);b.queryStart();b.callQuickTradingQuery();b.defferred.done(b.goPayAnimation)}else{if(config.RES.TOKEN_DISABLE==h.code){dismissDialog();b.alertDoubleBtn("ch_alert","chalertmsg","chAlertBtn","chAlertBackBtn1",b.ErrorNotice.tokenLost,"确定",b.back1,b.back2);return}else{dismissDialog();Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){App.exitApp()})}}};e.prototype.callQuickTradingQuery=function(){var h=this;c.callCPSService({service:config.CPS.QUICK_TRADING_QUERY,params:h.quickTradingQueryParams(),showLoading:false,success:h.quickTradingQuerySuccessCallback})};e.prototype.quickTradingQueryParams=function(){var h=this;h.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());var i={};i=c.setCPSCommonParams(i);console.log("免密交易查询接口入参"+JSON.stringify(i));return i};e.prototype.quickTradingQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}console.log("免密交易查询接口出参"+JSON.stringify(h));b.quickTranInfo={perAmount:h.perAmount,allAmount:h.allamount,allTransAction:h.alltransaction};b.handleIsneedpassword()};e.prototype.handleIsneedpassword=function(){var j=this;var i=j.quickTranInfo;var h=f.yuan2fen(j.Recharge_Money);console.log("amount : "+h);console.log("quickTranInfo : "+JSON.stringify(i));if(h*1<=1*i.perAmount&&(h*1+1*i.allTransAction)<=1*i.allAmount){b.noPwd=false}else{b.noPwd=true}b.getCommission()};e.prototype.getCommission=function(){var j=this;var h="";var i="";var k="";if(j.selectPayType=="1"){if(j.verify==1){k="03010020";h="0042";j.pecProductCode="00000033"}else{k="01010165";if(j.verify==4){h="001250";j.pecProductCode="00000098"}else{if(j.verify==5){h="001251";j.pecProductCode="00000099"}else{if(j.verify==6){h="001252";j.pecProductCode="00000100"}}}}i=j.phone_number.getToEmptyValue()}else{if(j.RECHARGETYPE==j.BusiCode.TEL_TELECOM){h=j.BusiCode.TEL_TELECOM}else{h=j.phoneNumber}k=j.RECHARGETYPE;i=j.phoneNumber}console.log("---酬金查询---");c.getCommission(config.BUS_TYPE.BUS_TYPE_TEL,k,h,j.Recharge_Money,function(l){var m=l;if(l.code===config.RES.SUCCESS){m.commission=f.fen2yuan(l.reward)}else{if(l.code===config.CODE.COMMOSSION_ERROR){m.code=config.RES.SUCCESS;m.commission="0.00"}else{m.code=config.RES.UNKNOWN_ERROR;m.content=config.RES.UNKNOWN_ERROR_MSG}}j.orderPageJson.reward=m.commission;j.orderPageJson.supplyCode=m.supplyCode;b.orderPageJson.rewardType="reward";if(b.userInfo.authenStatus=="A02"){if(b.userInfo.hadEpt==1){b.getFinancialProducts()}else{b.fundAccountBalanceInquiry()}}else{b.fundAccountBalanceInquiry()}},false,"",b.pecProductCode,i)};e.prototype.SDiscQuery=function(){var h=this;c.callCPSService({service:config.CPS.SDISCQUERY,params:h.SDiscQueryParams(),showLoading:false,success:h.SDiscQuerySuccessCallback})};e.prototype.SDiscQueryParams=function(){var h=this;var i={rechAmount:f.yuan2fen(h.mTxnAmount),pecProduct:h.orderPageJson.prodCode};i=c.setCPSCommonParams(i);console.log("折价查询SDISCQUERY 入参==");return i};e.prototype.SDiscQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}b.orderPageJson.supplyCode=h.supplyCode;b.orderPageJson.reward=f.fen2yuan(h.discAmount);b.orderPageJson.rewardType="zhejia";if(b.userInfo.authenStatus=="A02"){if(b.userInfo.hadEpt==1){b.getFinancialProducts()}else{b.fundAccountBalanceInquiry()}}else{b.fundAccountBalanceInquiry()}};e.prototype.getFinancialProducts=function(){var h=this;c.callCPSService({service:config.CPS.FINANCIAL_PRODUCTS,params:h.getFinancialProductsParams(),showLoading:false,success:h.getFinancialProductsSuccessCallback})};e.prototype.getFinancialProductsParams=function(){var h=this;var i={};i=c.setCPSCommonParams(i);return i};e.prototype.getFinancialProductsSuccessCallback=function(j){console.log("012进来-------------");if(j.code!==config.RES.SUCCESS){if(j.code==="018888"){b.fundAccountBalanceInquiry();return}else{Bestpay.Dialog.showAlertDialog("提醒",j.content,"确定",j.code);return}}console.log("012成功 show  bbb");g("#payfortianyibao").show();console.log("企业理财用户理财产品列表 出参==="+JSON.stringify(j));var i=j.datas;for(var h=0;h<i.length;h++){b.orderPageJson.productId=i[h]["productId"];b.orderPageJson.userId=i[h]["userId"];b.orderPageJson.tyb_amount=f.fen2yuan(i[h]["balance"])}b.fundAccountBalanceInquiry()};e.prototype.fundAccountBalanceInquiry=function(){var h=this;c.callCPSService({service:config.CPS.CCOUNT_BALANCE_QUERY,params:h.fundAccountBalanceInquiryParams(),showLoading:false,success:h.fundAccountBalanceInquirySuccessCallback})};e.prototype.fundAccountBalanceInquiryParams=function(){var h=this;var i={bankMode:h.userInfo.bankMode};i=c.setCPSCommonParams(i);console.log("资金账户余额查询 SAcc003入参======="+JSON.stringify(i));return i};e.prototype.fundAccountBalanceInquirySuccessCallback=function(o){if(o.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",o.content,"确定",o.code);return}console.log("资金账户余额查询 SAcc003出参======="+JSON.stringify(o));var h=o.dayLimit;var s=o.dayTotal;var i=h*1-s*1;var r=o.monthLimit;var l=o.monthTotal;var k=r*1-l*1;var p=o.motherBoard;var n=o.accountItems;for(var j=0;j<n.length;j++){var q=n[j]["acctType"];if(q!=null||q!="null"||q!="undefined"||q!=""){if("0007"==q){var t=n[j].activeBalance;b.orderPageJson.jfy_amount=f.fen2yuan(t);console.log("普通卡＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+b.orderPageJson.jfy_amount);break}}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===b.userInfo.bankMode){var m="";if(h==="0"){m=p}else{if(p>i){m=i}else{m=p}}if(r==="0"){m=p}else{if(p>k){m=k}else{m=p}}b.orderPageJson.jfy_amount=f.fen2yuan(m);console.log("子卡＝＝＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+b.orderPageJson.jfy_amount)}console.log("啊＝＝＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+b.orderPageJson.jfy_amount);if(b.selectPayType=="0"){b.initConfirm();b.queryEnd()}else{b.getVerifyResp()}};e.prototype.queryStart=function(){var h=this;h.defferred=g.Deferred();showDialog(config.MSG.loading)};e.prototype.queryEnd=function(){var h=this;console.log(JSON.stringify(h.orderPageJson));var i={businessName:h.businessName,accountName:"手机充值",accouontValue:h.orderPageJson.phone,rechargeMoney:h.orderPageJson.rechargeMoney,rewardType:h.orderPageJson.rewardType,rewardMoney:h.orderPageJson.reward,jfyBalance:h.orderPageJson.jfy_amount,tybBalance:h.orderPageJson.tyb_amount,enablePassword:h.noPwd,userInfo:h.userInfo,callback:h.gotoOrder};console.log("pluginParam = "+JSON.stringify(i));h.paymentPlugin=new d.paymentPlugin(i);dismissDialog();goTo(config.page.comfirm,function(){});h.defferred.resolve()};e.prototype.goPayAnimation=function(){console.log("done=========================");g("#order_comfirm").removeClass("backPayAnimation").addClass("goPayAnimation")};e.prototype.initConfirm=function(){var k=this;console.log("订单页面初始化");k.orderPageJson.phone=k.itMobile.getValue();var i=k.SPhn004custName;var l=k.SPhn004amount;var h=k.ifrefush;var j=k.queryType;console.log("custName=="+i);console.log("amount=="+l);k.orderPageJson.name=k.SPhn004custName;k.orderPageJson.bill=k.SPhn004amount;if(k.selectPayType=="0"){k.orderPageJson.rechargeMoney=(k.Recharge_Money*1).toFixed(2)}else{console.log("订单页面初始化");k.orderPageJson.phone_number=k.phone_number.getToEmptyValue();k.orderPageJson.phone=k.phone_number.getValue();var i=k.SPhn004custName;var l=k.SPhn004amount;var h=k.ifrefush;var j=k.queryType;k.orderPageJson.rechargeMoney=(k.mTxnAmount*1).toFixed(2)}k.orderPageJson.gather=(k.rechargeAmount/100).toFixed(2)};e.prototype.gotoOrder=function(i){var h=this;c.getRandomServices(function(j){var k=j;if(j.code===config.RES.SUCCESS){b.random=j.randNum}if(b.selectPayType=="0"){b.rechargeResp(i)}else{if(b.selectPayType=="1"){console.log("verify================="+b.verify);if(b.verify>=4){b.flowRecharge(i)}else{b.rechargeResp_g(i)}}}},false)};e.prototype.rechargeResp=function(i){var h=this;c.callCPSService({service:config.CPS.PHONE_CHARGE,params:h.rechargeParams(i),showLoading:true,success:h.rechargeSuccessCallback,error:h.rechargeErrorCallback})};e.prototype.rechargeParams=function(i){var j=this;var k="";if(i!=null&&i!=""){k=i}var h={payPassword:Bestpay.Security.encryptPassword(j.userInfo.staffCode,k,j.random),phone:j.phoneNumber,rechargeAmount:f.yuan2fen(j.Recharge_Money),rechargeType:j.RECHARGETYPE,tradeTime:f.getDate_YYYYMMDD()+""+f.getTime_HHMMSS(),txnAmount:j.rechargeAmount,supplyCode:j.orderPageJson.supplyCode};if(b.userInfo.hadEpt==1){h.costWay=j.paymentPlugin.getPayType();h.productId=j.productId;h.userId=j.orderPageJson.userId;console.log("self.orderPageJson['userId']"+j.orderPageJson.userId)}h=c.setCPSCommonParams(h);console.log("千行手机充值接口 入参======="+JSON.stringify(h));return h};e.prototype.rechargeSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back()});return}if(h.code=="009002"||h.code=="006751"){b.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(config.ResultMSG[h.code]!=null){Bestpay.Dialog.showAlertDialog("处理失败",config.ResultMSG[h.code],"确定",h.code,function(){back()});return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp()})}else{Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back()})}return}if(b.phoneNumber.length>0){c.sendSmsCertificate(h.transSeq,b.phoneNumber,"")}b.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);console.log("phoneRechareSelf.payType=="+b.payType);if(b.payType=="1"){console.log("tianyibao pay ABC");App.updateTybRereshFlag();console.log("tianyibao pay ABC222")}config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};e.prototype.rechargeErrorCallback=function(h){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","账号余额不足","确定",config.RES.MONEY_NOT_ENOUGH,function(){back()});return}};e.prototype.validation=function(){var k=this;var j=this.phone_number.getToEmptyValue();var i=f.getPhoneOperators(j);console.log("phone_val=="+j);if(j.length==0){Bestpay.Toast.makeText("手机号不能为空！",Bestpay.Toast.LENGTH_SHORT);return}else{if(j.length>0&&(j.length<11||j.length>11)){Bestpay.Toast.makeText("您输入的手机号码长度错误！",Bestpay.Toast.LENGTH_SHORT);return}else{if(!b.flow_ErrorPhone){Bestpay.Toast.makeText("请输入正确的手机号码",Bestpay.Toast.LENGTH_SHORT);return}}}var h=k.GridList.getIndex();if("1000"===k.provinceCode){if(h=="2"||h=="4"||h=="6"){k.verify=1}else{k.verify=4}}else{if("3000"===k.provinceCode){k.verify=6}else{if("2000"===k.provinceCode){k.verify=5}}}console.log("index========"+h);console.log("provinceCode========"+k.provinceCode);console.log("verify========"+k.verify);k.mTxnAmount=(k.flow_Data[h].Y).replace("元","");k.Recharge_Money=k.mTxnAmount;k.itJudgeLocalStorage.checkOrder(j,k.Recharge_Money,c.getCurrentTime(),function(){k.queryStart();k.callQuickTradingQuery();b.defferred.done(b.goPayAnimation)},k.businessName)};e.prototype.getVerifyResp=function(){var h=this;c.callCPSService({service:config.CPS.RECHARE_ACCOUNT_VERIFY,params:h.getVerifyRespParams(),showLoading:false,success:h.getVerifyRespSuccessCallback})};e.prototype.getVerifyRespParams=function(){var h=this;var i={verify:h.verify,acctCode:this.phone_number.getToEmptyValue(),reamount:f.yuan2fen(this.mTxnAmount),acceptDate:f.getDate_YYYYMMDD(),acceptTime:f.getTime_HHMMSS()};i=c.setCPSCommonParams(i);console.log("账号验证 入参======="+JSON.stringify(i));return i};e.prototype.getVerifyRespSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog(config.TITLE.dialog_title,h.content,"确定",h.code);return}var i=b.GridList.getIndex();b.orderPageJson.content=h.content;b.orderPageJson.systemNo=h.systemNo;b.orderPageJson.tradeSeq=h.tradeSeq;b.orderPageJson.flag=h.flag;b.orderPageJson.custName=h.custName;b.orderPageJson.amount=h.amount;b.orderPageJson.queryType=h.queryType;b.orderPageJson.flow=b.flow_Data[i].V;b.orderPageJson.mTxnAmount=(b.mTxnAmount*1).toFixed(2);b.orderPageJson.phone_number=b.phone_number.getToEmptyValue();b.initConfirm();b.queryEnd()};e.prototype.rechargeResp_g=function(i){var h=this;c.callCPSService({service:config.CPS.FLOW_3G_CARD,params:h.rechargeParams_g(i),showLoading:true,success:h.rechargeSuccessCallback_g})};e.prototype.rechargeParams_g=function(i){var j=this;var k="";if(i!=null&&i!=""){k=i}var h={orderNo:c.getOrderSeq(),phone:j.orderPageJson.phone_number,rechargeFlow:j.orderPageJson.flow,rechargeType:"001",verify:"01",payPassword:Bestpay.Security.encryptPassword(j.userInfo.staffCode,k,j.random),systemNO:j.orderPageJson.systemNo,tradeTime:f.getDate_YYYYMMDD()+""+f.getTime_HHMMSS(),txnAmount:f.yuan2fen(j.orderPageJson.mTxnAmount)};if(j.userInfo.hadEpt.toString()=="1"){h.costWay=j.paymentPlugin.getPayType();h.productId=j.productId;h.userId=j.orderPageJson.userId}h=c.setCPSCommonParams(h);return h};e.prototype.rechargeSuccessCallback_g=function(h){if(h.code!==config.RES.SUCCESS){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){b.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp();b.itJudgeLocalStorage.putLocalValue("","","","")})}Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}b.itJudgeLocalStorage.putLocalValue("","","","");c.sendSmsCertificate(h.transSeq,b.orderPageJson.phone_number,"");b.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};e.prototype.flowRecharge=function(i){var h=this;c.callCPSService({service:config.CPS.FLOW_RECHARGE,params:h.flowRechargeParams(i),showLoading:true,success:h.flowRechargeSuccessCallback})};e.prototype.flowRechargeParams=function(i){var j=this;var k="";if(i!=null&&i!=""){k=i}var h={orderNo:c.getOrderSeq(),phone:j.orderPageJson.phone_number,rechargeFlow:j.orderPageJson.flow,rechargeType:j.orderPageJson.rechargeType_flow,payPassword:Bestpay.Security.encryptPassword(j.userInfo.staffCode,k,j.random),systemNO:j.orderPageJson.systemNo,tradeTime:f.getDate_YYYYMMDD()+""+f.getTime_HHMMSS(),txnAmount:f.yuan2fen(j.orderPageJson.mTxnAmount),prodCode:j.orderPageJson.prodCode,actionCode:"01010165",supplyCode:j.orderPageJson.supplyCode};if(j.userInfo.hadEpt.toString()=="1"){h.costWay=j.paymentPlugin.getPayType();h.productId=j.productId;h.userId=j.orderPageJson.userId}h=c.setCPSCommonParams(h);return h};e.prototype.flowRechargeSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){b.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp();b.itJudgeLocalStorage.putLocalValue("","","","")})}Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}b.itJudgeLocalStorage.putLocalValue("","","","");c.sendSmsCertificate(h.transSeq,b.orderPageJson.phone_number,"");b.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};return e});