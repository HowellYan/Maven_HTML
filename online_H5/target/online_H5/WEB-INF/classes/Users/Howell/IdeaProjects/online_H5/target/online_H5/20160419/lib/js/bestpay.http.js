define(["bestpay.lang"],function(e){var f=function(){var x=Math.round(Math.random()*8999+1000)+"";var w=Math.round(Math.random()*89999+10000);var y=Math.round(Math.random()*89+10);return"20"+x+h()+""+w+""+y};var i=function(){var y="";var z=new Date();var w=z.getFullYear();var A=z.getMonth()+1;A=A<10?"0"+A:A;var D=z.getDate()<10?"0"+z.getDate():z.getDate();var B=z.getHours()<10?"0"+z.getHours():z.getHours();var C=z.getMinutes()<10?"0"+z.getMinutes():z.getMinutes();var x=z.getSeconds()<10?"0"+z.getSeconds():z.getSeconds();var E=Math.round(Math.random()*8999+1000);y=w+""+A+""+D+""+B+""+C+""+x+""+E;return y};var h=function(){var y="";var z=new Date();var w=z.getFullYear();var A=z.getMonth()+1;A=A<10?"0"+A:A;var D=z.getDate()<10?"0"+z.getDate():z.getDate();var B=z.getHours()<10?"0"+z.getHours():z.getHours();var C=z.getMinutes()<10?"0"+z.getMinutes():z.getMinutes();var x=z.getSeconds()<10?"0"+z.getSeconds():z.getSeconds();var E=Math.round(Math.random()*899+100);y=w+""+A+""+D+""+B+""+C+""+x+""+E;return y};var o=function(){var y="";var z=new Date();var w=z.getFullYear();var A=z.getMonth()+1;A=A<10?"0"+A:A;var D=z.getDate()<10?"0"+z.getDate():z.getDate();var B=z.getHours()<10?"0"+z.getHours():z.getHours();var C=z.getMinutes()<10?"0"+z.getMinutes():z.getMinutes();var x=z.getSeconds()<10?"0"+z.getSeconds():z.getSeconds();var E=Math.round(Math.random()*899+100);y=w+""+A+""+D+""+B+""+C+""+x;return y};var l=function(){var w=config.TMNNUM[config.ENV];if(typeof w!=="string"){w=config.TMNNUM.DEFAULT}return w};var q=function(){var w=config.MERID[config.ENV];if(typeof tmnNum!=="string"){w=config.MERID.DEFAULT}return w};var g=function(){var w=Bestpay.User.getLocation();var D,C=w.substring(0,2)+"0000",x=w.substring(0,4)+"00";var A=Bestpay.DB_Data.getActionCode("getProvinceData",null);for(var y=0;y<A.length;y++){if(A[y].code==C){D=A[y].name}}var z={code:C};var B=Bestpay.DB_Data.getActionCode("getCityData()",JSON.stringify(z));for(var y=0;y<B.length;y++){if(B[y].code==x){D+=B[y].name}}return D};var s=function(y){var w=JSON.parse(Bestpay.User.getSuccessLoginInfo());y.custCode=w.custCode;y.merId=w.prtnCode;y.tmnNum=l();y.staffCode=w.staffCode;y.bisChannel=config.bisChannel;y.keep=f();y.channelCode=config.AppIdentity.CHANNEL_CODE;var x=JSON.parse(Bestpay.App.getDeviceInfo());console.log(JSON.stringify(x));y.clientVersion=x.clientVersion;y.imei=x.imei;y.imsi=x.imsi;y.model=x.model;y.systemType=x.systemType;y.systemVersion=x.systemVersion;y.vender=x.vender;y.operationCode=x.operationCode;y.isSucc=x.isSucc;y.operCity=x.operCity;y.prmotePort=x.prmotePort;y.deviceName=x.deviceName;y.mac=x.mac;y.kernelVersion=x.kernelVersion;y.aidentifier=x.aidentifier;y.bestpayId=x.bestpayId;y.cpuId=x.cpuId;y.diskInfo=x.diskInfo;y.softwareType=config.softwareType;y.signType=config.signType;y.sign=Bestpay.Security.getSign(y);y.signVer=config.signVer;return y};var p=function(A,E,w,D,x,z,F,B,G){var y=this;D=D+"";if(y.userInfo===config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD){return{code:config.RES.SUCCESS,content:config.RES.SUCCESS_MSG,COMMISSION:"0"}}var C={};C.pecProductCode=B||"";C.actionCode=E;C.acctType=config.ACCOUNT_TYPE.KEY_ACCOUNT_IPOS;C.supplyCode=F||"";C.objCode=G||"";if(A===config.BUS_TYPE.BUS_TYPE_BESTPAY_CARD){if("10"===D){w="05010100"}else{if("20"===D){w="05010200"}else{if("30"===D){w="05010300"}else{if("50"===D){w="05010500"}else{if("100"===D){w="05011100"}else{if("200"===D){w="05011200"}else{if("300"===D){w="05011300"}else{if("500"===D){w="05011500"}}}}}}}}}else{if(A===config.BUS_TYPE.BUS_TYPE_GAME_CARD){if("10"===D){w="04020100"}else{if("30"===D){w="04020300"}else{if("50"===D){w="04020500"}else{if("100"===D){w="04021100"}}}}}else{if(A===config.BUS_TYPE.BUS_TYPE_TEL_CARD_TELECOM){if("30"===D){w="01000300"}else{if("50"===D){w="01020500"}else{if("100"===D){w="01021100"}}}}else{if(A===config.BUS_TYPE.BUS_TYPE_TEL_CARD_UNICOM){if("30"===D){w="03200300"}else{if("50"===D){w="03200500"}else{if("100"===D){w="03201100"}}}}else{if(A===config.BUS_TYPE.BUS_TYPE_QQ){console.log("")}}}}}C.productCode=w;C.amount=e.yuan2fen(D);C=s(C);if(z==null){z=true}b({service:config.CPS.COMMISSION_QUERY,params:C,showLoading:z,success:x})};var r=function(z,w){var y={};y.channelCode=config.AppIdentity.CHANNEL_CODE;y.keep=f();y.tmnNum=l();var x=JSON.parse(Bestpay.App.getDeviceInfo());y.clientVersion=x.clientVersion;y.imei=x.imei;y.imsi=x.imsi;y.model=x.model;y.systemType=x.systemType;y.systemVersion=x.systemVersion;y.vender=x.vender;y.softwareType=config.softwareType;y.bisChannel=config.bisChannel;b({service:config.CPS.RANDOM_GENERAT,params:y,showLoading:w,success:z})};var m=function(w,A,y){var x={transSeq:w,phone:A,busyType:y,signType:config.signType};x=s(x);var z=function(B){Bestpay.Toast.makeText("交易凭证已发送，请通知顾客查收短信！",Bestpay.Toast.LENGTH_SHORT);console.log("短信交易凭证下发成功")};b({service:config.CPS.SMS_TRADE_VERIFY,params:x,showLoading:false,success:z,error:function(B){console.log("error:"+JSON.stringify(B))}})};var t=function(A,y,w,z,B){var x={actionCode:y,faceAmount:A,prodCode:w};x=s(x);b({service:config.CPS.PREMIUM_QUERY,params:x,showLoading:B,success:z})};var u=function(y,w){var x={};x=s(x);b({service:config.CPS.MERCHANT_STATUS_CHECK,params:x,showLoading:w,success:y})};var v=function(z,w,x){var y={};y=s(y);b({service:config.CPS.FINANCIAL_PRODUCTS,params:y,showLoading:w,success:z,error:x})};var d=function(z,w,x){var y={bankMode:x};y=s(y);b({service:config.CPS.CCOUNT_BALANCE_QUERY,params:y,showLoading:w,success:z})};var k=function(x,z,w){var y={productId:x};y=s(y);b({service:config.CPS.ENTERPRISE_PERSONAL_ACCOUNT_INFO,params:y,showLoading:w,success:z})};var j=function(w){if(typeof w.params==="object"){w.params=JSON.stringify(w.params)}console.log("dummy service: "+w.service);console.log("request: "+w.params);require(["dummy/resp/"+w.service],function(x){dismissDialog();console.log("response: "+JSON.stringify(x));w.success(x)})};var a=function(){var x;var w=location.origin;if(config.ENV==="PRODUCT"){if(config.isOnline==false){w="http://183.63.191.7:9009"}x=w+"/online_h5/pluginRAB"}else{x=w+"/test/20160406/pluginRAB"}return x};var n=function(){var x;var w=location.origin;if(config.ENV==="PRODUCT"){x=w+"/online_h5"}else{x=w+"/web/20151203"}return x};var c=function(y){dismissDialog();var x="";if(y==="reject"){Bestpay.App.setTitle("网络异常");x+='<div class="error651-box">';x+='<div class="error651-box-1">';x+='<strong style="">网络异常</strong><br>';x+="请稍后查看订单状态。";x+="</div>";x+='<div class="error651-box-2">';x+="<strong>温馨提示：</strong><br>";x+="商户请先确认订单状态，避免重复支付。";x+="</div>";x+='<div class="btn2-common-wrap" id="otCheckOrder">';x+="<button>点击查看订单状态</button>";x+="</div>";x+="</div>"}else{if(y==="resolve"){Bestpay.App.setTitle("业务已受理");x+='<div class="error651-box">';x+='<div class="error651-box-1" style="width:200px;height:50px;padding: 0;background: url(../lib/img/recharge_success.png) no-repeat;background-size: 100%;">';x+="</div>";x+='<div class="error651-box-2">';x+="<strong>温馨提示：</strong><br>";x+="商户请先确认订单状态，避免重复支付。";x+="</div>";x+='<div class="btn2-common-wrap" id="otCheckOrder">';x+="<button>点击查看订单状态</button>";x+="</div>";x+="</div>"}}console.log("init------------overtime");var z=document.getElementById("overTimePage");if(!!z){z.innerHTML=x;z.style.display="block"}else{var w=document.createElement("div");w.id="overTimePage";w.innerHTML=x;document.body.insertBefore(w,document.body.childNodes[0])}window.pageStack.push("overTimePage");document.getElementById("otCheckOrder").onclick=function(){Bestpay.Dialog.jumpToOrderQuery(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);window.pageStack.pop();Bestpay.App.setTitle(window.pageStack[window.pageStack.length-1].title);document.getElementById("overTimePage").style.display="none";back()}};config.isOpen=true;var b=function(z){if(z.showLoading!==false){showDialog(config.MSG.loading)}if(!!config.dummy){j(z);return}if(z.setTime==null){z.setTime=75000}if(typeof z.error!=="function"){z.error=function(){dismissDialog();Bestpay.Dialog.showAlertDialog("请求失败",config.MSG.networkFail2,"确定","");console.log("error 请求失败: "+y)}}var C=function(J){if(config.isDialogBack==true){config.isDialogBack=false;return}console.log("response: "+JSON.stringify(J));if(z.showLoading==true){dismissDialog()}config.isOpen=true;if(z.service!=config.noVerifySign[z.service]){var G=Bestpay.Security.verifySign(J);console.log("resultMsg: -> "+G);if(G!=null&&G==="false"){Bestpay.Dialog.showAlertTwoBtnDialog("验签失败","您目前的网络可能存在安全隐患，请修改网络环境，如涉及交易，请联系客服查询订单状态。","重新登录","取消","",function(L){Bestpay.User.login()});return}}if(J.code=="010054"){if(typeof z.isNoSuccess=="function"){z.isNoSuccess(J)}Bestpay.Dialog.showAlertTwoBtnDialog("登录失效","请重新登录","重新登录","取消",J.code,function(L){console.log(L);if(L.toString()=="1"){Bestpay.User.login()}});return}if(J.code=="011007"){if(pageStack!=null&&pageStack!=""&&pageStack[pageStack.length-1].goToRecords!=null&&pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);PasswordKeyBoard.hideKeyboardUI3();var I=JSON.parse(Bestpay.App.getDeviceInfo());var K=I.clientVersion;var H=I.systemType;K=K.replace(/\./g,"")*1;H=H.toLowerCase();if((H==="android"&&K>=329)||(H==="ios"&&K>=305)){console.log("overtime--------------------");c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}}if(J.code=="011142"){var I=JSON.parse(Bestpay.App.getDeviceInfo());var K=I.clientVersion;var H=I.systemType;K=K.replace(/\./g,"")*1;H=H.toLowerCase();console.log("App Version = "+K+" System Type = "+H);if((H==="android"&&K>=403)||(H==="ios"&&K>=402)){console.log("[return code = "+J.code+"] 体验商户自动跳去认证页面");PasswordKeyBoard.hideKeyboardUI3();back();Bestpay.Dialog.jumpToAuthorityDialog();return}else{Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,J.content,"确定",J.code,function(){back()})}}z.success(J)};var w=function(J){config.isOpen=true;PasswordKeyBoard.hideKeyboardUI3();console.log("----error----:"+JSON.stringify(J)+";pageStack:"+pageStack);dismissDialog();if(pageStack!=null&&pageStack!=""&&pageStack[pageStack.length-1].goToRecords!=null&&pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);var I=JSON.parse(Bestpay.App.getDeviceInfo());var G=I.clientVersion;var H=I.systemType;G=G.replace(/\./g,"")*1;H=H.toLowerCase();if((H==="android"&&G>=329)||(H==="ios"&&G>=305)){c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}if(J.readyState==0){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.MSG.networkFail1,"确定","")}z.error(J)};if(typeof z.params==="object"){z.params=JSON.stringify(z.params)}var x="?ran"+Math.floor(Math.random()*100+1)+"="+Date.parse(new Date());var F=config.NGINX_CPS[config.ENV];console.log("-----------ENV:"+config.ENV);if(typeof F!=="string"){F=config.NGINX_CPS.PUBLIC}else{if(z.isINF!==null&&z.isINF==true){F=config.NGINX_INF[config.ENV];if(typeof F!=="string"){F=config.NGINX_INF.PUBLIC}}}if(config.isOnline==false){F=config.URLCPS[config.ENV];if(typeof F!=="string"){F=config.URLCPS.PUBLIC}else{if(z.isINF!==null&&z.isINF==true){F=config.URLINF[config.ENV];if(typeof F!=="string"){F=config.URLINF.PUBLIC}}}}var y=F+z.service+x;if(z.URL!=null){y=z.URL+z.service+x}if(z.async==null){z.async=true}console.log("isOpen: "+config.isOpen);if(config.isOpen==false){return}else{config.isOpen=false}console.log("url: "+y);console.log("request: "+z.params);try{window.jqXHR=$.ajax({url:y,type:"POST",async:z.async,data:z.params,timeout:z.setTime,contentType:"application/json; charset=utf-8",dataType:"json",success:C,error:w})}catch(D){config.isOpen=true;console.error(D.message);z.error(result);if(pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);dismissDialog();var E=JSON.parse(Bestpay.App.getDeviceInfo());var A=E.clientVersion;var B=E.systemType;A=A.replace(/\./g,"")*1;B=B.toLowerCase();if((B==="android"&&A>=329)||(B==="ios"&&A>=305)){c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}dismissDialog();Bestpay.Dialog.showAlertDialog("请求失败",config.MSG.networkFail1,"确定","")}};return{getKeep:f,getTmnNum:l,getMerId:q,getOrderSeq:h,getPremium:t,getLocalName:g,getMerchantStatus:u,getFinancialProducts:v,getAccountBalanceInquiry:d,setCPSCommonParams:s,callCPSService:b,getCommission:p,getRandomServices:r,sendSmsCertificate:m,getRechargeURL:a,overTime:c,getEnvironmentURL:n,getCurrentTime:o}});