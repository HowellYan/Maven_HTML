define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(b,d,a,c){var f=null;function e(){f=this;this.inputPassword=null;this.ipPassword_val=null;this.cardInfoJson={};this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());this.hadEpt=this.userInfo.hadEpt;this.logoList={"866000":"images/bank/yzyh.png","866100":"images/bank/zgyh.png","866200":"images/bank/gsyh.png","866300":"images/bank/nyyh.png","866400":"images/bank/jtyh.png","866500":"images/bank/jsyh.png","866600":"images/bank/msyh.png","866700":"images/bank/hxyh.png","866800":"images/bank/gfyh.png","866900":"images/bank/zsyh.png","867000":"images/bank/gzyh.png","867200":"images/bank/gdyh.png","867400":"images/bank/zxyh.png","867600":"images/bank/xyyh.png","865700":"images/bank/payh.png","865500":"images/bank/shyh.png"}}e.prototype.initApp=function(){var g=this;showDialog(config.MSG.loading);console.log(g.userInfo);this.getBindingCardStatus();document.getElementById("btn_confirm").onclick=function(){if(g.hadEpt=="1"){Bestpay.Dialog.showAlertDialog("提醒","已开通添益宝无法解绑","确定","");return}PasswordKeyBoard.initPwdUI3(function(h){g.confirm(h)});PasswordKeyBoard.popKeyboardUI3()}};e.prototype.getBindingCardStatus=function(){var g=this;c.callCPSService({service:config.CPS.ACCOUNT_BIND_CARD_STATE,params:g.bindingCardStatusParams(),showLoading:false,success:g.bindingCardStatusSuccessCallback})};e.prototype.bindingCardStatusParams=function(){var g={};g=c.setCPSCommonParams(g);return g};e.prototype.bindingCardStatusSuccessCallback=function(g){if(g.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code);return}var h=g.bindStat;if(h=="1"){f.getBankInfoQuery()}else{App.updateUserInfo("0");Bestpay.Dialog.showAlertDialog("提醒","未绑卡","确定","",function(){Bestpay.App.exitApp()})}};e.prototype.getBankInfoQuery=function(){var g=this;c.callCPSService({service:config.CPS.ACCOUNT_BANK_INFO,params:g.bankInfoQueryParams(),showLoading:false,success:g.bankInfoQuerySuccessCallback})};e.prototype.bankInfoQueryParams=function(){var g={};g=c.setCPSCommonParams(g);return g};e.prototype.bankInfoQuerySuccessCallback=function(i){dismissDialog();if(i.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",i.content,"确定",i.code);return}f.cardInfoJson.bankAcctNbr=i.bankAcctNbr;f.cardInfoJson.bankName=i.bankName;f.cardInfoJson.bankCode=i.bankCode;f.cardInfoJson.bankAcctName=i.bankAcctName;f.cardInfoJson.privateflag=i.privateflag;f.cardInfoJson.accId=i.accId;var h=i.bankAcctNbr,g=i.bankAcctName;g="*"+g.substring(1,g.length);f.cardInfoJson.img_src=f.logoList[i.bankCode];f.cardInfoJson.bank_card=h.substr(h.length-4,4);f.cardInfoJson.user_name=g;goTo(config.page.unbund_main,function(){var j=new d.Template();j.template_OneToOne("id_cardInfo",f.cardInfoJson);f.inputPassword=new d.InputText("pwd","password")})};e.prototype.confirm=function(g){this.ipPassword_val=this.inputPassword.getValue();c.getRandomServices(function(h){if(h.code===config.RES.SUCCESS){f.random=h.randNum}f.getUnbund(g)},false)};e.prototype.getUnbund=function(h){var g=this;c.callCPSService({service:config.CPS.ACCOUNT_BANK_UNBUND,params:g.unbundParams(h),showLoading:true,success:g.unbundSuccessCallback})};e.prototype.unbundParams=function(h){var i=this;var g={};g.payPassWord=Bestpay.Security.encryptPassword(i.userInfo.staffCode,h,i.random);g.accId=i.cardInfoJson.accId;g=c.setCPSCommonParams(g);return g};e.prototype.unbundSuccessCallback=function(g){PasswordKeyBoard.hideKeyboardUI3();if(g.code!==config.RES.SUCCESS){if(g.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code,function(){Bestpay.App.exitCompleteApp()})}else{Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code)}return}Bestpay.Dialog.showAlertDialog("提醒","您成功解绑了尾号为"+f.cardInfoJson.bank_card+"的银行卡！","确定","",function(){App.updateUserInfo("0");Bestpay.App.exitApp()})};return e});