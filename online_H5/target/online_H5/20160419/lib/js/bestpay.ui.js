define(["jquery","bestpay.lang","bestpay.http"],function(c,e,k){function f(o,p,r,q,n){this.inputId=o;this.btnClear=null;this.inputText=null;this.divWrap=null;this.value="";this.funcInput=r;this.funcClear=q;this.inputType=p;this.decimal=n;this.init();if(this.inputType=="password"){this.setPassword()}}f.prototype.init=function(){var n=this;n.inputText=document.getElementById(n.inputId);n.divWrap=n.inputText.parentNode.parentNode;n.btnClear=c(n.inputText.parentNode).next()[0];n.setFormat();n.btnClear.addEventListener("click",function(){n.inputText.value="";c(this).hide();if(e.isFunction(n.funcClear)){n.funcClear();console.log(" in lib clear")}});n.inputText.addEventListener("input",function(){if(config.isOpen==false){return}n.setInputType(n.inputText.value,this);n.value=c(this).val().toString();if(c(n.inputText).val().replace(/\s/g,"").length>0){c(n.btnClear).show()}else{c(n.btnClear).hide()}if(e.isFunction(n.funcInput)){n.funcInput(n.value)}},false);c(n.inputText).focus(function(){c(n.inputText).val(c(n.inputText).val().replace(/\s/g,""));n.divWrap.style.borderColor="#93bf53";if(c(n.inputText).val().replace(/\s/g,"").length>0){setTimeout(function(){c(n.btnClear).show()},500)}}).blur(function(){n.divWrap.style.borderColor="#DBDCDC";setTimeout(function(){c(n.btnClear).hide()},500)});if(this.inputType=="phone"){c(n.inputText.parentNode.parentNode).find(".btn-phone").click(function(){Bestpay.Contacts.openContacts(function(p){var o=p.replace(/[^0-9]+/g,"").replace(/\s/g,"");if(o.length!=11){Bestpay.Toast.makeText("请选择正确的手机号",Bestpay.Toast.LENGTH_SHORT);return}n.setValue(o.replace(/(\d{3})(\d{4})/g,"$1 $2 "));n.funcInput(o)},function(o){Bestpay.Dialog.alert(o)})})}if(this.inputType=="sanCode"){c(n.inputText).data("spanCode","");c(n.divWrap).find("div[class=scan-code]").click(function(){Bestpay.Scanner.getBarCode(function(o){c(n.inputText).data("spanCode",JSON.stringify(o).replace(/\"/g,""));c(n.inputText).val(JSON.stringify(o).replace(/\"/g,""));if(c(n.inputText).val().toString().trim()!=""){c(n.btnClear).show()}else{c(n.btnClear).hide()}})})}};f.prototype.getValue=function(){if(this.inputType=="password"){return PasswordKeyBoard.keyStr}return this.inputText.value};f.prototype.getToEmptyValue=function(){if(this.inputType=="password"){return PasswordKeyBoard.keyStr}return this.inputText.value.replace(/\s/g,"")};f.prototype.focus=function(n){if(typeof n=="function"&&n!=null){c(this.inputText).focus(n)}else{c(this.inputText).focus()}};f.prototype.blur=function(n){if(typeof n=="function"&&n!=null){c(this.inputText).blur(n)}else{c(this.inputText).blur()}};f.prototype.setValue=function(n){this.inputText.value=n;c(this.btnClear).show()};f.prototype.clearValue=function(){if(this.inputType=="password"){PasswordKeyBoard.keyStr=""}this.value="";this.inputText.value="";c(this.btnClear).hide()};f.prototype.setPlaceholder=function(n){this.inputText.setAttribute("placeholder",n)};f.prototype.setInputType=function(p,o){var n=this;if(n.inputType==null||n.inputType=="undefined"){return}switch(n.inputType){case"number":if(n.decimal==null||n.decimal==undefined){c(o).val(c(o).val().replace(/[^0-9]+/,""))}else{var q=c(o).val();if(q.indexOf(".")==0||(q.indexOf(".")>0&&(q.split(".").length>2||q.split(".")[1].length>n.decimal*1))){c(o).val(q.substring(0,q.length-1))}if(q.indexOf("0")==0&&q.length>1&&q.indexOf(".")!=1){c(o).val(q.substring(0,q.length-1))}c(o).val(c(o).val().replace(/[^0-9.]+/,""))}break;case"mobile":case"bankCard":case"phone":c(o).val(c(o).val().replace(/[^0-9]+/,""));break;case"IDCard":c(o).val(c(o).val().replace(/[^0-9Xx]+/,""));break;case"AlphaNumeric":c(o).val(c(o).val().replace(/[^0-9a-zA-Z]+/,""));break;case"sanCode":c(o).val(c(o).val().replace(/[^0-9a-zA-Z\.\-]+/,""));break;case"engineNumber":c(o).val(c(o).val().replace(/[^0-9a-zA-Z\_]+/,""));break;default:c(o).val(c(o).val().replace(/[^0-9]+/,""));break}};f.prototype.setFormat=function(){var n=this;if(n.inputType==null||n.inputType=="undefined"){return}var o=c(n.inputText);switch(n.inputType){case"mobile":o.blur(function(){o.val(o.val().replace(/\s/g,"").replace(/(\d{3})(\d{4})/g,"$1 $2 "))});break;case"phone":o.blur(function(){o.val(o.val().replace(/\s/g,"").replace(/(\d{3})(\d{4})/g,"$1 $2 "))});break;case"bankCard":o.blur(function(){o.val(o.val().replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 "))});break}};f.prototype.setPassword=function(){var n=this;PasswordKeyBoard.initPwdId(n.inputId,function(o){if(e.isFunction(n.funcInput)){n.funcInput(o)}if(o.length>0){c(n.btnClear).show()}else{c(n.btnClear).hide()}n.btnClear.onclick=function(){var p=c(this);setTimeout(function(){n.inputText.value=""},300);setTimeout(function(){PasswordKeyBoard.keyStr=""},200);setTimeout(function(){p.hide()},100)}},12);document.getElementById(n.inputId).onclick=function(){PasswordKeyBoard.popPswKeyboard();PasswordKeyBoard.keyInputId=n.inputId}};f.prototype.getInputCheck=function(){var n=this;if(n.inputType==null||n.inputType=="undefined"){return}var o=c(n.inputText).val().replace(/\s/g,"");switch(n.inputType){case"mobile":if(!o.match("^((13[0-9])|(14[5,7,9])|(15[^4,\\D])|(18[0-9])|(17[5-9]))\\d{8}$")){return false}return true;break;case"EMail":if(!o.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$")){return false}return true;break;case"IDCard":if(!o.match("^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}(\\d|x|X)$")){return false}return true;break}};f.prototype.checkInputType=function(){var n=this;if(n.inputType==null||n.inputType=="undefined"){return}};function i(o,n,p){this.groupId=o;this.group=null;this.checkedItem=null;this.allItem=null;this.normalClassName="block-radio-normal";this.checkClassName="block-radio-checked";this.disabledClassName="block-radio-disabled";this.callback=p;this.defaultChecked=n;this.init();if(n!==null&&n!=="undefined"){this.setChecked(n)}}i.prototype.init=function(){var n=this;n.group=document.getElementById(n.groupId);n.allItem=c(n.group).children();for(var o=0;o<n.allItem.size();o++){n.allItem[o].onclick=function(){if(config.isOpen==false){return}n.setChecked(this);if(n.callback!=null&&n.callback!="undefined"){n.callback(c(this).data("value"),o,this)}n.defaultChecked=c(this).attr("id")}}};i.prototype.setChecked=function(o){var n=this;if(typeof o==="string"){o=document.getElementById(o)}if(n.checkedItem===o){return}if(n.checkedItem!==null){c(n.checkedItem).removeClass(n.checkClassName).addClass(n.normalClassName)}c(o).removeClass(n.normalClassName).addClass(n.checkClassName);n.checkedItem=o};i.prototype.setAllNormal=function(){if(this.checkedItem!==null){c(self.checkedItem).removeClass(self.checkClassName).addClass(self.normalClassName)}};i.prototype.getCheckedItem=function(){return this.checkedItem};i.prototype.getCheckedValue=function(){return c(this.checkedItem).data("value")};i.prototype.setDisabled=function(q,p){var n=this;if(q==false){n.init();for(var o=0;o<n.allItem.size();o++){c(n.allItem[o]).removeClass(n.disabledClassName).addClass(n.normalClassName)}c(n.defaultChecked).removeClass(n.normalClassName).addClass(n.checkClassName)}else{if(q==true){n.defaultChecked=n.checkedItem;if(p!=null){for(var o=0;p.length>o;o++){n.allItem[p[o]].onclick=function(){};c(n.allItem[p[o]]).removeClass(n.checkClassName).addClass(n.disabledClassName);c(n.allItem[p[o]]).removeClass(n.normalClassName).addClass(n.disabledClassName)}}else{for(var o=0;o<n.allItem.size();o++){n.allItem[o].onclick=function(){};c(n.allItem[o]).removeClass(n.checkClassName).addClass(n.disabledClassName);c(n.allItem[o]).removeClass(n.normalClassName).addClass(n.disabledClassName)}}}}};function g(){}g.prototype.template_OneToOne=function(p,q){var o=document.getElementById(p);var n=document.getElementById(p+"_show");var r=o.innerHTML.replace(/\$\w+\$/gi,function(t){var s=q[t.replace(/\$/g,"")];return(s+"")=="undefined"?"":s});n.innerHTML=r;window.lib.flexible.refreshRem()};g.prototype.template_MoreToOne=function(o,q,s){var r=document.getElementById(o);var n=document.getElementById(q);for(var p=0;s.length>p;p++){var t=r.innerHTML.replace(/\$\w+\$/gi,function(v){var u=s[p][v.replace(/\$/g,"")];return(u+"")=="undefined"?"":u});n.innerHTML+=t}window.lib.flexible.refreshRem()};function j(t,s,q,n,p,r,o){this.id=t;this.contJson=s;this.titleStr=q;this.btnJson=n;this.type=p;this.dialogClass_bg=null;this.contOutDiv=null;this.callBack=r;this.selectItemObj=o;if(c("#"+this.id).html().replace(/\s/g,"").length==0){this.init()}else{c("#"+this.id).show()}}j.prototype.init=function(){this.thisDom=document.getElementById(this.id);this.dialogClass_bg=document.createElement("div");this.dialogClass_bg.className="dialogClass-bg";var n=this;this.thisDom.appendChild(this.dialogClass_bg);this.contOutDiv=document.createElement("div");if(this.titleStr!=null){this.setTitle()}switch(this.type){case"dialog":this.contOutDiv.className="dialogClass-content";this.setContent();break;case"list":this.contOutDiv.className="dialogClass-list-content box box-ver";this.setListContent();break}if(this.btnJson!=null){this.setButton()}this.thisDom.appendChild(this.contOutDiv)};j.prototype.setTitle=function(){var n=document.createElement("pre");n.className="dialogClass-title";n.innerHTML=this.titleStr;this.contOutDiv.appendChild(n)};j.prototype.setTitlePublic=function(n){c("#"+this.id+" .dialogClass-title").html(n)};j.prototype.setContent=function(){this.itemOutDiv=document.createElement("div");this.itemOutDiv.className="dialogClass-div-item";for(var n in this.contJson){var o=document.createElement("div");o.className="dialogClass-item";o.innerHTML=n+":"+this.contJson[n];this.itemOutDiv.appendChild(o)}this.contOutDiv.appendChild(this.itemOutDiv)};j.prototype.setListContent=function(){var n=this;this.itemOutDiv=document.createElement("div");this.itemOutDiv.className="box-f1 dialogClass-item-out";for(var o in this.contJson){var p=document.createElement("div");p.className="dialogClass-list-item";p.innerHTML=o;p.setAttribute("data-val",n.contJson[o]);var q=document.createElement("div");q.className="dialogClass-list-img-off";if(n.selectItemObj==n.contJson[o]){q.className="dialogClass-list-img-on";n.selectItemObj=p}p.onclick=function(){if(n.selectItemObj!=null){c(n.selectItemObj).find("div").removeClass("dialogClass-list-img-on").addClass("dialogClass-list-img-off")}c(this).find("div").addClass("dialogClass-list-img-on");n.callBack(this.getAttribute("data-val"),this);n.selectItemObj=this};p.appendChild(q);this.itemOutDiv.appendChild(p)}this.contOutDiv.appendChild(this.itemOutDiv)};j.prototype.setButton=function(){var p=document.createElement("div");p.className="box dialogClass-div-btn";for(var o in this.btnJson){var n=document.createElement("div");n.className="box-f1 dialogClass-btn dialogClass-btn-goahead";n.innerHTML=o;n.onclick=this.btnJson[o];p.appendChild(n)}this.itemOutDiv.appendChild(p)};j.prototype.setButtonClass=function(o,n){c(".dialogClass-btn:eq("+[o-1]+")").addClass(n)};j.prototype.setItemClass=function(o,n){c(".dialogClass-item:eq("+[o-1]+")").addClass(n)};j.prototype.clearDialog=function(n){this.thisDom.innerHTML="";if(n!=null&&n!="undefined"){n()}};j.prototype.hideDialog=function(n){c("#"+this.id).hide();if(n!=null&&n!="undefined"){n()}};function m(r,q,p,o,n){this.id=r;this.thisObj=q;this.contJson=p;this.callBack=o;this.funcBoxBG=n;if(this.thisObj!=null){this.boxWidth=c(this.thisObj).width();this.boxHeight=c(this.thisObj).height();this.boxTopHeight=this.thisObj.offsetTop;this.boxLeft=this.thisObj.offsetLeft}c("#"+this.id).html("");this.init()}m.prototype.init=function(){var n=this;this.thisDom=document.getElementById(this.id);this.dropDownBox_bg=document.createElement("div");this.dropDownBox_bg.className="dropDownBox-bg";this.dropDownBox_bg.onclick=function(){n.funcBoxBG()};this.thisDom.appendChild(this.dropDownBox_bg);this.contOutDiv=document.createElement("div");this.contOutDiv.className="dropDownBox-list-content";c(this.contOutDiv).width(this.boxWidth+"px");this.contOutDiv.style.top=(this.boxTopHeight+this.boxHeight+3)+"px";this.contOutDiv.style.left=this.boxLeft+"px";console.log(JSON.stringify(this.contJson));this.setListContent();this.thisDom.appendChild(this.contOutDiv)};m.prototype.setListContent=function(){var n=this;this.itemOutDiv=document.createElement("div");for(var o in this.contJson){var p=document.createElement("div");p.className="dropDownBox-list-item";p.innerHTML=o;p.setAttribute("data-val",n.contJson[o]);p.onclick=function(){n.callBack(this.getAttribute("data-val"),this)};this.itemOutDiv.appendChild(p)}this.contOutDiv.appendChild(this.itemOutDiv)};m.prototype.clearDropDownBox=function(n){this.thisDom.innerHTML="";if(n!=null&&n!="undefined"){n()}};m.prototype.hideDropDownBox=function(n){c("#"+this.id).hide();if(n!=null&&n!="undefined"){n()}};var d=function(o,p,n){this.type=o;this.callBack=p;this.msgJson=n;this.init()};d.prototype.init=function(){var n=this;switch(this.type){case"showDateChoiceDialog":Bestpay.Dialog.showDateChoiceDialog(e.getDate_YYYY_MM_DD(),this.callBack);break;case"showDateModifyDialog":Bestpay.Dialog.showDateChoiceDialog(n.msgJson,this.callBack);break}};function h(o,n){this.htmlArray=o;this.listlength=o.length;this.doc=document;this.index=n;this.fragment=document.createDocumentFragment();this.paintHTML()}h.prototype.paintHTML=function(){var n=this;var p=[];for(var o=0;o<n.listlength;o++){p[o]=document.createElement("div");p[o].setAttribute("data-value",o);if(o==n.index){p[o].className="gridlist gridlist_active"}else{p[o].className="gridlist"}p[o].innerHTML=n.htmlArray[o];p[o].onclick=function(){for(var q=0;q<n.listlength;q++){document.getElementsByClassName("gridlist")[q].className="gridlist"}this.className="gridlist gridlist_active";n.index=this.getAttribute("data-value")};n.fragment.appendChild(p[o])}};h.prototype.getHTML=function(){return this.fragment};h.prototype.getIndex=function(){return this.index};function a(n){this.businessName=n.businessName||"";this.accountName=n.accountName||"";this.accouontValue=n.accouontValue||"0";this.rechargeMoney=n.rechargeMoney||"0";this.rewardType=n.rewardType||"reward";this.rewardMoney=n.rewardMoney||"0";this.jfyBalance=n.jfyBalance;this.tybBalance=n.tybBalance;this.enablePassword=n.enablePassword;this.userInfo=n.userInfo;this.callback=n.callback||function(){};this.payType="1";this.init()}a.prototype.init=function(){var n=this;n.payDetailHTML();n.balanceCheck();n.setRewardClick();n.setPayClick()};a.prototype.payDetailHTML=function(){var n=this;var r=c("#order_comfirm");var q="";var p="0";var u="";var o="";var s="";var t="";if(this.rewardType==="reward"){p=(this.rechargeMoney*1).toFixed(2);u="酬&emsp;&emsp;金";o=(this.rewardMoney*1).toFixed(2);t="元"}else{if(this.rewardType==="zhejia"){p=(this.rewardMoney*1).toFixed(2);u="折&emsp;&emsp;价";o=((this.rewardMoney*1)/(this.rechargeMoney*1))*100;t="折"}}q+='<div id="id_confirm_wrap" class="div-confirm-wrap">';q+='<div class="confirmTitle">';q+='<ul class="box">';q+='<li class="box-f1">'+this.accountName+"</li>";q+='<li class="box-f3">'+this.accouontValue+"</li>";q+="</ul>";q+="</div>";q+='<div id="confirm_template">';q+='<div id="rewardItems" class="new-payConfirmItem closeReward">';q+='<div class="confirm-item"><em>应收顾客</em><span class="pay_money fontWeight">'+(this.rechargeMoney*1).toFixed(2)+"</span> 元</div>";q+='<div class="confirm-item"><div class="confirm-item-sub">';q+="<em>支付金额</em>";q+='<span class="secret">*****</span>';q+='<span class="notsecret"><i class="pay_money">'+p+"</i> 元</span></div>";q+='<span id="id_confirm_eyes" class="confirm-eyes"></span>';q+="</div>";q+='<div class="confirm-item" id="reward_wrap" style="'+s+'">';q+="<em>"+u+"</em>";q+='<span class="secret">*****</span>';q+='<span id="reward" class="notsecret"><i class="pay_money">'+o+"</i>"+t+"</span>";q+="</div>";q+="</div>";q+="</div>";q+='<div class="confirmTitle">';q+='<ul class="box">';q+='<li class="box-f1">付款方式</li>';q+='<li class="box-f3">&emsp;&emsp;&emsp;&emsp;</li>';q+="</ul>";q+="</div>";q+='<div id="tianyibao_pay">';q+='<div class="box account-wrap" id="tyb_account_wrap">';q+='<div class="box-f3 box radioClick">';q+='<div class="box-f1 pay-radio pay-radio-off" id="tyb_radio"></div>';q+='<div class="box-f1 account-icon account-tyb"></div>';q+='<div class="box-f1 account-content">';q+="<div>添益宝</div>";q+="<div>￥"+(this.tybBalance*1).toFixed(2)+"</div>";q+="</div>";q+="</div>";q+='<div class="box-f1 account-recharge" id="tyb_charge">余额不足<em></em></div>';q+='<input type="hidden" id="tybBalance_val">';q+="</div>";q+='<div class="box account-wrap">';q+='<div class="box-f3 box radioClick">';q+='<div class="box-f1 pay-radio pay-radio-off" id="jfy_radio"></div>';q+='<div class="box-f1 account-icon account-jfy"></div>';q+='<div class="box-f1 account-content">';q+="<div>余&emsp;额</div>";q+="<div>￥"+(this.jfyBalance*1).toFixed(2)+"</div>";q+="</div>";q+="</div>";q+='<div class="box-f1 account-recharge" id="jfy_charge">余额不足<em></em></div>';q+='<input type="hidden" id="jfyBalance_val">';q+="</div></div>";q+='<div class="TOPplaceholder"></div>';q+='<div class="line-box-wrap confirm_botton">';q+='<div class="btn-common-wrap">';q+='<button id="confirm_botton">确 定</button>';q+='<div class="TOPplaceholder"></div>';q+="</div></div></div>";r.html(q)};a.prototype.setButtonAvailable=function(p){var o=this;var n=c("#confirm_botton");n.off("click");if(p){n.removeClass("unavailable");n.on("click",function(){o.itJudgeLocalStorage=new b();o.itJudgeLocalStorage.putLocalValue(o.accouontValue.replace(/\s/g,""),parseInt(o.rechargeMoney*100),k.getCurrentTime(),o.businessName);if(!o.enablePassword){console.log("=======免密======");config.payingBack=true;o.callback("");return}PasswordKeyBoard.initPwdUI3(function(q){config.payingBack=true;o.callback(q)});PasswordKeyBoard.popKeyboardUI3()})}else{n.addClass("unavailable")}};a.prototype.judgeNotFundsPut=function(o){var n=this;n.noFoudsTybOrJby=o;console.log("123self.noFoudsTybOrJby = "+n.noFoudsTybOrJby);n.jumpToRecharge()};a.prototype.setPayClick=function(){var o=this;var q=c(".radioClick");var s=q.eq(0);var r=q.eq(1);var n=c("#jfyBalance_val").val();var p=c("#tybBalance_val").val();r.off("click");s.off("click");c("#jfy_charge").off("click");c("#tyb_charge").off("click");if(n==="availalbe"){r.parent(".account-wrap").removeClass("account-noMoney");r.click(function(){console.log("交费易 click");o.setChoice("jfy");o.setButtonAvailable(true)})}else{if(n==="unavailalbe"){r.parent(".account-wrap").addClass("account-noMoney");r.on("click",function(){o.setChoice("jfy");o.setButtonAvailable(false)});c("#jfy_charge").on("click",function(){o.judgeNotFundsPut("jfyFunds")})}}if(p==="availalbe"){s.parent(".account-wrap").removeClass("account-noMoney");s.click(function(){console.log("添益宝 click");o.setChoice("tyb");o.setButtonAvailable(true)})}else{if(p==="unavailalbe"){s.parent(".account-wrap").addClass("account-noMoney");s.on("click",function(){o.setChoice("tyb");o.setButtonAvailable(false)});c("#tyb_charge").on("click",function(){o.judgeNotFundsPut("tybFunds")})}}};a.prototype.getPayType=function(){var n=this;return n.payType};a.prototype.setShowReward=function(n){if(n==="hide"){c("#rewardItems").addClass("closeReward");c("#id_confirm_eyes").removeClass("see-eyes")}if(n==="show"){c("#rewardItems").removeClass("closeReward");c("#id_confirm_eyes").addClass("see-eyes")}};a.prototype.setRewardClick=function(){var n=this;var o=true;c("#id_confirm_eyes").click(function(){if(c(this).hasClass("see-eyes")){n.setShowReward("hide")}else{n.setShowReward("show");if(o){Bestpay.TalkingData.onEventWithLabel("支付页面","点击酬金显示按钮");o=false}}})};a.prototype.setHiddenInput=function(p,q){var o=this;var r=c("#jfyBalance_val");var n=c("#tybBalance_val");if(p==="jfyBalance"){r.val(q)}else{if(p==="tybBalance"){n.val(q)}}};a.prototype.setChoice=function(o){var n=this;c(".pay-radio").removeClass("pay-radio-on");if(o==="jfy"){c("#jfy_radio").addClass("pay-radio-on");n.payType="0"}else{if(o==="tyb"){c("#tyb_radio").addClass("pay-radio-on");n.payType="1"}}};a.prototype.balanceCheck=function(){var n=this;var q=this.rechargeMoney*1;var p=this.jfyBalance*1;var o=this.tybBalance*1;console.log("this.jfyBalance=="+this.jfyBalance);console.log("this.tybBalance=="+this.tybBalance);if(!!this.tybBalance){n.setChoice("tyb");if(o>=q){n.setButtonAvailable(true);n.setHiddenInput("tybBalance","availalbe")}else{n.setButtonAvailable(false);n.setHiddenInput("tybBalance","unavailalbe")}if(!!this.jfyBalance&&p>=q){n.setHiddenInput("jfyBalance","availalbe")}else{n.setHiddenInput("jfyBalance","unavailalbe")}}else{c("#tyb_account_wrap").hide();n.setChoice("jfy");if(!!this.jfyBalance&&p>=q){n.setButtonAvailable(true);n.setHiddenInput("jfyBalance","availalbe")}else{n.setButtonAvailable(false);n.setHiddenInput("jfyBalance","unavailalbe")}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===this.userInfo.bankMode){n.setShowReward("hide");c("#reward_wrap").hide()}};a.prototype.jumpToRecharge=function(){var p=this;var n="?ENV="+config.ENV;var q;var o=location.origin;if(config.ENV==="PRODUCT"){q=o+"/2015UI/pluginRAB"}else{q=o+"/test/20160419/pluginRAB"}console.log("123 noFoudsTybOrJby = "+p.noFoudsTybOrJby);var r=q+"/reCharge.html"+n+"#JUDGE="+p.noFoudsTybOrJby;console.log(r+"============================URL RE");App.jumpToNewH5View(r,function(){back()})};a.prototype.jumpToAuthority=function(){var p=this;var n="?ENV="+config.ENV;var r;var o=location.origin;console.log("##origin ==== "+o);if(config.ENV==="PRODUCT"){r=o+"/online_h5/pluginRAB"}else{r=o+"/test/20160419/pluginRAB"}var q=r+"/authority.html"+n;console.log(q+"============================URL RE");App.jumpToNewH5View(q,function(){back()})};a.prototype.setOrderDisplay=function(s){var x=this;var r="";var n="../lib/img/receving.png";var q="交易已受理";var p="稍后请确认订单状态";var o="查看订单状态";var t="../lib/img/success.png";var v="交易成功";var u="预计10分钟内到账";var w="再来一次";PasswordKeyBoard.hideKeyboardUI3();if(s==="overtime"){r+='<div class="success-title-img">';r+='<br><img src="'+n+'"><br><br>';r+="<span>"+q+"</span>";r+='<em class="success-title-dz">'+p+"</em><br><br>";r+="</div>";r+='<div class="success-percent">';r+='<div class="box success-div-btn">';r+='<div id="checkOrder" class="box-f1 success-btn checkOrder">'+o+"</div>";r+="</div></div>";c("#floatPageContent").html(r);document.getElementById("checkOrder").onclick=function(){var A=JSON.parse(Bestpay.App.getDeviceInfo());var y=A.clientVersion;var z=A.systemType;y=y.replace(/\./g,"")*1;z=z.toLowerCase();if((z==="android"&&y>=329)||(z==="ios"&&y>=305)){Bestpay.Dialog.jumpToOrderQuery(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);if(window.jqXHR.readyState>2){location.reload()}}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER)}};config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}}else{if(s==="success"){r+='<div class="success-title-img">';r+='<br><img src="'+t+'"><br><br>';r+="<span>"+v+"</span>";r+='<em class="success-title-dz">'+u+"</em><br><br>";r+="</div>";r+='<div class="success-percent">';r+='<div class="box success-div-btn">';r+='<div id="getback" class="box-f1 success-btn success-btn-goahead">返回大厅</div>';r+='<div id="onceAgain" class="box-f1 success-btn checkOrder">'+w+"</div>";r+="</div></div>";c("#floatPageContent").html(r);document.getElementById("getback").onclick=function(){if(window.jqXHR.readyState>2){Bestpay.TalkingData.onEventWithLabel("支付页面","返回大厅");Bestpay.App.exitApp()}};document.getElementById("onceAgain").onclick=function(){if(window.jqXHR.readyState>2){Bestpay.TalkingData.onEventWithLabel("支付页面","再来一次");location.reload()}}}}};var l=function(){var n=c("#btn_next");n.on("touchstart",function(){c(this).css({"background-color":"#EB7605"})});n.on("touchend touchmove touchcancel",function(){c(this).css({"background-color":"#ff7e00"})})};l();var b=function(){var n=this;var o=JSON.parse(Bestpay.App.getDeviceInfo());n.clientVersion=o.clientVersion;n.systemType=o.systemType;n.clientVersion=n.clientVersion.replace(/\./g,"")*1;n.systemType=n.systemType.toLowerCase()};b.prototype.putLocalValue=function(q,o,p,r){var n=this;this.number=q;this.amount=o;this.currentTime=p;this.businessName=r;if((n.systemType==="android"&&n.clientVersion>=406)||(n.systemType==="ios"&&n.clientVersion>=403)){Bestpay.Preference.put("Number",n.number,"");Bestpay.Preference.put("Amount",n.amount,"");Bestpay.Preference.put("CurrentTime",n.currentTime,"");Bestpay.Preference.put("BusinessName",n.businessName,"");console.log("put123==="+n.number);console.log("put123==="+n.amount);console.log("put123==="+n.currentTime);console.log("put123==="+n.businessName)}};b.prototype.getLocalValue=function(){var o=this;var n={};n.Number=Bestpay.Preference.get("Number","","");n.Amount=Bestpay.Preference.get("Amount","","");n.CurrentTime=Bestpay.Preference.get("CurrentTime","","");n.BusinessName=Bestpay.Preference.get("BusinessName","","");return n};b.prototype.checkOrder=function(s,q,r,o,t){var p=this;console.log("开始判断");if((p.systemType==="android"&&p.clientVersion>=406)||(p.systemType==="ios"&&p.clientVersion>=403)){var n=p.getLocalValue();console.log("123result过去 = "+JSON.stringify(n));console.log("123number当前 = "+s);console.log("123amount当前 = "+q*100);console.log("123currentTime当前 = "+r);console.log("123businessName当前 = "+t);if(s==n.Number&&q*100==n.Amount&&t==n.BusinessName){if(e.getTime_CONTRAST(n.CurrentTime,r,2)<=10){console.log("相同判断");p.InnerPing(o);return}}console.log("123不相同判断");o()}o()};b.prototype.InnerPing=function(n){var p=this;var o=c("#page_LocalHost");var q='<div class="floatParent"><div class="backblack"></div><div class="FloatCenter"><div class="alert_cet">该号码已有订单处理中，是否重复充值？</div><ul class="alert_U boxbox alertBtnTouch"><li id="InnerGoAhead">继续充值</li><li id="WatchOrder">查看订单</li></ul></div></div>';o.html(q);goTo(config.page.LocalHost);p.InnerBtnInit(n)};b.prototype.InnerBtnInit=function(o){var n=c(".alertBtnTouch li");n.on("touchstart",function(){c(this).addClass("itemHover")});n.on("touchend touchmove touchcancel",function(){c(this).removeClass("itemHover")});document.getElementById("InnerGoAhead").onclick=function(){back();o()};document.getElementById("WatchOrder").onclick=function(){back();Bestpay.Dialog.jumpToOrderQuery(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER)}};return{InputText:f,BlockRadioGroup:i,dropDownBox:m,DialogClass:j,showDialogClass:d,Template:g,paymentPlugin:a,GridList:h,JudgeLocalStorage:b}});