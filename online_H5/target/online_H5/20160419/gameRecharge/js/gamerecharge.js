define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(c,g,b,f){var e=null;var d=document;function a(){e=this;this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());this.random=null;this.orderPageJson={};this.itMobile=null;this.ipPassword="";this.quickTranInfo={};this.witchOrderPage=null;this.rewardParam={};this.rechargeMoney=[];this.successJson={};this.supportGameList={};this.gameNameParam={};this.gameOrderJson={productCode:null,prodCode:null,gameId:null,payMoney:null,gameServer:null,gameServerId:null,otherCount:false,accountType:""};this.gameServerParam={};this.gameCountParam={};this.payTypeParam={};this.gameServerList={};this.gameServerListParam={};this.serverListParam={};this.dialogSelectDefult={gameName:0,gameServer:0,gameCount:0};this.gameAccount=null;this.zwAccount=null;this.GameRechargeNUM=null;this.pay_other_count_val=null;this.goType="zc";this.payType="0";this.checkBillCheck=false;this.GameRechargeData={};this.productId="0030001";this.second=false;this.deffered=null;this.paymentPlugin=null;this.businessName="游戏直充"}a.prototype.initApp=function(){var h=this;h.itJudgeLocalStorage=new g.JudgeLocalStorage();h.gameNameListQuery();goTo(config.page.main,function(){console.log("--------------start--------------");h.btnInit()})};a.prototype.btnInit=function(){var h=this;h.itMobile=new g.InputText("mobile_zc","mobile");h.itMobile_dk=new g.InputText("mobile_dk","mobile");var i=function(j){if(j=="zc"){h.businessName="游戏直充";h.goType="zc";h.gameNameListQuery();c("#yxzc").show();c("#game_card_info").hide();c("#game_username_show").show();c("#cardType").hide()}else{if(j=="dk"){h.businessName="游戏点充";h.goType="dk";h.resetCard();c("#yxzc").hide();c("#game_card_info").show();c("#game_username_show").hide();c("#cardType").show();h.itMobile_dk.clearValue()}}};h.selectType=new g.BlockRadioGroup("brg_amount","game_pay",i);d.getElementById("btn_next").onclick=function(){if(!h.gameOrderJson.prodCode){Bestpay.Toast.makeText("请选择一个游戏",Bestpay.Toast.LENGTH_SHORT);return}else{if(!h.gameAccount.getToEmptyValue()){Bestpay.Toast.makeText("请输入游戏账号",Bestpay.Toast.LENGTH_SHORT);return}}goTo(config.page.game_pay,function(){h.itMobile.clearValue()})};d.getElementById("paybill_zc").onclick=function(){h.validation()};d.getElementById("confirm_buy").onclick=function(){h.mobile_val=h.itMobile_dk.getToEmptyValue();if(h.mobile_val.length>=1&&h.mobile_val.length<11){Bestpay.Toast.makeText("请输入11位的顾客手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.mobile_val.length==11&&!h.itMobile_dk.getInputCheck()){Bestpay.Toast.makeText("您输入的手机号号码段不正确",Bestpay.Toast.LENGTH_SHORT);return}}h.orderPageJson.game_name="游戏点卡";h.orderPageJson.game_username="天下通卡";h.itJudgeLocalStorage.checkOrder(h.orderPageJson.game_username,h.gameOrderJson.payMoney*1,f.getCurrentTime(),function(){h.gotoCardRecharge()},h.businessName)};d.getElementById("card_pay_select_box").onclick=function(){goTo(config.page.card_pay_prompt,function(){});var j=new g.dropDownBox("card_pay_select",this,{"10元":"10","30元":"30","50元":"50","100元":"100"},function(l,k){j.hideDropDownBox();h.gameOrderJson.payMoney=l;var m=c(k).text();c("#card_pay_select_box_val").html(m);back()},function(){j.hideDropDownBox();back()})}};a.prototype.gotoCardRecharge=function(){showDialog(config.MSG.loading);config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_CARD;var h=this;h.witchOrderPage="card";h.rewardParam.BUS_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_CARD;h.rewardParam.BUS_CODE=config.BUS_CODE.ELE_CARD;e.rewardParam.productCode="";h.queryStart();h.callQuickTradingQuery();h.defferred.done(h.goPayAnimation)};a.prototype.gotoGamePay=function(){config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_DIRECT;var h=this;h.witchOrderPage="recharge";dismissDialog();h.gameAccount=new g.InputText("game_username_val",null,function(k){if(h.GameRechargeNUM=="03010100"){h.gameAccount.setValue(k.replace(/[^0-9]+/,""))}});h.zwAccount=new g.InputText("zw_val");var j=function(){c("#pay_money").hide();c("#tip3").hide();h.gameOrderJson.payMoney=0;h.gameOrderJson.input_val="";console.log("self.gameOrderJson['payMoney']===="+h.gameOrderJson.payMoney);console.log(" typeof==="+typeof h.gameOrderJson.payMoney);console.log(" boolean==="+!!h.gameOrderJson.payMoney)};var i=function(){};h.pay_other_count_val=new g.InputText("pay_other_count_val","number",i,j);h.resetPage();h.dialogSelectDefult.gameName=0;h.dialogSelectDefult.gameCount=0;h.dialogSelectDefult.gameServer=0;h.dialogSelectDefult.payType=0;h.gamePayBtnInit()};a.prototype.resetPage=function(j){var i=this;var h=j||"请选择";i.gameOrderJson={};i.gameCountParam={};i.payTypeParam={};i.dialogSelectDefult.gameName=0;i.gameServerParam.searchType=null;c("#game_name_val").html(h);i.gameAccount.clearValue();i.zwAccount.clearValue();c("#game_area_val").html("请选择");c("#game_server_val").html("请选择");c("#pay_type_val").html("请选择");c("#game_area").hide();c("#pay_count_val").html("请选择");c("#pay_money").hide();c("#zw_username").hide();c("#game_server").hide();c("#pay_type").hide();c("#pay_other_count").hide();c("#pay_other_count_val").val("");e.fwq=null;c("#pay_money_val").html("0.00元");e.gameOrderJson.payMoney=0;c("#tip3").hide();i.gameOrderJson.input_val=""};a.prototype.resetCard=function(){var h=this;h.gameOrderJson.payMoney=50;c("#card_pay_select_box_val").html("50元")};a.prototype.gamePayBtnInit=function(){var h=this;d.getElementById("game_name").onclick=function(j){c("#page_select_bank").html("");goTo(config.page.select_bank);var i=new g.dropDownBox("page_select_bank",this,h.gameNameParam,function(k,l){i.clearDropDownBox();var m=c(l).text();e.GameRechargeNUM=null;e.qb=false;if(m=="Q币"||m=="测试大小区服"){console.log(m+"=======================================");e.GameRechargeNUM="03010100";if(m=="Q币"){e.qb=true}}h.resetPage(m);h.dialogSelectDefult.gameName=k;h.dialogSelectDefult.gameCount=0;h.dialogSelectDefult.gameServer=0;h.gameOrderJson.prodCode=h.supportGameList[k].productCode;h.gameOrderJson.gameId=h.supportGameList[k].gameId;e.gameDetailQuery();back()},function(){i.hideDropDownBox();back()})};d.getElementById("pay_count").onclick=function(){if(!h.gameOrderJson.prodCode){Bestpay.Toast.makeText("请选择一个游戏",Bestpay.Toast.LENGTH_SHORT);return false}c("#page_select_bank").html("");goTo(config.page.select_bank);var i=new g.dropDownBox("page_select_bank",this,h.gameCountParam,function(k,n){var l=e.rechargeMoney[k];var m=c(n).text();c("#tip3").hide();h.dialogSelectDefult.gameCount=k;if(k==(e.gameCountParamLen+1)){c("#pay_other_count").show();h.pay_other_count_val.clearValue();h.gameOrderJson.payMoney=0;c("#pay_money").hide();h.gameOrderJson.otherCount=true;var o=", "+h.gameOrderJson.errorInfo+"的倍数";var j=h.gameOrderJson.minAmount+"-"+h.gameOrderJson.maxAmount+o;d.getElementById("pay_other_count_val").placeholder=j;c("#pay_other_count_val").on("input",function(){var q=!h.pay_other_count_val.getValue()?0:h.pay_other_count_val.getValue();var p=null;c("#tip3").hide();h.gameOrderJson.payMoney=h.gameOrderJson.unitPrice*q;h.gameOrderJson.input_val=q;console.log(h.gameOrderJson.unitPrice);console.log(q);console.log("payMoney==========="+h.gameOrderJson.payMoney);console.log("input_val==========="+h.gameOrderJson.input_val);console.log("%%======="+h.gameOrderJson.input_val%h.gameOrderJson.errorInfo);p=h.gameOrderJson.payMoney.toFixed(2);c("#pay_money_val").html(p);c("#pay_money").show()})}else{h.gameOrderJson.otherCount=false;h.gameOrderJson.payMoney=l;c("#pay_money_val").html(l+".00");c("#pay_other_count").hide();c("#pay_money").show()}c("#pay_count_val").html(m);i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})};d.getElementById("pay_type").onclick=function(){c("#page_select_bank").html("");goTo(config.page.select_bank);var i=new g.dropDownBox("page_select_bank",this,h.payTypeParam,function(j,k){var l=c(k).text();c("#pay_type_val").html(l);h.dialogSelectDefult.payType=j;h.gameOrderJson.accountType=j*1+1;i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})}};a.prototype.gameNameListQuery=function(){showDialog(config.MSG.loading);var h=this;f.callCPSService({service:config.CPS.GAME_LIST,params:h.gameNameQueryParams(),showLoading:false,success:h.gameNameQuerySuccessCallback})};a.prototype.gameNameQueryParams=function(){var h=this;var i={};i=f.setCPSCommonParams(i);return i};a.prototype.gameNameQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}e.supportGameList=h.supportGameList;h.supportGameList.forEach(function(j,k){var l=j.gameName;e.gameNameParam[l]=k});e.gotoGamePay()};a.prototype.gameDetailQuery=function(){var h=this;f.callCPSService({service:config.CPS.GAME_INFO,params:h.gameDetailQueryParams(),showLoading:true,success:h.gameDetailQuerySuccessCallback})};a.prototype.gameDetailQueryParams=function(){var h=this;var i={prodCode:h.gameOrderJson.prodCode};i=f.setCPSCommonParams(i);return i};a.prototype.gameDetailQuerySuccessCallback=function(k){if(k.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",k.content,"确定",k.code);return}console.log("gameDetail:"+JSON.stringify(k));e.gameOrderJson.supplyCode=k.supplyCode;e.gameOrderJson.unitPrice=b.fen2yuan(k.unitPrice);e.gameOrderJson.minAmount=k.minAmount;e.gameOrderJson.maxAmount=k.maxAmount;e.gameOrderJson.errorInfo=k.errorInfo;e.gameOrderJson.valInput=k.valInput;var j=k.rechargeQuantity.split(",");j.forEach(function(p,o){e.gameCountParam[p]=o;e.gameCountParamLen=o});e.gameCountParam["其他数量"]=e.gameCountParamLen+1;console.log(JSON.stringify(e.gameCountParam));e.rechargeMoney=k.rechargeMoney.split(",");c("#game_area").hide();c("#orderServer_comfirm").hide();console.log("prodCode="+e.gameOrderJson.prodCode);if(e.gameOrderJson.prodCode==="00000017"){c("#zw_username").show()}if(!!k.rechargeType){c("#pay_type").show();e.gameOrderJson.isPayType=true;var l=k.rechargeType.split(",");for(var m=0,h=l.length;m<h;m++){var n=l[m].split(":");e.payTypeParam[n[1]]=m}console.log("payTypeParam=="+JSON.stringify(e.payTypeParam))}e.gameType=k.gameType;if(k.gameType==2){e.gameServerParam.searchType=1;e.gameServerQuery();c("#game_area").show()}if(k.gameType==3){e.gameServerParam.searchType=2;e.gameServerQuery();c("#game_area").show();c("#game_server").show()}};a.prototype.gameServerQuery=function(){var h=this;f.callCPSService({service:config.CPS.GAME_SERVER,params:h.gameServerQueryParams(),showLoading:true,success:h.gameServerQuerySuccessCallback})};a.prototype.gameServerQueryParams=function(){var h=this;var i={prodCode:h.gameOrderJson.prodCode,gameServerId:h.gameOrderJson.gameServer,searchType:h.gameServerParam.searchType,supplyCode:h.gameOrderJson.supplyCode};i=f.setCPSCommonParams(i);return i};a.prototype.gameServerQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}console.log("serverQuery:"+JSON.stringify(h));e.gameServerList=h.gameServerList;e.gameServerListParam={};h.gameServerList.forEach(function(k,j){var l=k.gameServerName;e.gameServerListParam[l]=j});if(e.second){e.gameServerListParam_xiao={};h.gameServerList.forEach(function(l,k){var m=l.gameServerName;var j=l.gameServerValue;e.gameServerListParam_xiao[m]=j})}else{e.gameServerListParam_da=e.gameServerListParam;e.gameServerList_da=h.gameServerList}console.log("游戏区服查询接口 出参"+JSON.stringify(e.gameServerList));d.getElementById("game_area").onclick=function(){c("#page_select_bank").html("");goTo(config.page.select_bank);var i=new g.dropDownBox("page_select_bank",this,e.gameServerListParam_da,function(j,k){var l=c(k).text();c("#game_area_val").html(l);e.gameOrderJson.gameServer=e.gameServerList_da[j].gameServerValue;if(e.gameServerParam.searchType==2){var m=l.replace("区","号服务器");e.gameServerQuery();e.gameOrderJson.gameServerId=null;c("#game_server_val").html("请选择");e.second=true}i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})};d.getElementById("game_server").onclick=function(){if(!!e.gameServerParam.searchType&&!e.gameOrderJson.gameServer){Bestpay.Toast.makeText("请选择一个大区",Bestpay.Toast.LENGTH_SHORT);return}c("#page_select_bank").html("");goTo(config.page.select_bank);var i=new g.dropDownBox("page_select_bank",this,e.gameServerListParam_xiao,function(j,k){var l=c(k).text();c("#game_server_val,#game_area_order_server").html(l);e.gameOrderJson.gameServerId=j;console.error(" gameServerId:"+e.gameOrderJson.gameServerId);e.fwq=true;i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})}};a.prototype.validation=function(){var h=this;if(e.qb&&(h.gameAccount.getToEmptyValue().length<5)){Bestpay.Toast.makeText("请检查输入的充值号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.isPayType&&!h.gameOrderJson.accountType){Bestpay.Toast.makeText("请选择充值方式",Bestpay.Toast.LENGTH_SHORT);return}else{if(!!h.gameServerParam.searchType&&!h.gameOrderJson.gameServer){Bestpay.Toast.makeText("请选择一个大区",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameType=="3"&&!h.gameOrderJson.gameServerId){Bestpay.Toast.makeText("请选择游戏服务器",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.prodCode=="00000017"&&!h.zwAccount.getValue()){Bestpay.Toast.makeText("请输入网战账号",Bestpay.Toast.LENGTH_SHORT);return}else{if(!h.gameOrderJson.otherCount&&!(h.gameOrderJson.payMoney*1)){Bestpay.Toast.makeText("请选择充值数量",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.otherCount&&!h.gameOrderJson.input_val){Bestpay.Toast.makeText("请填写充值数量",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.otherCount&&(h.gameOrderJson.input_val*1<h.gameOrderJson.minAmount*1||h.gameOrderJson.input_val*1>h.gameOrderJson.maxAmount*1)){console.log("范围不对");c("#tip3").show();return}else{if(h.gameOrderJson.otherCount&&((h.gameOrderJson.input_val%h.gameOrderJson.errorInfo)>0)){console.log("倍数不对");c("#tip3").show();return}}}}}}}}}h.mobile_val=h.itMobile.getToEmptyValue();if(h.mobile_val.length>=1&&h.mobile_val.length<11){Bestpay.Toast.makeText("请输入11位的顾客手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.mobile_val.length==11&&!h.itMobile.getInputCheck()){Bestpay.Toast.makeText("您输入的手机号号码段不正确",Bestpay.Toast.LENGTH_SHORT);return}}h.rewardParam.BUS_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_DIRECT;h.rewardParam.BUS_CODE=config.BUS_CODE.GAME_DIRECT;h.initConfirm()};a.prototype.initConfirm=function(){var h=this;if(e.witchOrderPage=="recharge"){if(h.gameOrderJson.prodCode=="00000017"){h.gameOrderJson.account=h.zwAccount.getValue();h.gameOrderJson.subAccount=h.gameAccount.getToEmptyValue()}else{h.gameOrderJson.account=h.gameAccount.getToEmptyValue();h.gameOrderJson.subAccount=h.zwAccount.getValue()}e.orderPageJson.game_name=c("#game_name_val").html();e.orderPageJson.game_username=h.gameAccount.getToEmptyValue();e.orderPageJson.game_area=c("#game_area_val").html();if(e.gameOrderJson.otherCount){e.orderPageJson.pay_count=e.gameOrderJson.input_val}else{e.orderPageJson.pay_count=c("#pay_count_val").html()}e.orderPageJson.pay_money=c("#pay_money_val").html();console.log("订单:"+JSON.stringify(e.orderPageJson))}h.itJudgeLocalStorage.checkOrder(h.gameOrderJson.account,h.orderPageJson.pay_money*1,f.getCurrentTime(),function(){h.queryStart();h.callQuickTradingQuery();h.defferred.done(h.goPayAnimation)},h.businessName)};a.prototype.gotoOrder=function(h){f.getRandomServices(function(i){var j=i;if(i.code===config.RES.SUCCESS){e.random=i.randNum}e.gotoRecharge(h)},false)};a.prototype.queryStart=function(){var h=this;h.defferred=c.Deferred();showDialog()};a.prototype.queryEnd=function(){var h=this;var i={businessName:h.businessName,accountName:"游戏充值",accouontValue:h.orderPageJson.game_username,rechargeMoney:h.gameOrderJson.payMoney,rewardType:h.orderPageJson.rewardType,rewardMoney:h.orderPageJson.reward,jfyBalance:h.orderPageJson.jfy_amount,tybBalance:h.orderPageJson.tyb_amount,enablePassword:h.noPwd,userInfo:h.userInfo,callback:h.gotoOrder};console.log("pluginParam = "+JSON.stringify(i));h.paymentPlugin=new g.paymentPlugin(i);dismissDialog();goTo(config.page.comfirm,function(){});h.defferred.resolve()};a.prototype.goPayAnimation=function(){console.log("done=========================");c("#order_comfirm").removeClass("backPayAnimation").addClass("goPayAnimation")};a.prototype.getCommission=function(){var h=this;console.error("payMoney:"+h.gameOrderJson.payMoney);f.getCommission(e.rewardParam.BUS_TYPE,e.rewardParam.BUS_CODE,e.gameOrderJson.prodCode,h.gameOrderJson.payMoney,function(i){var j=i;console.error("result:"+JSON.stringify(i));if(i.code===config.RES.SUCCESS){j.commission=b.fen2yuan(i.reward)}else{if(i.code===config.CODE.COMMOSSION_ERROR){j.code=config.RES.SUCCESS;j.commission="0.00"}else{j.code=config.RES.UNKNOWN_ERROR;j.content=config.RES.UNKNOWN_ERROR_MSG}}e.gameOrderJson.supplyCode=j.supplyCode;e.orderPageJson.reward=j.commission;e.orderPageJson.rewardType="reward";e.queryEnd()},false)};a.prototype.SDiscQuery=function(){var h=this;f.callCPSService({service:config.CPS.SDISCQUERY,params:h.SDiscQueryParams(),showLoading:false,success:h.SDiscQuerySuccessCallback})};a.prototype.SDiscQueryParams=function(){var h=this;var i={rechAmount:b.yuan2fen(h.gameOrderJson.payMoney),pecProduct:h.gameOrderJson.prodCode,supplyCode:h.gameOrderJson.supplyCode||""};i=f.setCPSCommonParams(i);console.log("折价查询SDISCQUERY 入参==");return i};a.prototype.SDiscQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}e.gameOrderJson.supplyCode=h.supplyCode;e.orderPageJson.reward=b.fen2yuan(h.discAmount);e.orderPageJson.rewardType="zhejia";e.queryEnd()};a.prototype.callQuickTradingQuery=function(){var h=this;f.callCPSService({service:config.CPS.QUICK_TRADING_QUERY,params:h.quickTradingQueryParams(),showLoading:false,success:h.quickTradingQuerySuccessCallback})};a.prototype.quickTradingQueryParams=function(){var h=this;var i={};i=f.setCPSCommonParams(i);return i};a.prototype.quickTradingQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}e.quickTranInfo={perAmount:h.perAmount,allamount:h.allamount,alltransaction:h.alltransaction};e.handleIsneedpassword()};a.prototype.handleIsneedpassword=function(){var h=this;var j=e.quickTranInfo;var i=b.yuan2fen(h.gameOrderJson.payMoney);console.log("amount : "+i);console.log("quickTranInfo : "+JSON.stringify(j));if(i*1<=1*j.perAmount&&(i*1+1*j.alltransaction)<=1*j.allamount){e.noPwd=false}else{e.noPwd=true}console.log("self.userInfo.authenStatus=="+h.userInfo.authenStatus);if(h.userInfo.authenStatus=="A02"){console.log("self.userInfo.hadEpt  "+h.userInfo.hadEpt);if(h.userInfo.hadEpt==1){h.getFinancialProducts()}else{h.fundAccountBalanceInquiry()}}else{h.fundAccountBalanceInquiry()}};a.prototype.getFinancialProducts=function(){var h=this;f.callCPSService({service:config.CPS.FINANCIAL_PRODUCTS,params:h.getFinancialProductsParams(),showLoading:false,success:h.getFinancialProductsSuccessCallback})};a.prototype.getFinancialProductsParams=function(){var h=this;var i={};i=f.setCPSCommonParams(i);return i};a.prototype.getFinancialProductsSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code==="018888"){e.fundAccountBalanceInquiry();return}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}}c("#payfortianyibao").show();var k=h.datas;for(var j=0;j<k.length;j++){e.orderPageJson.productId=k[j]["productId"];e.orderPageJson.userId=k[j]["userId"];e.orderPageJson.tyb_amount=b.fen2yuan(k[j]["balance"])}e.fundAccountBalanceInquiry()};a.prototype.fundAccountBalanceInquiry=function(){var h=this;f.callCPSService({service:config.CPS.CCOUNT_BALANCE_QUERY,params:h.fundAccountBalanceInquiryParams(),showLoading:false,success:h.fundAccountBalanceInquirySuccessCallback})};a.prototype.fundAccountBalanceInquiryParams=function(){var h=this;var i={bankMode:h.userInfo.bankMode};i=f.setCPSCommonParams(i);return i};a.prototype.fundAccountBalanceInquirySuccessCallback=function(v){var u=this;if(v.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",v.content,"确定",v.code);return}console.log("资金账户余额查询 SAcc003出参======="+JSON.stringify(v));var s=v.dayLimit;var j=v.dayTotal;var l=s*1-j*1;var h=v.monthLimit;var o=v.monthTotal;var n=h*1-o*1;var q=v.motherBoard;var p=v.accountItems;for(var m=0;m<p.length;m++){var r=p[m]["acctType"];if(r!=null||r!="null"||r!="undefined"||r!=""){if("0007"==r){var k=p[m].activeBalance;e.orderPageJson.jfy_amount=b.fen2yuan(k);break}}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===e.userInfo.bankMode){var t="";if(s==="0"){t=q}else{if(q>l){t=l}else{t=q}}if(h==="0"){t=q}else{if(q>n){t=n}else{t=q}}e.orderPageJson.jfy_amount=b.fen2yuan(t);console.log("子卡==GameRechargeSelf.orderPageJson['jfy_amount']=="+e.orderPageJson.jfy_amount)}console.log(e.goType);if(e.goType==="zc"){e.SDiscQuery()}else{if(e.goType==="dk"){e.getCommission()}}};a.prototype.gotoRecharge=function(h){f.getRandomServices(function(i){var j=i;if(i.code===config.RES.SUCCESS){e.random=i.randNum}console.log("witchOrderPage== "+e.witchOrderPage);if(e.witchOrderPage=="recharge"){e.rechargeResp(h)}if(e.witchOrderPage=="card"){e.cardResp(h)}},false)};a.prototype.cardResp=function(i){config.isBack=function(){back()};var h=this;f.callCPSService({service:config.CPS.ELECTRONIC_SELL_CARD,params:h.cardParams(i),showLoading:true,success:h.cardSuccessCallback,error:h.cardErrorCallback})};a.prototype.cardParams=function(k){var h=this;var i="";if(k!=null&&k!=""){i=k}var j={payPassword:Bestpay.Security.encryptPassword(h.userInfo.staffCode,i,h.random),cardAmount:b.yuan2fen(h.gameOrderJson.payMoney),cardTypeCode:"2003",payType:"0",tradeTime:b.getDate_YYYYMMDD()+""+b.getTime_HHMMSS(),orderNo:b.getDate_YYYYMMDD()+""+b.getTime_HHMMSS()+""+new Date().getMilliseconds()};if(h.mobile_val.length>0){j.phone=h.mobile_val}else{j.phone=""}if(h.userInfo.hadEpt.toString()=="1"){j.costWay=h.paymentPlugin.getPayType();j.productId=h.productId;j.userId=h.orderPageJson.userId}j=f.setCPSCommonParams(j);return j};a.prototype.cardSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){e.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.page_float);return}if(h.code=="006914"){Bestpay.Dialog.showAlertDialog("提醒","卡库存不足","确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){App.exitCompleteApp();e.itJudgeLocalStorage.putLocalValue("","","","")})}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")})}return}e.itJudgeLocalStorage.putLocalValue("","","","");if(e.mobile_val.length>0){f.sendSmsCertificate(h.transSeq,e.mobile_val,"")}e.paymentPlugin.setOrderDisplay("success");goTo(config.page.page_float);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};a.prototype.cardErrorCallback=function(h){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){e.itJudgeLocalStorage.putLocalValue("","","","")});return}};a.prototype.rechargeResp=function(i){var h=this;config.TRADE_LIST_QUERY_NUMBER=h.gameAccount.getToEmptyValue();config.isBack=function(){back()};f.callCPSService({service:config.CPS.GAME_RECHARGE,params:h.rechargeParams(i),showLoading:true,success:h.rechargeSuccessCallback,error:h.rechargeErrorCallback})};a.prototype.rechargeParams=function(k){var h=this;var i="";if(k!=null&&k!=""){i=k}var j={account:h.gameOrderJson.account,prodCode:h.gameOrderJson.prodCode,gameId:h.gameOrderJson.gameId,time:+new Date(),rechargeNum:h.orderPageJson.pay_count,rechargeProduct:h.gameOrderJson.gameValue,amount:b.yuan2fen(h.gameOrderJson.payMoney),password:Bestpay.Security.encryptPassword(h.userInfo.staffCode,i,h.random),subAccount:h.gameOrderJson.subAccount,gameZone:h.gameOrderJson.gameServer,gameServer:h.gameOrderJson.gameServerId,accountType:h.gameOrderJson.accountType,rechargeType:h.gameOrderJson.accountType,supplyCode:h.gameOrderJson.supplyCode};if(h.mobile_val.length>0){j.phone=h.mobile_val}else{j.phone=""}if(h.userInfo.hadEpt.toString()=="1"){j.costWay=h.paymentPlugin.getPayType();j.productId=h.productId;j.userId=h.orderPageJson.userId}console.error("----"+JSON.stringify(j));j=f.setCPSCommonParams(j);return j};a.prototype.rechargeSuccessCallback=function(h){dismissDialog();if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){e.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.page_float);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){App.exitCompleteApp();e.itJudgeLocalStorage.putLocalValue("","","","")})}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")})}return}e.itJudgeLocalStorage.putLocalValue("","","","");if(e.mobile_val.length>0){f.sendSmsCertificate(h.orderId,e.mobile_val,"")}e.paymentPlugin.setOrderDisplay("success");goTo(config.page.page_float);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};a.prototype.rechargeErrorCallback=function(h){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){e.itJudgeLocalStorage.putLocalValue("","","","")});return}};return a});