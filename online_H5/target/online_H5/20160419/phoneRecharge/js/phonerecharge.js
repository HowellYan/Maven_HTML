define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(c,g,b,f){var e=null;var d=document;function a(){e=this;this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());console.log("userInfo============="+JSON.stringify(userInfo));this.payType="0";this.random=null;this.itMobile=null;this.phoneNumber=null;this.phoneNumber3G=null;this.random=null;this.Recharge_Money=null;this.other_money=null;this.isInputOther=null;this.actionCode=null;this.quickTranInfo={};this.SPhn004custName="";this.SPhn004amount="";this.ifrefush="";this.ErrorNotice={notice:"未能查询到运营商",tokenLost:"请您重新登陆",errorPwd:"请输入6-12位支付密码",noPwd:"请输入您的支付密码"};this.ErrorPhone=false;this.flow_ErrorPhone=false;this.needPwd=true;this.YYS_FLAG=false;this.phonetrueoffalse=true;this.RECHARGETYPE="";this.BusiCode={TEL_TELECOM:"03010008",TEL_MOBILE_QX:"04010011",TEL_UNICOM_QX:"04010010"};this.orderPageJson={};this.successJson={};this.rechargeAmount=null;this.quickTranInfo=null;this.checkBillCheck=false;this.rechargeData={};this.productId="0030001";this.temrefush=false;this.selectMoney=null;this.defferred=null;this.selectPayType="0";this.selectPhoneMoneyList=null;this.businessName="充话费";this.phone_number=null;this.phone_number_val=null;this.mRechargeFlow="300";this.pecProductCode="";this.deviceInfo=JSON.parse(Bestpay.App.getDeviceInfo());this.clientVersion=this.deviceInfo.clientVersion.replace(/\./g,"")*1;this.systemType=this.deviceInfo.systemType.toLowerCase();this.flow_Data=null;this.ChinaTelecom_Data=[{M:"10M",Y:"2元",V:"10"},{M:"30M",Y:"5元",V:"30"},{M:"60M",Y:"10元",V:"60"},{M:"100M",Y:"10元",V:"100"},{M:"150M",Y:"20元",V:"150"},{M:"200M",Y:"15元",V:"200"},{M:"300M",Y:"30元",V:"300"},{M:"500M",Y:"30元",V:"500"},{M:"1G",Y:"50元",V:"1024"}];this.ChinaMobile_Data=[{M:"10M",Y:"3元",V:"10"},{M:"30M",Y:"5元",V:"30"},{M:"70M",Y:"10元",V:"70"},{M:"500M",Y:"30元",V:"500"},{M:"1G",Y:"50元",V:"1024"},{M:"2G",Y:"70元",V:"2048"},{M:"3G",Y:"100元",V:"3072"},{M:"4G",Y:"130元",V:"4096"},{M:"6G",Y:"180元",V:"6144"}];this.ChinaUnicom_Data=[{M:"20M",Y:"3元",V:"20"},{M:"50M",Y:"6元",V:"50"},{M:"100M",Y:"10元",V:"100"},{M:"200M",Y:"15元",V:"200"},{M:"500M",Y:"30元",V:"500"}];this.GridList=null;this.verify=null;this.actionName=null;this.mTxnAmount=null;this.provinceCode=null}a.prototype.initApp=function(){config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_TEL;var h=this;h.itJudgeLocalStorage=new g.JudgeLocalStorage();goTo(config.page.main,function(){var m=function(o){console.log("ronggang = "+o+" "+o.length);if(o.length>0){h.other_money=o}else{d.getElementById("brg_amount").onclick=h.selectMoney;h.other_money=null}};var l=function(){d.getElementById("brg_amount").onclick=h.selectMoney;h.other_money=null};var i=function(q){if(q.length==11){var o=document.getElementById("Mobile");var p=o.value;o.focus();o.value="";o.value=p;e.phoneNumber=q;c("#contactInfo").html("").hide();c("#loading_phone").show();e.phonetrueoffalse=false;console.log("33333");d.getElementById("brg_amount").onclick=h.selectMoney;e.getMobileNoTrack(q)}else{c("#payName_amount_parent55").hide()}};var n=function(o){c("#payName_amount_parent55").hide();c("#contactInfo").html("").hide();d.getElementById("brg_amount").onclick=h.selectMoney;h.phone_amount.clearValue();c("#selfNet").hide();h.phoneNumber=null;h.other_money=null;if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){if(o==null){NumberKeyBoard.keyNum=""}}};var k=function(q){if(q.length==11){var o=document.getElementById("phone_number");var p=o.value;o.focus();o.value="";o.value=p;c("#contactInfo_g").html("").hide();c("#loading_phone_g").show();e.phoneNumber3G=q;e.getMobileNoTrack(q)}};var j=function(o){c("#contactInfo_g").html("").hide();c("#flowbtn").hide();if(!!h.GridList){c("#flow_list_wrap").html("");c("#tip_change").html("")}if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){if(o==null){NumberKeyBoard.keyNum=""}}};h.phone_amount=new g.InputText("phone_amount","number",m,l);h.itMobile=new g.InputText("Mobile","phone",i,n);h.phone_number=new g.InputText("phone_number","phone",k,j);console.log("clientVersion=="+h.clientVersion);if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){c("#Mobile").on("click",function(){NumberKeyBoard.initPwdId("Mobile",i,n,11,"close");NumberKeyBoard.InitnumKeyboard()});c("#phone_number").click(function(){NumberKeyBoard.initPwdId("phone_number",k,j,11,"close");NumberKeyBoard.InitnumKeyboard()})}h.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};h.btnInit()})};a.prototype.btnInit=function(){var h=this;h.selectType=new g.BlockRadioGroup("select_pay","full_phone",function(i){h.selectPayType=i;if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){NumberKeyBoard.HidenumKeyboard()}if(i=="0"){c("#phone_type").show();c("#flow_type").hide();h.businessName="充话费"}else{c("#phone_type").hide();c("#flow_type").show();h.businessName="充流量"}});h.brgAmount="50";h.selectMoney=function(){var i=this;c("#page_select_money").html("");goTo(config.page.select_money);h.phoneRechareDiaLog=new g.dropDownBox("page_select_money",this,h.selectPhoneMoneyList,function(j,k){h.phoneRechareDiaLog.clearDropDownBox();if(j=="0"){c("#select_amount_list").hide();c("#phone_amount").show();back();h.isInputOther=true;i.onclick=null;return}h.isInputOther=false;c("#select_amount_list").show();c("#phone_amount").hide();var l=c(k).text();c("#brg_amount_val").html(l);h.brgAmount=j;back()},function(){back()})};d.getElementById("brg_amount").onclick=h.selectMoney;document.getElementById("btn_next_g").onclick=function(){h.checkBillCheck=false;h.validation()};document.getElementById("btn_next").onclick=function(){if(e.phonetrueoffalse==true){h.checkBillCheck=false;h.temrefush=false;h.verdify()}}};a.prototype.getMobileNoTrack=function(i){var h=this;c("#flow_list_wrap").html("");if(h.selectPayType=="0"){c("#Mobile").attr("readonly",true)}else{c("#phone_number").attr("readonly",true)}if((h.systemType==="android"&&h.clientVersion>=403)||(h.systemType==="ios"&&h.clientVersion>=402)){NumberKeyBoard.HidenumKeyboard()}f.callCPSService({service:config.CPS.PHONE_AREA,params:h.mobileNoTrackParams(),showLoading:false,isNoSuccess:h.rmobileNoTrackisNoSuccessCallback,setTime:600000,success:h.rmobileNoTrackSuccessCallback,error:h.mobileNoTrackErrorCallback})};a.prototype.mobileNoTrackParams=function(){var h=this;var i={type:"50",isQryUserInfo:"Y"};if(h.selectPayType=="0"){i.phone=h.phoneNumber}else{i.phone=h.phoneNumber3G}i=f.setCPSCommonParams(i);console.log("手机归属地查询 SPhn004入参======="+JSON.stringify(i));return i};a.prototype.rmobileNoTrackisNoSuccessCallback=function(h){if(e.selectPayType=="0"){c("#loading_phone").hide();c("#Mobile").attr("readonly",false)}else{c("#loading_phone_g").hide();c("#phone_number").attr("readonly",false)}};a.prototype.rmobileNoTrackSuccessCallback=function(j){console.log("手机归属地查询 SPhn004出参========"+JSON.stringify(j));c("#loading_phone").hide();c("#loading_phone_g").hide();c("#payName_parent_img").attr("src","../lib/img/ic_refresh2.png");c("#payamout_parent_img").hide();c("#Mobile").attr("readonly",false);c("#phone_number").attr("readonly",false);if(j.code==="000000"){e.actionName=j.actionName;e.provinceCode=j.actionCode;e.SPhn004custName=j.custName;e.SPhn004amount=j.amount;e.ifrefush=j.ifrefush;e.queryType=j.queryType;if(e.selectPayType=="1"){c("#contactInfo_g").show();if(!e.actionName){c("#contactInfo_g").html(e.ErrorNotice.notice);e.flow_ErrorPhone=false;return}else{c("#contactInfo_g").html(j.provinceName+j.cityName+e.actionName);c("#flowbtn").show();e.flow_ErrorPhone=true;if("1000"===e.provinceCode){e.flow_Data=e.ChinaTelecom_Data;e.orderPageJson.prodCode="00000098";e.orderPageJson.rechargeType_flow=1;c("#tip_change").html("提示 ：<br>1.即时生效，当月结束后失效。<br>2.其中60M、150M、300M自充值之日起90天内有效。")}else{if("3000"===e.provinceCode){e.flow_Data=e.ChinaMobile_Data;e.orderPageJson.prodCode="00000100";e.orderPageJson.rechargeType_flow=2;c("#tip_change").html("提示 ：<br>即时生效，当月结束后失效。")}else{if("2000"===e.provinceCode){e.flow_Data=e.ChinaUnicom_Data;e.orderPageJson.prodCode="00000099";e.orderPageJson.rechargeType_flow=3;c("#tip_change").html("提示 ：<br>即时生效，当月结束后失效。")}}}var m=[];for(var l=0,h=e.flow_Data.length;l<h;l++){m[l]="";m[l]+="<div>"+e.flow_Data[l].M+"</div>";m[l]+='<div class="font14">'+e.flow_Data[l].Y+"</div>"}e.GridList=new g.GridList(m,2);var k=e.GridList.getHTML();document.getElementById("flow_list_wrap").appendChild(k)}}else{c("#contactInfo").show();if(!e.actionName){c("#contactInfo").html(e.ErrorNotice.notice);e.ErrorPhone=false;e.phonetrueoffalse=false}else{c("#contactInfo").html(j.provinceName+j.cityName+e.actionName);e.ErrorPhone=true;e.phonetrueoffalse=true}c("#payName_parent").find("span").html(e.SPhn004custName);c("#payamout_parent").find("span").html(e.SPhn004amount);if(e.SPhn004custName&&e.SPhn004amount&&(e.actionName.indexOf("电信")>0)){c("#payName_amount_parent55").show()}else{c("#payName_amount_parent55").hide()}e.phone_amount.clearValue();console.log("provinceCode=="+e.provinceCode);e.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};if("1000"===e.provinceCode){e.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500","其他金额":"0"};e.phone_amount.clearValue();e.RECHARGETYPE=e.BusiCode.TEL_TELECOM;e.pecProductCode="00000008"}else{if("3000"===e.provinceCode){e.phone_amount.clearValue();e.RECHARGETYPE=e.BusiCode.TEL_MOBILE_QX;e.pecProductCode="00000009";c("#select_amount_list").show();c("#phone_amount").hide()}else{if("2000"===e.provinceCode){e.selectPhoneMoneyList={"30元":"30","50元":"50","100元":"100","300元":"300","500元":"500"};e.phone_amount.clearValue();e.RECHARGETYPE=e.BusiCode.TEL_UNICOM_QX;e.pecProductCode="00000010";c("#select_amount_list").show();c("#phone_amount").hide()}else{e.phone_amount.clearValue();c("#contactInfo").html(e.ErrorNotice.notice);c("#select_amount_list").show();c("#phone_amount").hide();return}}}}}else{c("#loading_phone").hide();c("#loading_phone_g").hide();console.log("ddeeeeeeeeeee");if(e.selectPayType=="0"){c("#contactInfo").show();c("#contactInfo").html(e.ErrorNotice.notice)}else{c("#contactInfo_g").show();c("#contactInfo_g").html(e.ErrorNotice.notice)}}};a.prototype.mobileNoTrackErrorCallback=function(h){if(e.selectPayType=="0"){c("#loading_phone").hide();c("#contactInfo").show();c("#contactInfo").html(e.ErrorNotice.notice);c("#Mobile").attr("readonly",false)}else{c("#loading_phone_g").hide();c("#contactInfo_g").show();c("#contactInfo_g").html(e.ErrorNotice.notice);c("#phone_number").attr("readonly",false)}};a.prototype.alertDoubleBtn=function(l,j,i,h,o,n,m,k){document.getElementById(l).style.display="block";document.getElementById(j).innerHTML=o;document.getElementById(i).innerHTML=n;document.getElementById(i).onclick=function(){m()};document.getElementById(h).onclick=function(){k()}};a.prototype.back1=function(){Bestpay.User.login()};a.prototype.back2=function(){Bestpay.App.exitCompleteApp()};a.prototype.verdify=function(){var h=this;var i=null;var j=h.itMobile.getToEmptyValue();console.log("phoneRechareSelf.ErrorPhone==========================="+e.ErrorPhone);if(j==null||j.length==0){Bestpay.Toast.makeText("请输入手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(j.length>=1&&j.length<11){Bestpay.Toast.makeText("您输入的手机号码长度错误",Bestpay.Toast.LENGTH_SHORT);return}else{if(!e.ErrorPhone){Bestpay.Toast.makeText("请输入正确的手机号码",Bestpay.Toast.LENGTH_SHORT);return}}}h.Recharge_Money=h.brgAmount;if(h.isInputOther==true&&h.phone_amount.getToEmptyValue().length==0){Bestpay.Toast.makeText("请输入5—500元的整数充值金额",Bestpay.Toast.LENGTH_SHORT);return}if(h.other_money&&c("#phone_amount").val().length>0){if(h.other_money<5||h.other_money>500){Bestpay.Toast.makeText("请输入5—500元的整数充值金额",Bestpay.Toast.LENGTH_SHORT);return}h.Recharge_Money=h.other_money}h.itJudgeLocalStorage.checkOrder(h.itMobile.getToEmptyValue(),h.Recharge_Money,f.getCurrentTime(),function(){console.log("123moblie = "+j);console.log("123self.Recharge_Money = "+h.Recharge_Money);console.log("123self.getCurrentTime  = "+f.getCurrentTime());if(h.RECHARGETYPE==h.BusiCode.TEL_TELECOM){h.actionCode=h.BusiCode.TEL_TELECOM}else{h.actionCode=h.phoneNumber}h.getPremium()},h.businessName)};a.prototype.getPremium=function(){var h=this;f.callCPSService({service:config.CPS.PREMIUM_QUERY,params:h.getPremiumQueryParams(),showLoading:false,success:h.getPremiumQuerySuccessCallback})};a.prototype.getPremiumQueryParams=function(){var h=this;var i={actionCode:h.actionCode,faceAmount:b.yuan2fen(h.Recharge_Money),phone:h.phoneNumber,prodCode:"003"};i=f.setCPSCommonParams(i);console.log("溢价查询"+JSON.stringify(i));return i};a.prototype.getPremiumQuerySuccessCallback=function(i){console.log("溢价查询回调----------------->"+JSON.stringify(i));if("000000"==i.code){var j=i.amount;var h=i.concession;e.rechargeAmount=j*1+h*1;console.log("rechargeAmount------------->"+e.rechargeAmount);e.queryStart();e.callQuickTradingQuery();e.defferred.done(e.goPayAnimation)}else{if(config.RES.TOKEN_DISABLE==i.code){dismissDialog();e.alertDoubleBtn("ch_alert","chalertmsg","chAlertBtn","chAlertBackBtn1",e.ErrorNotice.tokenLost,"确定",e.back1,e.back2);return}else{dismissDialog();Bestpay.Dialog.showAlertDialog("提醒",i.content,"确定",i.code,function(){App.exitApp()})}}};a.prototype.callQuickTradingQuery=function(){var h=this;f.callCPSService({service:config.CPS.QUICK_TRADING_QUERY,params:h.quickTradingQueryParams(),showLoading:false,success:h.quickTradingQuerySuccessCallback})};a.prototype.quickTradingQueryParams=function(){var h=this;h.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());var i={};i=f.setCPSCommonParams(i);console.log("免密交易查询接口入参"+JSON.stringify(i));return i};a.prototype.quickTradingQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}console.log("免密交易查询接口出参"+JSON.stringify(h));e.quickTranInfo={perAmount:h.perAmount,allAmount:h.allamount,allTransAction:h.alltransaction};e.handleIsneedpassword()};a.prototype.handleIsneedpassword=function(){var h=this;var j=h.quickTranInfo;var i=b.yuan2fen(h.Recharge_Money);console.log("amount : "+i);console.log("quickTranInfo : "+JSON.stringify(j));if(i*1<=1*j.perAmount&&(i*1+1*j.allTransAction)<=1*j.allAmount){e.noPwd=false}else{e.noPwd=true}e.getCommission()};a.prototype.getCommission=function(){var h=this;var j="";var k="";var i="";if(h.selectPayType=="1"){if(h.verify==1){i="03010020";j="0042";h.pecProductCode="00000033"}else{i="01010165";if(h.verify==4){j="001250";h.pecProductCode="00000098"}else{if(h.verify==5){j="001251";h.pecProductCode="00000099"}else{if(h.verify==6){j="001252";h.pecProductCode="00000100"}}}}k=h.phone_number.getToEmptyValue()}else{if(h.RECHARGETYPE==h.BusiCode.TEL_TELECOM){j=h.BusiCode.TEL_TELECOM}else{j=h.phoneNumber}i=h.RECHARGETYPE;k=h.phoneNumber}console.log("---酬金查询---");f.getCommission(config.BUS_TYPE.BUS_TYPE_TEL,i,j,h.Recharge_Money,function(l){var m=l;if(l.code===config.RES.SUCCESS){m.commission=b.fen2yuan(l.reward)}else{if(l.code===config.CODE.COMMOSSION_ERROR){m.code=config.RES.SUCCESS;m.commission="0.00"}else{m.code=config.RES.UNKNOWN_ERROR;m.content=config.RES.UNKNOWN_ERROR_MSG}}h.orderPageJson.reward=m.commission;h.orderPageJson.supplyCode=m.supplyCode;e.orderPageJson.rewardType="reward";if(e.userInfo.authenStatus=="A02"){if(e.userInfo.hadEpt==1){e.getFinancialProducts()}else{e.fundAccountBalanceInquiry()}}else{e.fundAccountBalanceInquiry()}},false,"",e.pecProductCode,k)};a.prototype.SDiscQuery=function(){var h=this;f.callCPSService({service:config.CPS.SDISCQUERY,params:h.SDiscQueryParams(),showLoading:false,success:h.SDiscQuerySuccessCallback})};a.prototype.SDiscQueryParams=function(){var h=this;var i={rechAmount:b.yuan2fen(h.mTxnAmount),pecProduct:h.orderPageJson.prodCode};i=f.setCPSCommonParams(i);console.log("折价查询SDISCQUERY 入参==");return i};a.prototype.SDiscQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}e.orderPageJson.supplyCode=h.supplyCode;e.orderPageJson.reward=b.fen2yuan(h.discAmount);e.orderPageJson.rewardType="zhejia";if(e.userInfo.authenStatus=="A02"){if(e.userInfo.hadEpt==1){e.getFinancialProducts()}else{e.fundAccountBalanceInquiry()}}else{e.fundAccountBalanceInquiry()}};a.prototype.getFinancialProducts=function(){var h=this;f.callCPSService({service:config.CPS.FINANCIAL_PRODUCTS,params:h.getFinancialProductsParams(),showLoading:false,success:h.getFinancialProductsSuccessCallback})};a.prototype.getFinancialProductsParams=function(){var h=this;var i={};i=f.setCPSCommonParams(i);return i};a.prototype.getFinancialProductsSuccessCallback=function(h){console.log("012进来-------------");if(h.code!==config.RES.SUCCESS){if(h.code==="018888"){e.fundAccountBalanceInquiry();return}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}}console.log("012成功 show  bbb");c("#payfortianyibao").show();console.log("企业理财用户理财产品列表 出参==="+JSON.stringify(h));var k=h.datas;for(var j=0;j<k.length;j++){e.orderPageJson.productId=k[j]["productId"];e.orderPageJson.userId=k[j]["userId"];e.orderPageJson.tyb_amount=b.fen2yuan(k[j]["balance"])}e.fundAccountBalanceInquiry()};a.prototype.fundAccountBalanceInquiry=function(){var h=this;f.callCPSService({service:config.CPS.CCOUNT_BALANCE_QUERY,params:h.fundAccountBalanceInquiryParams(),showLoading:false,success:h.fundAccountBalanceInquirySuccessCallback})};a.prototype.fundAccountBalanceInquiryParams=function(){var h=this;var i={bankMode:h.userInfo.bankMode};i=f.setCPSCommonParams(i);console.log("资金账户余额查询 SAcc003入参======="+JSON.stringify(i));return i};a.prototype.fundAccountBalanceInquirySuccessCallback=function(u){if(u.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",u.content,"确定",u.code);return}console.log("资金账户余额查询 SAcc003出参======="+JSON.stringify(u));var s=u.dayLimit;var j=u.dayTotal;var l=s*1-j*1;var h=u.monthLimit;var o=u.monthTotal;var n=h*1-o*1;var q=u.motherBoard;var p=u.accountItems;for(var m=0;m<p.length;m++){var r=p[m]["acctType"];if(r!=null||r!="null"||r!="undefined"||r!=""){if("0007"==r){var k=p[m].activeBalance;e.orderPageJson.jfy_amount=b.fen2yuan(k);console.log("普通卡＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+e.orderPageJson.jfy_amount);break}}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===e.userInfo.bankMode){var t="";if(s==="0"){t=q}else{if(q>l){t=l}else{t=q}}if(h==="0"){t=q}else{if(q>n){t=n}else{t=q}}e.orderPageJson.jfy_amount=b.fen2yuan(t);console.log("子卡＝＝＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+e.orderPageJson.jfy_amount)}console.log("啊＝＝＝＝phoneRechareSelf.orderPageJson['jfy_amount']=="+e.orderPageJson.jfy_amount);if(e.selectPayType=="0"){e.initConfirm();e.queryEnd()}else{e.getVerifyResp()}};a.prototype.queryStart=function(){var h=this;h.defferred=c.Deferred();showDialog(config.MSG.loading)};a.prototype.queryEnd=function(){var h=this;console.log(JSON.stringify(h.orderPageJson));var i={businessName:h.businessName,accountName:"手机充值",accouontValue:h.orderPageJson.phone,rechargeMoney:h.orderPageJson.rechargeMoney,rewardType:h.orderPageJson.rewardType,rewardMoney:h.orderPageJson.reward,jfyBalance:h.orderPageJson.jfy_amount,tybBalance:h.orderPageJson.tyb_amount,enablePassword:h.noPwd,userInfo:h.userInfo,callback:h.gotoOrder};console.log("pluginParam = "+JSON.stringify(i));h.paymentPlugin=new g.paymentPlugin(i);dismissDialog();goTo(config.page.comfirm,function(){});h.defferred.resolve()};a.prototype.goPayAnimation=function(){console.log("done=========================");c("#order_comfirm").removeClass("backPayAnimation").addClass("goPayAnimation")};a.prototype.initConfirm=function(){var i=this;console.log("订单页面初始化");i.orderPageJson.phone=i.itMobile.getValue();var l=i.SPhn004custName;var j=i.SPhn004amount;var k=i.ifrefush;var h=i.queryType;console.log("custName=="+l);console.log("amount=="+j);i.orderPageJson.name=i.SPhn004custName;i.orderPageJson.bill=i.SPhn004amount;if(i.selectPayType=="0"){i.orderPageJson.rechargeMoney=(i.Recharge_Money*1).toFixed(2)}else{console.log("订单页面初始化");i.orderPageJson.phone_number=i.phone_number.getToEmptyValue();i.orderPageJson.phone=i.phone_number.getValue();var l=i.SPhn004custName;var j=i.SPhn004amount;var k=i.ifrefush;var h=i.queryType;i.orderPageJson.rechargeMoney=(i.mTxnAmount*1).toFixed(2)}i.orderPageJson.gather=(i.rechargeAmount/100).toFixed(2)};a.prototype.gotoOrder=function(i){var h=this;f.getRandomServices(function(j){var k=j;if(j.code===config.RES.SUCCESS){e.random=j.randNum}if(e.selectPayType=="0"){e.rechargeResp(i)}else{if(e.selectPayType=="1"){console.log("verify================="+e.verify);if(e.verify>=4){e.flowRecharge(i)}else{e.rechargeResp_g(i)}}}},false)};a.prototype.rechargeResp=function(i){var h=this;f.callCPSService({service:config.CPS.PHONE_CHARGE,params:h.rechargeParams(i),showLoading:true,success:h.rechargeSuccessCallback,error:h.rechargeErrorCallback})};a.prototype.rechargeParams=function(k){var h=this;var i="";if(k!=null&&k!=""){i=k}var j={payPassword:Bestpay.Security.encryptPassword(h.userInfo.staffCode,i,h.random),phone:h.phoneNumber,rechargeAmount:b.yuan2fen(h.Recharge_Money),rechargeType:h.RECHARGETYPE,tradeTime:b.getDate_YYYYMMDD()+""+b.getTime_HHMMSS(),txnAmount:h.rechargeAmount,supplyCode:h.orderPageJson.supplyCode};if(e.userInfo.hadEpt==1){j.costWay=h.paymentPlugin.getPayType();j.productId=h.productId;j.userId=h.orderPageJson.userId;console.log("self.orderPageJson['userId']"+h.orderPageJson.userId)}j=f.setCPSCommonParams(j);console.log("千行手机充值接口 入参======="+JSON.stringify(j));return j};a.prototype.rechargeSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back()});return}if(h.code=="009002"||h.code=="006751"){e.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(config.ResultMSG[h.code]!=null){Bestpay.Dialog.showAlertDialog("处理失败",config.ResultMSG[h.code],"确定",h.code,function(){back()});return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp()})}else{Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back()})}return}if(e.phoneNumber.length>0){f.sendSmsCertificate(h.transSeq,e.phoneNumber,"")}e.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);console.log("phoneRechareSelf.payType=="+e.payType);if(e.payType=="1"){console.log("tianyibao pay ABC");App.updateTybRereshFlag();console.log("tianyibao pay ABC222")}config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};a.prototype.rechargeErrorCallback=function(h){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","账号余额不足","确定",config.RES.MONEY_NOT_ENOUGH,function(){back()});return}};a.prototype.validation=function(){var i=this;var h=this.phone_number.getToEmptyValue();var k=b.getPhoneOperators(h);console.log("phone_val=="+h);if(h.length==0){Bestpay.Toast.makeText("手机号不能为空！",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.length>0&&(h.length<11||h.length>11)){Bestpay.Toast.makeText("您输入的手机号码长度错误！",Bestpay.Toast.LENGTH_SHORT);return}else{if(!e.flow_ErrorPhone){Bestpay.Toast.makeText("请输入正确的手机号码",Bestpay.Toast.LENGTH_SHORT);return}}}var j=i.GridList.getIndex();if("1000"===i.provinceCode){if(j=="2"||j=="4"||j=="6"){i.verify=1}else{i.verify=4}}else{if("3000"===i.provinceCode){i.verify=6}else{if("2000"===i.provinceCode){i.verify=5}}}console.log("index========"+j);console.log("provinceCode========"+i.provinceCode);console.log("verify========"+i.verify);i.mTxnAmount=(i.flow_Data[j].Y).replace("元","");i.Recharge_Money=i.mTxnAmount;i.itJudgeLocalStorage.checkOrder(h,i.Recharge_Money,f.getCurrentTime(),function(){i.queryStart();i.callQuickTradingQuery();e.defferred.done(e.goPayAnimation)},i.businessName)};a.prototype.getVerifyResp=function(){var h=this;f.callCPSService({service:config.CPS.RECHARE_ACCOUNT_VERIFY,params:h.getVerifyRespParams(),showLoading:false,success:h.getVerifyRespSuccessCallback})};a.prototype.getVerifyRespParams=function(){var h=this;var i={verify:h.verify,acctCode:this.phone_number.getToEmptyValue(),reamount:b.yuan2fen(this.mTxnAmount),acceptDate:b.getDate_YYYYMMDD(),acceptTime:b.getTime_HHMMSS()};i=f.setCPSCommonParams(i);console.log("账号验证 入参======="+JSON.stringify(i));return i};a.prototype.getVerifyRespSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog(config.TITLE.dialog_title,h.content,"确定",h.code);return}var i=e.GridList.getIndex();e.orderPageJson.content=h.content;e.orderPageJson.systemNo=h.systemNo;e.orderPageJson.tradeSeq=h.tradeSeq;e.orderPageJson.flag=h.flag;e.orderPageJson.custName=h.custName;e.orderPageJson.amount=h.amount;e.orderPageJson.queryType=h.queryType;e.orderPageJson.flow=e.flow_Data[i].V;e.orderPageJson.mTxnAmount=(e.mTxnAmount*1).toFixed(2);e.orderPageJson.phone_number=e.phone_number.getToEmptyValue();e.initConfirm();e.queryEnd()};a.prototype.rechargeResp_g=function(i){var h=this;f.callCPSService({service:config.CPS.FLOW_3G_CARD,params:h.rechargeParams_g(i),showLoading:true,success:h.rechargeSuccessCallback_g})};a.prototype.rechargeParams_g=function(k){var h=this;var i="";if(k!=null&&k!=""){i=k}var j={orderNo:f.getOrderSeq(),phone:h.orderPageJson.phone_number,rechargeFlow:h.orderPageJson.flow,rechargeType:"001",verify:"01",payPassword:Bestpay.Security.encryptPassword(h.userInfo.staffCode,i,h.random),systemNO:h.orderPageJson.systemNo,tradeTime:b.getDate_YYYYMMDD()+""+b.getTime_HHMMSS(),txnAmount:b.yuan2fen(h.orderPageJson.mTxnAmount)};if(h.userInfo.hadEpt.toString()=="1"){j.costWay=h.paymentPlugin.getPayType();j.productId=h.productId;j.userId=h.orderPageJson.userId}j=f.setCPSCommonParams(j);return j};a.prototype.rechargeSuccessCallback_g=function(h){if(h.code!==config.RES.SUCCESS){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){e.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp();e.itJudgeLocalStorage.putLocalValue("","","","")})}Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}e.itJudgeLocalStorage.putLocalValue("","","","");f.sendSmsCertificate(h.transSeq,e.orderPageJson.phone_number,"");e.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};a.prototype.flowRecharge=function(i){var h=this;f.callCPSService({service:config.CPS.FLOW_RECHARGE,params:h.flowRechargeParams(i),showLoading:true,success:h.flowRechargeSuccessCallback})};a.prototype.flowRechargeParams=function(k){var h=this;var i="";if(k!=null&&k!=""){i=k}var j={orderNo:f.getOrderSeq(),phone:h.orderPageJson.phone_number,rechargeFlow:h.orderPageJson.flow,rechargeType:h.orderPageJson.rechargeType_flow,payPassword:Bestpay.Security.encryptPassword(h.userInfo.staffCode,i,h.random),systemNO:h.orderPageJson.systemNo,tradeTime:b.getDate_YYYYMMDD()+""+b.getTime_HHMMSS(),txnAmount:b.yuan2fen(h.orderPageJson.mTxnAmount),prodCode:h.orderPageJson.prodCode,actionCode:"01010165",supplyCode:h.orderPageJson.supplyCode};if(h.userInfo.hadEpt.toString()=="1"){j.costWay=h.paymentPlugin.getPayType();j.productId=h.productId;j.userId=h.orderPageJson.userId}j=f.setCPSCommonParams(j);return j};a.prototype.flowRechargeSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code===config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.RES.MONEY_NOT_ENOUGH_MSG,"确定",h.code,function(i){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){e.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.float_dia);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){App.exitCompleteApp();e.itJudgeLocalStorage.putLocalValue("","","","")})}Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,h.content,"确定",h.code,function(){back();e.itJudgeLocalStorage.putLocalValue("","","","")});return}e.itJudgeLocalStorage.putLocalValue("","","","");f.sendSmsCertificate(h.transSeq,e.orderPageJson.phone_number,"");e.paymentPlugin.setOrderDisplay("success");goTo(config.page.float_dia);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};return a});