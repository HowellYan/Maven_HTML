define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(g,d,f,c){var b=null;var a=document;function e(){b=this;this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());this.random=null;this.orderPageJson={};this.itMobile=null;this.ipPassword="";this.quickTranInfo={};this.witchOrderPage=null;this.rewardParam={};this.rechargeMoney=[];this.successJson={};this.supportGameList={};this.gameNameParam={};this.gameOrderJson={productCode:null,prodCode:null,gameId:null,payMoney:null,gameServer:null,gameServerId:null,otherCount:false,accountType:""};this.gameServerParam={};this.gameCountParam={};this.payTypeParam={};this.gameServerList={};this.gameServerListParam={};this.serverListParam={};this.dialogSelectDefult={gameName:0,gameServer:0,gameCount:0};this.gameAccount=null;this.zwAccount=null;this.GameRechargeNUM=null;this.pay_other_count_val=null;this.goType="zc";this.payType="0";this.checkBillCheck=false;this.GameRechargeData={};this.productId="0030001";this.second=false;this.deffered=null;this.paymentPlugin=null;this.businessName="游戏直充"}e.prototype.initApp=function(){var h=this;h.itJudgeLocalStorage=new d.JudgeLocalStorage();h.gameNameListQuery();goTo(config.page.main,function(){console.log("--------------start--------------");h.btnInit()})};e.prototype.btnInit=function(){var h=this;h.itMobile=new d.InputText("mobile_zc","mobile");h.itMobile_dk=new d.InputText("mobile_dk","mobile");var i=function(j){if(j=="zc"){h.businessName="游戏直充";h.goType="zc";h.gameNameListQuery();g("#yxzc").show();g("#game_card_info").hide();g("#game_username_show").show();g("#cardType").hide()}else{if(j=="dk"){h.businessName="游戏点充";h.goType="dk";h.resetCard();g("#yxzc").hide();g("#game_card_info").show();g("#game_username_show").hide();g("#cardType").show();h.itMobile_dk.clearValue()}}};h.selectType=new d.BlockRadioGroup("brg_amount","game_pay",i);a.getElementById("btn_next").onclick=function(){if(!h.gameOrderJson.prodCode){Bestpay.Toast.makeText("请选择一个游戏",Bestpay.Toast.LENGTH_SHORT);return}else{if(!h.gameAccount.getToEmptyValue()){Bestpay.Toast.makeText("请输入游戏账号",Bestpay.Toast.LENGTH_SHORT);return}}goTo(config.page.game_pay,function(){h.itMobile.clearValue()})};a.getElementById("paybill_zc").onclick=function(){h.validation()};a.getElementById("confirm_buy").onclick=function(){h.mobile_val=h.itMobile_dk.getToEmptyValue();if(h.mobile_val.length>=1&&h.mobile_val.length<11){Bestpay.Toast.makeText("请输入11位的顾客手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.mobile_val.length==11&&!h.itMobile_dk.getInputCheck()){Bestpay.Toast.makeText("您输入的手机号号码段不正确",Bestpay.Toast.LENGTH_SHORT);return}}h.orderPageJson.game_name="游戏点卡";h.orderPageJson.game_username="天下通卡";h.itJudgeLocalStorage.checkOrder(h.orderPageJson.game_username,h.gameOrderJson.payMoney*1,c.getCurrentTime(),function(){h.gotoCardRecharge()},h.businessName)};a.getElementById("card_pay_select_box").onclick=function(){goTo(config.page.card_pay_prompt,function(){});var j=new d.dropDownBox("card_pay_select",this,{"10元":"10","30元":"30","50元":"50","100元":"100"},function(l,k){j.hideDropDownBox();h.gameOrderJson.payMoney=l;var m=g(k).text();g("#card_pay_select_box_val").html(m);back()},function(){j.hideDropDownBox();back()})}};e.prototype.gotoCardRecharge=function(){showDialog(config.MSG.loading);config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_CARD;var h=this;h.witchOrderPage="card";h.rewardParam.BUS_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_CARD;h.rewardParam.BUS_CODE=config.BUS_CODE.ELE_CARD;b.rewardParam.productCode="";h.queryStart();h.callQuickTradingQuery();h.defferred.done(h.goPayAnimation)};e.prototype.gotoGamePay=function(){config.TRADE_LIST_QUERY_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_DIRECT;var j=this;j.witchOrderPage="recharge";dismissDialog();j.gameAccount=new d.InputText("game_username_val",null,function(k){if(j.GameRechargeNUM=="03010100"){j.gameAccount.setValue(k.replace(/[^0-9]+/,""))}});j.zwAccount=new d.InputText("zw_val");var i=function(){g("#pay_money").hide();g("#tip3").hide();j.gameOrderJson.payMoney=0;j.gameOrderJson.input_val="";console.log("self.gameOrderJson['payMoney']===="+j.gameOrderJson.payMoney);console.log(" typeof==="+typeof j.gameOrderJson.payMoney);console.log(" boolean==="+!!j.gameOrderJson.payMoney)};var h=function(){};j.pay_other_count_val=new d.InputText("pay_other_count_val","number",h,i);j.resetPage();j.dialogSelectDefult.gameName=0;j.dialogSelectDefult.gameCount=0;j.dialogSelectDefult.gameServer=0;j.dialogSelectDefult.payType=0;j.gamePayBtnInit()};e.prototype.resetPage=function(i){var h=this;var j=i||"请选择";h.gameOrderJson={};h.gameCountParam={};h.payTypeParam={};h.dialogSelectDefult.gameName=0;h.gameServerParam.searchType=null;g("#game_name_val").html(j);h.gameAccount.clearValue();h.zwAccount.clearValue();g("#game_area_val").html("请选择");g("#game_server_val").html("请选择");g("#pay_type_val").html("请选择");g("#game_area").hide();g("#pay_count_val").html("请选择");g("#pay_money").hide();g("#zw_username").hide();g("#game_server").hide();g("#pay_type").hide();g("#pay_other_count").hide();g("#pay_other_count_val").val("");b.fwq=null;g("#pay_money_val").html("0.00元");b.gameOrderJson.payMoney=0;g("#tip3").hide();h.gameOrderJson.input_val=""};e.prototype.resetCard=function(){var h=this;h.gameOrderJson.payMoney=50;g("#card_pay_select_box_val").html("50元")};e.prototype.gamePayBtnInit=function(){var h=this;a.getElementById("game_name").onclick=function(i){g("#page_select_bank").html("");goTo(config.page.select_bank);var j=new d.dropDownBox("page_select_bank",this,h.gameNameParam,function(k,l){j.clearDropDownBox();var m=g(l).text();b.GameRechargeNUM=null;b.qb=false;if(m=="Q币"||m=="测试大小区服"){console.log(m+"=======================================");b.GameRechargeNUM="03010100";if(m=="Q币"){b.qb=true}}h.resetPage(m);h.dialogSelectDefult.gameName=k;h.dialogSelectDefult.gameCount=0;h.dialogSelectDefult.gameServer=0;h.gameOrderJson.prodCode=h.supportGameList[k].productCode;h.gameOrderJson.gameId=h.supportGameList[k].gameId;b.gameDetailQuery();back()},function(){j.hideDropDownBox();back()})};a.getElementById("pay_count").onclick=function(){if(!h.gameOrderJson.prodCode){Bestpay.Toast.makeText("请选择一个游戏",Bestpay.Toast.LENGTH_SHORT);return false}g("#page_select_bank").html("");goTo(config.page.select_bank);var i=new d.dropDownBox("page_select_bank",this,h.gameCountParam,function(m,l){var n=b.rechargeMoney[m];var o=g(l).text();g("#tip3").hide();h.dialogSelectDefult.gameCount=m;if(m==(b.gameCountParamLen+1)){g("#pay_other_count").show();h.pay_other_count_val.clearValue();h.gameOrderJson.payMoney=0;g("#pay_money").hide();h.gameOrderJson.otherCount=true;var j=", "+h.gameOrderJson.errorInfo+"的倍数";var k=h.gameOrderJson.minAmount+"-"+h.gameOrderJson.maxAmount+j;a.getElementById("pay_other_count_val").placeholder=k;g("#pay_other_count_val").on("input",function(){var q=!h.pay_other_count_val.getValue()?0:h.pay_other_count_val.getValue();var p=null;g("#tip3").hide();h.gameOrderJson.payMoney=h.gameOrderJson.unitPrice*q;h.gameOrderJson.input_val=q;console.log(h.gameOrderJson.unitPrice);console.log(q);console.log("payMoney==========="+h.gameOrderJson.payMoney);console.log("input_val==========="+h.gameOrderJson.input_val);console.log("%%======="+h.gameOrderJson.input_val%h.gameOrderJson.errorInfo);p=h.gameOrderJson.payMoney.toFixed(2);g("#pay_money_val").html(p);g("#pay_money").show()})}else{h.gameOrderJson.otherCount=false;h.gameOrderJson.payMoney=n;g("#pay_money_val").html(n+".00");g("#pay_other_count").hide();g("#pay_money").show()}g("#pay_count_val").html(o);i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})};a.getElementById("pay_type").onclick=function(){g("#page_select_bank").html("");goTo(config.page.select_bank);var i=new d.dropDownBox("page_select_bank",this,h.payTypeParam,function(j,k){var l=g(k).text();g("#pay_type_val").html(l);h.dialogSelectDefult.payType=j;h.gameOrderJson.accountType=j*1+1;i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})}};e.prototype.gameNameListQuery=function(){showDialog(config.MSG.loading);var h=this;c.callCPSService({service:config.CPS.GAME_LIST,params:h.gameNameQueryParams(),showLoading:false,success:h.gameNameQuerySuccessCallback})};e.prototype.gameNameQueryParams=function(){var h=this;var i={};i=c.setCPSCommonParams(i);return i};e.prototype.gameNameQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}b.supportGameList=h.supportGameList;h.supportGameList.forEach(function(j,k){var i=j.gameName;b.gameNameParam[i]=k});b.gotoGamePay()};e.prototype.gameDetailQuery=function(){var h=this;c.callCPSService({service:config.CPS.GAME_INFO,params:h.gameDetailQueryParams(),showLoading:true,success:h.gameDetailQuerySuccessCallback})};e.prototype.gameDetailQueryParams=function(){var h=this;var i={prodCode:h.gameOrderJson.prodCode};i=c.setCPSCommonParams(i);return i};e.prototype.gameDetailQuerySuccessCallback=function(m){if(m.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",m.content,"确定",m.code);return}console.log("gameDetail:"+JSON.stringify(m));b.gameOrderJson.supplyCode=m.supplyCode;b.gameOrderJson.unitPrice=f.fen2yuan(m.unitPrice);b.gameOrderJson.minAmount=m.minAmount;b.gameOrderJson.maxAmount=m.maxAmount;b.gameOrderJson.errorInfo=m.errorInfo;b.gameOrderJson.valInput=m.valInput;var l=m.rechargeQuantity.split(",");l.forEach(function(n,o){b.gameCountParam[n]=o;b.gameCountParamLen=o});b.gameCountParam["其他数量"]=b.gameCountParamLen+1;console.log(JSON.stringify(b.gameCountParam));b.rechargeMoney=m.rechargeMoney.split(",");g("#game_area").hide();g("#orderServer_comfirm").hide();console.log("prodCode="+b.gameOrderJson.prodCode);if(b.gameOrderJson.prodCode==="00000017"){g("#zw_username").show()}if(!!m.rechargeType){g("#pay_type").show();b.gameOrderJson.isPayType=true;var h=m.rechargeType.split(",");for(var i=0,k=h.length;i<k;i++){var j=h[i].split(":");b.payTypeParam[j[1]]=i}console.log("payTypeParam=="+JSON.stringify(b.payTypeParam))}b.gameType=m.gameType;if(m.gameType==2){b.gameServerParam.searchType=1;b.gameServerQuery();g("#game_area").show()}if(m.gameType==3){b.gameServerParam.searchType=2;b.gameServerQuery();g("#game_area").show();g("#game_server").show()}};e.prototype.gameServerQuery=function(){var h=this;c.callCPSService({service:config.CPS.GAME_SERVER,params:h.gameServerQueryParams(),showLoading:true,success:h.gameServerQuerySuccessCallback})};e.prototype.gameServerQueryParams=function(){var h=this;var i={prodCode:h.gameOrderJson.prodCode,gameServerId:h.gameOrderJson.gameServer,searchType:h.gameServerParam.searchType,supplyCode:h.gameOrderJson.supplyCode};i=c.setCPSCommonParams(i);return i};e.prototype.gameServerQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}console.log("serverQuery:"+JSON.stringify(h));b.gameServerList=h.gameServerList;b.gameServerListParam={};h.gameServerList.forEach(function(k,j){var i=k.gameServerName;b.gameServerListParam[i]=j});if(b.second){b.gameServerListParam_xiao={};h.gameServerList.forEach(function(l,k){var i=l.gameServerName;var j=l.gameServerValue;b.gameServerListParam_xiao[i]=j})}else{b.gameServerListParam_da=b.gameServerListParam;b.gameServerList_da=h.gameServerList}console.log("游戏区服查询接口 出参"+JSON.stringify(b.gameServerList));a.getElementById("game_area").onclick=function(){g("#page_select_bank").html("");goTo(config.page.select_bank);var i=new d.dropDownBox("page_select_bank",this,b.gameServerListParam_da,function(j,k){var l=g(k).text();g("#game_area_val").html(l);b.gameOrderJson.gameServer=b.gameServerList_da[j].gameServerValue;if(b.gameServerParam.searchType==2){var m=l.replace("区","号服务器");b.gameServerQuery();b.gameOrderJson.gameServerId=null;g("#game_server_val").html("请选择");b.second=true}i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})};a.getElementById("game_server").onclick=function(){if(!!b.gameServerParam.searchType&&!b.gameOrderJson.gameServer){Bestpay.Toast.makeText("请选择一个大区",Bestpay.Toast.LENGTH_SHORT);return}g("#page_select_bank").html("");goTo(config.page.select_bank);var i=new d.dropDownBox("page_select_bank",this,b.gameServerListParam_xiao,function(j,k){var l=g(k).text();g("#game_server_val,#game_area_order_server").html(l);b.gameOrderJson.gameServerId=j;console.error(" gameServerId:"+b.gameOrderJson.gameServerId);b.fwq=true;i.clearDropDownBox();back()},function(){i.hideDropDownBox();back()})}};e.prototype.validation=function(){var h=this;if(b.qb&&(h.gameAccount.getToEmptyValue().length<5)){Bestpay.Toast.makeText("请检查输入的充值号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.isPayType&&!h.gameOrderJson.accountType){Bestpay.Toast.makeText("请选择充值方式",Bestpay.Toast.LENGTH_SHORT);return}else{if(!!h.gameServerParam.searchType&&!h.gameOrderJson.gameServer){Bestpay.Toast.makeText("请选择一个大区",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameType=="3"&&!h.gameOrderJson.gameServerId){Bestpay.Toast.makeText("请选择游戏服务器",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.prodCode=="00000017"&&!h.zwAccount.getValue()){Bestpay.Toast.makeText("请输入网战账号",Bestpay.Toast.LENGTH_SHORT);return}else{if(!h.gameOrderJson.otherCount&&!(h.gameOrderJson.payMoney*1)){Bestpay.Toast.makeText("请选择充值数量",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.otherCount&&!h.gameOrderJson.input_val){Bestpay.Toast.makeText("请填写充值数量",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.gameOrderJson.otherCount&&(h.gameOrderJson.input_val*1<h.gameOrderJson.minAmount*1||h.gameOrderJson.input_val*1>h.gameOrderJson.maxAmount*1)){console.log("范围不对");g("#tip3").show();return}else{if(h.gameOrderJson.otherCount&&((h.gameOrderJson.input_val%h.gameOrderJson.errorInfo)>0)){console.log("倍数不对");g("#tip3").show();return}}}}}}}}}h.mobile_val=h.itMobile.getToEmptyValue();if(h.mobile_val.length>=1&&h.mobile_val.length<11){Bestpay.Toast.makeText("请输入11位的顾客手机号码",Bestpay.Toast.LENGTH_SHORT);return}else{if(h.mobile_val.length==11&&!h.itMobile.getInputCheck()){Bestpay.Toast.makeText("您输入的手机号号码段不正确",Bestpay.Toast.LENGTH_SHORT);return}}h.rewardParam.BUS_TYPE=config.BUS_TYPE.BUS_TYPE_GAME_DIRECT;h.rewardParam.BUS_CODE=config.BUS_CODE.GAME_DIRECT;h.initConfirm()};e.prototype.initConfirm=function(){var h=this;if(b.witchOrderPage=="recharge"){if(h.gameOrderJson.prodCode=="00000017"){h.gameOrderJson.account=h.zwAccount.getValue();h.gameOrderJson.subAccount=h.gameAccount.getToEmptyValue()}else{h.gameOrderJson.account=h.gameAccount.getToEmptyValue();h.gameOrderJson.subAccount=h.zwAccount.getValue()}b.orderPageJson.game_name=g("#game_name_val").html();b.orderPageJson.game_username=h.gameAccount.getToEmptyValue();b.orderPageJson.game_area=g("#game_area_val").html();if(b.gameOrderJson.otherCount){b.orderPageJson.pay_count=b.gameOrderJson.input_val}else{b.orderPageJson.pay_count=g("#pay_count_val").html()}b.orderPageJson.pay_money=g("#pay_money_val").html();console.log("订单:"+JSON.stringify(b.orderPageJson))}h.itJudgeLocalStorage.checkOrder(h.gameOrderJson.account,h.orderPageJson.pay_money*1,c.getCurrentTime(),function(){h.queryStart();h.callQuickTradingQuery();h.defferred.done(h.goPayAnimation)},h.businessName)};e.prototype.gotoOrder=function(h){c.getRandomServices(function(j){var i=j;if(j.code===config.RES.SUCCESS){b.random=j.randNum}b.gotoRecharge(h)},false)};e.prototype.queryStart=function(){var h=this;h.defferred=g.Deferred();showDialog()};e.prototype.queryEnd=function(){var h=this;var i={businessName:h.businessName,accountName:"游戏充值",accouontValue:h.orderPageJson.game_username,rechargeMoney:h.gameOrderJson.payMoney,rewardType:h.orderPageJson.rewardType,rewardMoney:h.orderPageJson.reward,jfyBalance:h.orderPageJson.jfy_amount,tybBalance:h.orderPageJson.tyb_amount,enablePassword:h.noPwd,userInfo:h.userInfo,callback:h.gotoOrder};console.log("pluginParam = "+JSON.stringify(i));h.paymentPlugin=new d.paymentPlugin(i);dismissDialog();goTo(config.page.comfirm,function(){});h.defferred.resolve()};e.prototype.goPayAnimation=function(){console.log("done=========================");g("#order_comfirm").removeClass("backPayAnimation").addClass("goPayAnimation")};e.prototype.getCommission=function(){var h=this;console.error("payMoney:"+h.gameOrderJson.payMoney);c.getCommission(b.rewardParam.BUS_TYPE,b.rewardParam.BUS_CODE,b.gameOrderJson.prodCode,h.gameOrderJson.payMoney,function(j){var i=j;console.error("result:"+JSON.stringify(j));if(j.code===config.RES.SUCCESS){i.commission=f.fen2yuan(j.reward)}else{if(j.code===config.CODE.COMMOSSION_ERROR){i.code=config.RES.SUCCESS;i.commission="0.00"}else{i.code=config.RES.UNKNOWN_ERROR;i.content=config.RES.UNKNOWN_ERROR_MSG}}b.gameOrderJson.supplyCode=i.supplyCode;b.orderPageJson.reward=i.commission;b.orderPageJson.rewardType="reward";b.queryEnd()},false)};e.prototype.SDiscQuery=function(){var h=this;c.callCPSService({service:config.CPS.SDISCQUERY,params:h.SDiscQueryParams(),showLoading:false,success:h.SDiscQuerySuccessCallback})};e.prototype.SDiscQueryParams=function(){var h=this;var i={rechAmount:f.yuan2fen(h.gameOrderJson.payMoney),pecProduct:h.gameOrderJson.prodCode,supplyCode:h.gameOrderJson.supplyCode||""};i=c.setCPSCommonParams(i);console.log("折价查询SDISCQUERY 入参==");return i};e.prototype.SDiscQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}b.gameOrderJson.supplyCode=h.supplyCode;b.orderPageJson.reward=f.fen2yuan(h.discAmount);b.orderPageJson.rewardType="zhejia";b.queryEnd()};e.prototype.callQuickTradingQuery=function(){var h=this;c.callCPSService({service:config.CPS.QUICK_TRADING_QUERY,params:h.quickTradingQueryParams(),showLoading:false,success:h.quickTradingQuerySuccessCallback})};e.prototype.quickTradingQueryParams=function(){var h=this;var i={};i=c.setCPSCommonParams(i);return i};e.prototype.quickTradingQuerySuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code);return}b.quickTranInfo={perAmount:h.perAmount,allamount:h.allamount,alltransaction:h.alltransaction};b.handleIsneedpassword()};e.prototype.handleIsneedpassword=function(){var j=this;var i=b.quickTranInfo;var h=f.yuan2fen(j.gameOrderJson.payMoney);console.log("amount : "+h);console.log("quickTranInfo : "+JSON.stringify(i));if(h*1<=1*i.perAmount&&(h*1+1*i.alltransaction)<=1*i.allamount){b.noPwd=false}else{b.noPwd=true}console.log("self.userInfo.authenStatus=="+j.userInfo.authenStatus);if(j.userInfo.authenStatus=="A02"){console.log("self.userInfo.hadEpt  "+j.userInfo.hadEpt);if(j.userInfo.hadEpt==1){j.getFinancialProducts()}else{j.fundAccountBalanceInquiry()}}else{j.fundAccountBalanceInquiry()}};e.prototype.getFinancialProducts=function(){var h=this;c.callCPSService({service:config.CPS.FINANCIAL_PRODUCTS,params:h.getFinancialProductsParams(),showLoading:false,success:h.getFinancialProductsSuccessCallback})};e.prototype.getFinancialProductsParams=function(){var h=this;var i={};i=c.setCPSCommonParams(i);return i};e.prototype.getFinancialProductsSuccessCallback=function(j){if(j.code!==config.RES.SUCCESS){if(j.code==="018888"){b.fundAccountBalanceInquiry();return}else{Bestpay.Dialog.showAlertDialog("提醒",j.content,"确定",j.code);return}}g("#payfortianyibao").show();var i=j.datas;for(var h=0;h<i.length;h++){b.orderPageJson.productId=i[h]["productId"];b.orderPageJson.userId=i[h]["userId"];b.orderPageJson.tyb_amount=f.fen2yuan(i[h]["balance"])}b.fundAccountBalanceInquiry()};e.prototype.fundAccountBalanceInquiry=function(){var h=this;c.callCPSService({service:config.CPS.CCOUNT_BALANCE_QUERY,params:h.fundAccountBalanceInquiryParams(),showLoading:false,success:h.fundAccountBalanceInquirySuccessCallback})};e.prototype.fundAccountBalanceInquiryParams=function(){var h=this;var i={bankMode:h.userInfo.bankMode};i=c.setCPSCommonParams(i);return i};e.prototype.fundAccountBalanceInquirySuccessCallback=function(p){var j=this;if(p.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",p.content,"确定",p.code);return}console.log("资金账户余额查询 SAcc003出参======="+JSON.stringify(p));var h=p.dayLimit;var t=p.dayTotal;var k=h*1-t*1;var r=p.monthLimit;var n=p.monthTotal;var m=r*1-n*1;var q=p.motherBoard;var o=p.accountItems;for(var l=0;l<o.length;l++){var s=o[l]["acctType"];if(s!=null||s!="null"||s!="undefined"||s!=""){if("0007"==s){var u=o[l].activeBalance;b.orderPageJson.jfy_amount=f.fen2yuan(u);break}}}if(config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD===b.userInfo.bankMode){var i="";if(h==="0"){i=q}else{if(q>k){i=k}else{i=q}}if(r==="0"){i=q}else{if(q>m){i=m}else{i=q}}b.orderPageJson.jfy_amount=f.fen2yuan(i);console.log("子卡==GameRechargeSelf.orderPageJson['jfy_amount']=="+b.orderPageJson.jfy_amount)}console.log(b.goType);if(b.goType==="zc"){b.SDiscQuery()}else{if(b.goType==="dk"){b.getCommission()}}};e.prototype.gotoRecharge=function(h){c.getRandomServices(function(j){var i=j;if(j.code===config.RES.SUCCESS){b.random=j.randNum}console.log("witchOrderPage== "+b.witchOrderPage);if(b.witchOrderPage=="recharge"){b.rechargeResp(h)}if(b.witchOrderPage=="card"){b.cardResp(h)}},false)};e.prototype.cardResp=function(i){config.isBack=function(){back()};var h=this;c.callCPSService({service:config.CPS.ELECTRONIC_SELL_CARD,params:h.cardParams(i),showLoading:true,success:h.cardSuccessCallback,error:h.cardErrorCallback})};e.prototype.cardParams=function(i){var j=this;var k="";if(i!=null&&i!=""){k=i}var h={payPassword:Bestpay.Security.encryptPassword(j.userInfo.staffCode,k,j.random),cardAmount:f.yuan2fen(j.gameOrderJson.payMoney),cardTypeCode:"2003",payType:"0",tradeTime:f.getDate_YYYYMMDD()+""+f.getTime_HHMMSS(),orderNo:f.getDate_YYYYMMDD()+""+f.getTime_HHMMSS()+""+new Date().getMilliseconds()};if(j.mobile_val.length>0){h.phone=j.mobile_val}else{h.phone=""}if(j.userInfo.hadEpt.toString()=="1"){h.costWay=j.paymentPlugin.getPayType();h.productId=j.productId;h.userId=j.orderPageJson.userId}h=c.setCPSCommonParams(h);return h};e.prototype.cardSuccessCallback=function(h){if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){b.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.page_float);return}if(h.code=="006914"){Bestpay.Dialog.showAlertDialog("提醒","卡库存不足","确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){App.exitCompleteApp();b.itJudgeLocalStorage.putLocalValue("","","","")})}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")})}return}b.itJudgeLocalStorage.putLocalValue("","","","");if(b.mobile_val.length>0){c.sendSmsCertificate(h.transSeq,b.mobile_val,"")}b.paymentPlugin.setOrderDisplay("success");goTo(config.page.page_float);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};e.prototype.cardErrorCallback=function(h){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){b.itJudgeLocalStorage.putLocalValue("","","","")});return}};e.prototype.rechargeResp=function(i){var h=this;config.TRADE_LIST_QUERY_NUMBER=h.gameAccount.getToEmptyValue();config.isBack=function(){back()};c.callCPSService({service:config.CPS.GAME_RECHARGE,params:h.rechargeParams(i),showLoading:true,success:h.rechargeSuccessCallback,error:h.rechargeErrorCallback})};e.prototype.rechargeParams=function(i){var j=this;var k="";if(i!=null&&i!=""){k=i}var h={account:j.gameOrderJson.account,prodCode:j.gameOrderJson.prodCode,gameId:j.gameOrderJson.gameId,time:+new Date(),rechargeNum:j.orderPageJson.pay_count,rechargeProduct:j.gameOrderJson.gameValue,amount:f.yuan2fen(j.gameOrderJson.payMoney),password:Bestpay.Security.encryptPassword(j.userInfo.staffCode,k,j.random),subAccount:j.gameOrderJson.subAccount,gameZone:j.gameOrderJson.gameServer,gameServer:j.gameOrderJson.gameServerId,accountType:j.gameOrderJson.accountType,rechargeType:j.gameOrderJson.accountType,supplyCode:j.gameOrderJson.supplyCode};if(j.mobile_val.length>0){h.phone=j.mobile_val}else{h.phone=""}if(j.userInfo.hadEpt.toString()=="1"){h.costWay=j.paymentPlugin.getPayType();h.productId=j.productId;h.userId=j.orderPageJson.userId}console.error("----"+JSON.stringify(h));h=c.setCPSCommonParams(h);return h};e.prototype.rechargeSuccessCallback=function(h){dismissDialog();if(h.code!==config.RES.SUCCESS){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")});return}if(h.code=="009002"||h.code=="006751"){b.paymentPlugin.setOrderDisplay("overtime");goTo(config.page.page_float);return}if(h.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){App.exitCompleteApp();b.itJudgeLocalStorage.putLocalValue("","","","")})}else{Bestpay.Dialog.showAlertDialog("提醒",h.content,"确定",h.code,function(){back();b.itJudgeLocalStorage.putLocalValue("","","","")})}return}b.itJudgeLocalStorage.putLocalValue("","","","");if(b.mobile_val.length>0){c.sendSmsCertificate(h.orderId,b.mobile_val,"")}b.paymentPlugin.setOrderDisplay("success");goTo(config.page.page_float);config.isBack=function(){if(window.jqXHR.readyState>2){Bestpay.App.exitApp()}}};e.prototype.rechargeErrorCallback=function(h){if(h.code==config.RES.MONEY_NOT_ENOUGH){Bestpay.Dialog.showAlertDialog("提醒","余额不足","确定",h.code,function(){b.itJudgeLocalStorage.putLocalValue("","","","")});return}};return e});