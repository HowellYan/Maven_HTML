define(["jquery","bestpay.ui","bestpay.lang","bestpay.http"],function(d,f,c,e){var b=null;function a(){b=this;this.inputPassword=null;this.ipPassword_val=null;this.cardInfoJson={};this.userInfo=JSON.parse(Bestpay.User.getSuccessLoginInfo());this.hadEpt=this.userInfo.hadEpt;this.logoList={"866000":"images/bank/yzyh.png","866100":"images/bank/zgyh.png","866200":"images/bank/gsyh.png","866300":"images/bank/nyyh.png","866400":"images/bank/jtyh.png","866500":"images/bank/jsyh.png","866600":"images/bank/msyh.png","866700":"images/bank/hxyh.png","866800":"images/bank/gfyh.png","866900":"images/bank/zsyh.png","867000":"images/bank/gzyh.png","867200":"images/bank/gdyh.png","867400":"images/bank/zxyh.png","867600":"images/bank/xyyh.png","865700":"images/bank/payh.png","865500":"images/bank/shyh.png"}}a.prototype.initApp=function(){var g=this;showDialog(config.MSG.loading);console.log(g.userInfo);this.getBindingCardStatus();document.getElementById("btn_confirm").onclick=function(){if(g.hadEpt=="1"){Bestpay.Dialog.showAlertDialog("提醒","已开通添益宝无法解绑","确定","");return}PasswordKeyBoard.initPwdUI3(function(h){g.confirm(h)});PasswordKeyBoard.popKeyboardUI3()}};a.prototype.getBindingCardStatus=function(){var g=this;e.callCPSService({service:config.CPS.ACCOUNT_BIND_CARD_STATE,params:g.bindingCardStatusParams(),showLoading:false,success:g.bindingCardStatusSuccessCallback})};a.prototype.bindingCardStatusParams=function(){var g={};g=e.setCPSCommonParams(g);return g};a.prototype.bindingCardStatusSuccessCallback=function(g){if(g.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code);return}var h=g.bindStat;if(h=="1"){b.getBankInfoQuery()}else{App.updateUserInfo("0");Bestpay.Dialog.showAlertDialog("提醒","未绑卡","确定","",function(){Bestpay.App.exitApp()})}};a.prototype.getBankInfoQuery=function(){var g=this;e.callCPSService({service:config.CPS.ACCOUNT_BANK_INFO,params:g.bankInfoQueryParams(),showLoading:false,success:g.bankInfoQuerySuccessCallback})};a.prototype.bankInfoQueryParams=function(){var g={};g=e.setCPSCommonParams(g);return g};a.prototype.bankInfoQuerySuccessCallback=function(g){dismissDialog();if(g.code!==config.RES.SUCCESS){Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code);return}b.cardInfoJson.bankAcctNbr=g.bankAcctNbr;b.cardInfoJson.bankName=g.bankName;b.cardInfoJson.bankCode=g.bankCode;b.cardInfoJson.bankAcctName=g.bankAcctName;b.cardInfoJson.privateflag=g.privateflag;b.cardInfoJson.accId=g.accId;var i=g.bankAcctNbr,h=g.bankAcctName;h="*"+h.substring(1,h.length);b.cardInfoJson.img_src=b.logoList[g.bankCode];b.cardInfoJson.bank_card=i.substr(i.length-4,4);b.cardInfoJson.user_name=h;goTo(config.page.unbund_main,function(){var j=new f.Template();j.template_OneToOne("id_cardInfo",b.cardInfoJson);b.inputPassword=new f.InputText("pwd","password")})};a.prototype.confirm=function(g){this.ipPassword_val=this.inputPassword.getValue();e.getRandomServices(function(h){if(h.code===config.RES.SUCCESS){b.random=h.randNum}b.getUnbund(g)},false)};a.prototype.getUnbund=function(h){var g=this;e.callCPSService({service:config.CPS.ACCOUNT_BANK_UNBUND,params:g.unbundParams(h),showLoading:true,success:g.unbundSuccessCallback})};a.prototype.unbundParams=function(i){var g=this;var h={};h.payPassWord=Bestpay.Security.encryptPassword(g.userInfo.staffCode,i,g.random);h.accId=g.cardInfoJson.accId;h=e.setCPSCommonParams(h);return h};a.prototype.unbundSuccessCallback=function(g){PasswordKeyBoard.hideKeyboardUI3();if(g.code!==config.RES.SUCCESS){if(g.code==config.RES.PASSWORD_ERROR_LOCKED_002136){Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code,function(){Bestpay.App.exitCompleteApp()})}else{Bestpay.Dialog.showAlertDialog("提醒",g.content,"确定",g.code)}return}Bestpay.Dialog.showAlertDialog("提醒","您成功解绑了尾号为"+b.cardInfoJson.bank_card+"的银行卡！","确定","",function(){App.updateUserInfo("0");Bestpay.App.exitApp()})};return a});