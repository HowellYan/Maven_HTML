define(["bestpay.lang"],function(e){var f=function(){var x=Math.round(Math.random()*8999+1000)+"";var w=Math.round(Math.random()*89999+10000);var y=Math.round(Math.random()*89+10);return"20"+x+h()+""+w+""+y};var s=function(){var w="";var x=new Date();var E=x.getFullYear();var z=x.getMonth()+1;z=z<10?"0"+z:z;var C=x.getDate()<10?"0"+x.getDate():x.getDate();var A=x.getHours()<10?"0"+x.getHours():x.getHours();var B=x.getMinutes()<10?"0"+x.getMinutes():x.getMinutes();var F=x.getSeconds()<10?"0"+x.getSeconds():x.getSeconds();var D=Math.round(Math.random()*8999+1000);w=E+""+z+""+C+""+A+""+B+""+F+""+D;return w};var h=function(){var w="";var x=new Date();var E=x.getFullYear();var z=x.getMonth()+1;z=z<10?"0"+z:z;var C=x.getDate()<10?"0"+x.getDate():x.getDate();var A=x.getHours()<10?"0"+x.getHours():x.getHours();var B=x.getMinutes()<10?"0"+x.getMinutes():x.getMinutes();var F=x.getSeconds()<10?"0"+x.getSeconds():x.getSeconds();var D=Math.round(Math.random()*899+100);w=E+""+z+""+C+""+A+""+B+""+F+""+D;return w};var k=function(){var w="";var x=new Date();var E=x.getFullYear();var z=x.getMonth()+1;z=z<10?"0"+z:z;var C=x.getDate()<10?"0"+x.getDate():x.getDate();var A=x.getHours()<10?"0"+x.getHours():x.getHours();var B=x.getMinutes()<10?"0"+x.getMinutes():x.getMinutes();var F=x.getSeconds()<10?"0"+x.getSeconds():x.getSeconds();var D=Math.round(Math.random()*899+100);w=E+""+z+""+C+""+A+""+B+""+F;return w};var j=function(){var w=config.TMNNUM[config.ENV];if(typeof w!=="string"){w=config.TMNNUM.DEFAULT}return w};var m=function(){var w=config.MERID[config.ENV];if(typeof tmnNum!=="string"){w=config.MERID.DEFAULT}return w};var g=function(){var x=Bestpay.User.getLocation();var w,D=x.substring(0,2)+"0000",A=x.substring(0,4)+"00";var z=Bestpay.DB_Data.getActionCode("getProvinceData",null);for(var y=0;y<z.length;y++){if(z[y].code==D){w=z[y].name}}var B={code:D};var C=Bestpay.DB_Data.getActionCode("getCityData()",JSON.stringify(B));for(var y=0;y<C.length;y++){if(C[y].code==A){w+=C[y].name}}return w};var o=function(y){var w=JSON.parse(Bestpay.User.getSuccessLoginInfo());y.custCode=w.custCode;y.merId=w.prtnCode;y.tmnNum=j();y.staffCode=w.staffCode;y.bisChannel=config.bisChannel;y.keep=f();y.channelCode=config.AppIdentity.CHANNEL_CODE;var x=JSON.parse(Bestpay.App.getDeviceInfo());console.log(JSON.stringify(x));y.clientVersion=x.clientVersion;y.imei=x.imei;y.imsi=x.imsi;y.model=x.model;y.systemType=x.systemType;y.systemVersion=x.systemVersion;y.vender=x.vender;y.operationCode=x.operationCode;y.isSucc=x.isSucc;y.operCity=x.operCity;y.prmotePort=x.prmotePort;y.deviceName=x.deviceName;y.mac=x.mac;y.kernelVersion=x.kernelVersion;y.aidentifier=x.aidentifier;y.bestpayId=x.bestpayId;y.cpuId=x.cpuId;y.diskInfo=x.diskInfo;y.softwareType=config.softwareType;y.signType=config.signType;y.sign=Bestpay.Security.getSign(y);y.signVer=config.signVer;return y};var l=function(x,B,E,A,F,w,C,y,D){var G=this;A=A+"";if(G.userInfo===config.CARD_TYPE.BANK_MODE_FUND_POOL_MEMBER_CARD){return{code:config.RES.SUCCESS,content:config.RES.SUCCESS_MSG,COMMISSION:"0"}}var z={};z.pecProductCode=y||"";z.actionCode=B;z.acctType=config.ACCOUNT_TYPE.KEY_ACCOUNT_IPOS;z.supplyCode=C||"";z.objCode=D||"";if(x===config.BUS_TYPE.BUS_TYPE_BESTPAY_CARD){if("10"===A){E="05010100"}else{if("20"===A){E="05010200"}else{if("30"===A){E="05010300"}else{if("50"===A){E="05010500"}else{if("100"===A){E="05011100"}else{if("200"===A){E="05011200"}else{if("300"===A){E="05011300"}else{if("500"===A){E="05011500"}}}}}}}}}else{if(x===config.BUS_TYPE.BUS_TYPE_GAME_CARD){if("10"===A){E="04020100"}else{if("30"===A){E="04020300"}else{if("50"===A){E="04020500"}else{if("100"===A){E="04021100"}}}}}else{if(x===config.BUS_TYPE.BUS_TYPE_TEL_CARD_TELECOM){if("30"===A){E="01000300"}else{if("50"===A){E="01020500"}else{if("100"===A){E="01021100"}}}}else{if(x===config.BUS_TYPE.BUS_TYPE_TEL_CARD_UNICOM){if("30"===A){E="03200300"}else{if("50"===A){E="03200500"}else{if("100"===A){E="03201100"}}}}else{if(x===config.BUS_TYPE.BUS_TYPE_QQ){console.log("")}}}}}z.productCode=E;z.amount=e.yuan2fen(A);z=o(z);if(w==null){w=true}b({service:config.CPS.COMMISSION_QUERY,params:z,showLoading:w,success:F})};var n=function(z,w){var y={};y.channelCode=config.AppIdentity.CHANNEL_CODE;y.keep=f();y.tmnNum=j();var x=JSON.parse(Bestpay.App.getDeviceInfo());y.clientVersion=x.clientVersion;y.imei=x.imei;y.imsi=x.imsi;y.model=x.model;y.systemType=x.systemType;y.systemVersion=x.systemVersion;y.vender=x.vender;y.softwareType=config.softwareType;y.bisChannel=config.bisChannel;b({service:config.CPS.RANDOM_GENERAT,params:y,showLoading:w,success:z})};var u=function(x,w,y){var A={transSeq:x,phone:w,busyType:y,signType:config.signType};A=o(A);var z=function(B){Bestpay.Toast.makeText("交易凭证已发送，请通知顾客查收短信！",Bestpay.Toast.LENGTH_SHORT);console.log("短信交易凭证下发成功")};b({service:config.CPS.SMS_TRADE_VERIFY,params:A,showLoading:false,success:z,error:function(B){console.log("error:"+JSON.stringify(B))}})};var p=function(z,y,x,B,w){var A={actionCode:y,faceAmount:z,prodCode:x};A=o(A);b({service:config.CPS.PREMIUM_QUERY,params:A,showLoading:w,success:B})};var q=function(y,w){var x={};x=o(x);b({service:config.CPS.MERCHANT_STATUS_CHECK,params:x,showLoading:w,success:y})};var r=function(z,w,x){var y={};y=o(y);b({service:config.CPS.FINANCIAL_PRODUCTS,params:y,showLoading:w,success:z,error:x})};var d=function(z,w,x){var y={bankMode:x};y=o(y);b({service:config.CPS.CCOUNT_BALANCE_QUERY,params:y,showLoading:w,success:z})};var t=function(x,z,w){var y={productId:x};y=o(y);b({service:config.CPS.ENTERPRISE_PERSONAL_ACCOUNT_INFO,params:y,showLoading:w,success:z})};var i=function(w){if(typeof w.params==="object"){w.params=JSON.stringify(w.params)}console.log("dummy service: "+w.service);console.log("request: "+w.params);require(["dummy/resp/"+w.service],function(x){dismissDialog();console.log("response: "+JSON.stringify(x));w.success(x)})};var a=function(){var x;var w=location.origin;if(config.ENV==="PRODUCT"){if(config.isOnline==false){w="http://183.63.191.7:9009"}x=w+"/online_h5/pluginRAB"}else{x=w+"/test/20160406/pluginRAB"}return x};var v=function(){var x;var w=location.origin;if(config.ENV==="PRODUCT"){x=w+"/online_h5"}else{x=w+"/web/20151203"}return x};var c=function(y){dismissDialog();var x="";if(y==="reject"){Bestpay.App.setTitle("网络异常");x+='<div class="error651-box">';x+='<div class="error651-box-1">';x+='<strong style="">网络异常</strong><br>';x+="请稍后查看订单状态。";x+="</div>";x+='<div class="error651-box-2">';x+="<strong>温馨提示：</strong><br>";x+="商户请先确认订单状态，避免重复支付。";x+="</div>";x+='<div class="btn2-common-wrap" id="otCheckOrder">';x+="<button>点击查看订单状态</button>";x+="</div>";x+="</div>"}else{if(y==="resolve"){Bestpay.App.setTitle("业务已受理");x+='<div class="error651-box">';x+='<div class="error651-box-1" style="width:200px;height:50px;padding: 0;background: url(../lib/img/recharge_success.png) no-repeat;background-size: 100%;">';x+="</div>";x+='<div class="error651-box-2">';x+="<strong>温馨提示：</strong><br>";x+="商户请先确认订单状态，避免重复支付。";x+="</div>";x+='<div class="btn2-common-wrap" id="otCheckOrder">';x+="<button>点击查看订单状态</button>";x+="</div>";x+="</div>"}}console.log("init------------overtime");var z=document.getElementById("overTimePage");if(!!z){z.innerHTML=x;z.style.display="block"}else{var w=document.createElement("div");w.id="overTimePage";w.innerHTML=x;document.body.insertBefore(w,document.body.childNodes[0])}window.pageStack.push("overTimePage");document.getElementById("otCheckOrder").onclick=function(){Bestpay.Dialog.jumpToOrderQuery(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);window.pageStack.pop();Bestpay.App.setTitle(window.pageStack[window.pageStack.length-1].title);document.getElementById("overTimePage").style.display="none";back()}};config.isOpen=true;var b=function(x){if(x.showLoading!==false){showDialog(config.MSG.loading)}if(!!config.dummy){i(x);return}if(x.setTime==null){x.setTime=75000}if(typeof x.error!=="function"){x.error=function(){dismissDialog();Bestpay.Dialog.showAlertDialog("请求失败",config.MSG.networkFail2,"确定","");console.log("error 请求失败: "+w)}}var A=function(G){if(config.isDialogBack==true){config.isDialogBack=false;return}console.log("response: "+JSON.stringify(G));if(x.showLoading==true){dismissDialog()}config.isOpen=true;if(x.service!=config.noVerifySign[x.service]){var I=Bestpay.Security.verifySign(G);console.log("resultMsg: -> "+I);if(I!=null&&I==="false"){Bestpay.Dialog.showAlertTwoBtnDialog("验签失败","您目前的网络可能存在安全隐患，请修改网络环境，如涉及交易，请联系客服查询订单状态。","重新登录","取消","",function(L){Bestpay.User.login()});return}}if(G.code=="010054"){if(typeof x.isNoSuccess=="function"){x.isNoSuccess(G)}Bestpay.Dialog.showAlertTwoBtnDialog("登录失效","请重新登录","重新登录","取消",G.code,function(L){console.log(L);if(L.toString()=="1"){Bestpay.User.login()}});return}if(G.code=="011007"){if(pageStack!=null&&pageStack!=""&&pageStack[pageStack.length-1].goToRecords!=null&&pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);PasswordKeyBoard.hideKeyboardUI3();var K=JSON.parse(Bestpay.App.getDeviceInfo());var H=K.clientVersion;var J=K.systemType;H=H.replace(/\./g,"")*1;J=J.toLowerCase();if((J==="android"&&H>=329)||(J==="ios"&&H>=305)){console.log("overtime--------------------");c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}}if(G.code=="011142"){var K=JSON.parse(Bestpay.App.getDeviceInfo());var H=K.clientVersion;var J=K.systemType;H=H.replace(/\./g,"")*1;J=J.toLowerCase();console.log("App Version = "+H+" System Type = "+J);if((J==="android"&&H>=403)||(J==="ios"&&H>=402)){console.log("[return code = "+G.code+"] 体验商户自动跳去认证页面");PasswordKeyBoard.hideKeyboardUI3();back();Bestpay.Dialog.jumpToAuthorityDialog();return}else{Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,G.content,"确定",G.code,function(){back()})}}x.success(G)};var E=function(G){config.isOpen=true;PasswordKeyBoard.hideKeyboardUI3();console.log("----error----:"+JSON.stringify(G)+";pageStack:"+pageStack);dismissDialog();if(pageStack!=null&&pageStack!=""&&pageStack[pageStack.length-1].goToRecords!=null&&pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);var J=JSON.parse(Bestpay.App.getDeviceInfo());var H=J.clientVersion;var I=J.systemType;H=H.replace(/\./g,"")*1;I=I.toLowerCase();if((I==="android"&&H>=329)||(I==="ios"&&H>=305)){c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}if(G.readyState==0){Bestpay.Dialog.showAlertDialog(config.TITLE.no_repeat,config.MSG.networkFail1,"确定","")}x.error(G)};if(typeof x.params==="object"){x.params=JSON.stringify(x.params)}var F="?ran"+Math.floor(Math.random()*100+1)+"="+Date.parse(new Date());var D=config.NGINX_CPS[config.ENV];console.log("-----------ENV:"+config.ENV);if(typeof D!=="string"){D=config.NGINX_CPS.PUBLIC}else{if(x.isINF!==null&&x.isINF==true){D=config.NGINX_INF[config.ENV];if(typeof D!=="string"){D=config.NGINX_INF.PUBLIC}}}if(config.isOnline==false){D=config.URLCPS[config.ENV];if(typeof D!=="string"){D=config.URLCPS.PUBLIC}else{if(x.isINF!==null&&x.isINF==true){D=config.URLINF[config.ENV];if(typeof D!=="string"){D=config.URLINF.PUBLIC}}}}var w=D+x.service+F;if(x.URL!=null){w=x.URL+x.service+F}if(x.async==null){x.async=true}console.log("isOpen: "+config.isOpen);if(config.isOpen==false){return}else{config.isOpen=false}console.log("url: "+w);console.log("request: "+x.params);try{window.jqXHR=$.ajax({url:w,type:"POST",async:x.async,data:x.params,timeout:x.setTime,contentType:"application/json; charset=utf-8",dataType:"json",success:A,error:E})}catch(B){config.isOpen=true;console.error(B.message);x.error(result);if(pageStack[pageStack.length-1].goToRecords==true){console.log("goToRecords:"+pageStack[pageStack.length-1].goToRecords+";isOpen:"+config.isOpen);console.log("TRADE_LIST_QUERY_TYPE:"+config.TRADE_LIST_QUERY_TYPE+";TRADE_LIST_QUERY_NUMBER:"+config.TRADE_LIST_QUERY_NUMBER);dismissDialog();var C=JSON.parse(Bestpay.App.getDeviceInfo());var y=C.clientVersion;var z=C.systemType;y=y.replace(/\./g,"")*1;z=z.toLowerCase();if((z==="android"&&y>=329)||(z==="ios"&&y>=305)){c("reject")}else{Bestpay.Dialog.showAlertSynchroDialog(config.TITLE.submited_title,config.MSG.msg_submited_content,"确定",config.TRADE_LIST_QUERY_TYPE,config.TRADE_LIST_QUERY_NUMBER);back()}return}dismissDialog();Bestpay.Dialog.showAlertDialog("请求失败",config.MSG.networkFail1,"确定","")}};return{getKeep:f,getTmnNum:j,getMerId:m,getOrderSeq:h,getPremium:p,getLocalName:g,getMerchantStatus:q,getFinancialProducts:r,getAccountBalanceInquiry:d,setCPSCommonParams:o,callCPSService:b,getCommission:l,getRandomServices:n,sendSmsCertificate:u,getRechargeURL:a,overTime:c,getEnvironmentURL:v,getCurrentTime:k}});