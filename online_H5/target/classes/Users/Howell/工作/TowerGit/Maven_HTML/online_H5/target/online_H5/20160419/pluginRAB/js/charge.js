define(["utils"],function(Utils){var RZPassWordType="";var openOrModify=false;var COMEFROM={ZJ:"0",JCK:"1",JFY:"2",ReC:"3",JB:"4",RZ:"5",AF:"6",CF:"7",SF:"8",TYB:"9"};var trueFlag=new Array();var submitOpen=true;var faZhiVailResult=new Array();var ONEFAZHI=500000;var MONTHFAZHI=1000000;var bankNum=null;console.log("orderSeq------------------->"+Utils.getOrderSeq());var info="";if(androidOrIos=="ios"){info=User.getSuccessLoginInfo()}else{info=JSON.parse(User.getSuccessLoginInfo())}if(info.prtnCode!=null){merId=info.prtnCode}var productNo=User.getProduct();var custCode=info.custCode;var staffCode=info.staffCode;var prinType=info.prinType;var hadEpt=info.hadEpt;var regType=info.regType;var bankMode=info.bankMode;var set1="";var accId="";var indexTianyibaoValue="1";var productId="0030001";var userId="";var zhuangru_true=false;var zhuanru_money_text_val="";var zhuanru_passWord="";var balance="";var confirmWorkDay="";var confirmWorkWeek="";var otherSelfrMaxvalue="";var otherSelfsingleMaxvalue="";var otherSelfyMaxvalue="";var otherSelfactiveBalance="";var notSufficientFunds="";$(function(){var GetNotSufficientFunds=function(){var urlFunds=location.href;notSufficientFunds=urlFunds.substr(urlFunds.lastIndexOf("JUDGE=")+6,8);console.log("123 urlFunds"+urlFunds);console.log("123 notSufficientFunds = "+notSufficientFunds);if(notSufficientFunds=="tybFunds"){console.log("添益宝charge 123 = notSufficientFunds= tybFunds = "+notSufficientFunds);indexTianyibaoValue="2";$(".block-radioCom:eq(1)").addClass("block-radio-checked");$(".block-radioCom:eq(0)").removeClass("block-radio-checked");$("#re_money_One_Parent_JFY_input").hide();$("#re_money_One_Parent_TYB_input").show();$("#nextStepBtn").html("下一步")}else{console.log("交费易charge 123 = notSufficientFunds= jfyFunds = "+notSufficientFunds);indexTianyibaoValue="1";$(".block-radioCom:eq(0)").addClass("block-radio-checked");$(".block-radioCom:eq(1)").removeClass("block-radio-checked");$("#re_money_One_Parent_JFY_input").show();$("#re_money_One_Parent_TYB_input").hide();$("#nextStepBtn").html("确定")}console.log("123indexTianyibaoValue tybFunds= "+indexTianyibaoValue)};$(".block-radioCom").click(function(){var indexTianyibaoCom=$(".block-radioCom").index($(this));indexTianyibaoValue=$(this).data("value");console.log(indexTianyibaoValue+" = indexTianyibaoValue");$(".block-radioCom").removeClass("block-radio-checked").eq(indexTianyibaoCom).addClass("block-radio-checked");console.error("indexTianyibaoValue = "+indexTianyibaoValue);comparefour();$_id("re_money_1").value="";$_id("re_money_TYB").value="";$_id("id_Handling_Charge").innerHTML="0";$(".bank_span").html("");if(indexTianyibaoValue=="1"){$("#re_money_One_Parent_JFY_input").show();$("#re_money_One_Parent_TYB_input").hide();$("#nextStepBtn").html("确定")}else{$("#re_money_One_Parent_JFY_input").hide();$("#re_money_One_Parent_TYB_input").show();$("#nextStepBtn").html("下一步")}});if(hadEpt=="1"){$(".block-radioCom:eq(0)").addClass("block-radio-checked").css({width:"50%"});$(".block-radioCom:eq(1)").removeClass("block-radio-checked").css({width:"50%",display:"block"});GetNotSufficientFunds()}else{indexTianyibaoValue="1";$(".block-radioCom:eq(0)").addClass("block-radio-checked").css({width:"100%"});$(".block-radioCom:eq(1)").removeClass("block-radio-checked").css({display:"none"})}console.error("indexTianyibaoValue = "+indexTianyibaoValue);$("#re_money_1").blur(function(){handlingCharge()});console.log("prinType = "+prinType);$("#onlyBankRecharge").hide();$("#outertabchange").show();window.threshold_recharge=function(){$_id("fazDelBtn").className="del";$("#paypwdUpdateZhiFu").blur();selectFaZhi();App.setFinishIconHidden()};console.log("info  ---------------->"+JSON.stringify(info));productType=info.productType;console.log("productType--------------------->"+productType);if("0"==productType){Dialog.showAlertDialog("提醒",ERROR.noProduct,"确定","");return}else{if("1"==productType){Utils.pageIds.push("page0");getAccount()}else{if("2"==productType){Utils.pageIds.push("page0");getAccount()}else{if("3"==productType){Utils.pageIds.push("page0");$("#brg_amount").hide();getAccount()}}}}if(bankMode=="BT1001"||bankMode=="BT1013"){$("#brg_amount").show()}else{$("#brg_amount").hide()}if(prinType=="PT901"){$("#brg_amount").hide()}$_id("open_tianyibao_btn").onclick=function(){console.log("jumpToNewTianyibao ABC");App.jumpToNewTianyibao();console.log("jumpToNewTianyibao ABC2222")};var cont_btn=$(".open_tianyibao_btn");cont_btn.on("touchstart",function(){$(this).addClass("cont_hover")});cont_btn.on("touchend touchmove touchcancel",function(){$(this).removeClass("cont_hover")});$("#jiaofyReClick").click(function(){getAccount();initRechargeUi()});$_id("zijReClick").onclick=function(){hiddenDelBtns();getBindCardState(COMEFROM.ZJ)};$_id("yizfRechargeBtn").onclick=function(){if(trueFlag.errorNotice2){appreciationQuery()}else{Toast.makeText(ERROR.moneyError1,LENGTHLONG)}};$("#closeFaZhi").click(function(){PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.CF,val)});PasswordKeyBoard.popKeyboardUI3()});$_id("re_money_1").addEventListener("input",inputVerifyMoney,false);$_id("re_money_2").addEventListener("input",inputVerifyMoney,false);$_id("cardPwd").addEventListener("input",inputVerify,false);$_id("cardNo").addEventListener("input",inputVerify,false);$_id("re_money_3").addEventListener("input",inputVerifyMoney,false);$("#re_money_3").focus(function(){$("#zijPwdInput").removeClass("containterborderall-select").addClass("containterborderall");$("#zijRecInput").removeClass("containterborderall").addClass("containterborderall-select")});$("#quickBankPrePhone").focus(function(){$("#bankPwdLine").removeClass("containterborderall-select").addClass("containterborderall")});$("#msgVerifyCode").focus(function(){$("#bankPwdLine").removeClass("containterborderall-select").addClass("containterborderall")});$("#oneFaZhi").focus(function(){$("#setFzhPwd").removeClass("containterborderall-select").addClass("containterborderall")});$("#dayFaZhi").focus(function(){$("#setFzhPwd").removeClass("containterborderall-select").addClass("containterborderall")});$_id("goRenZheng").onclick=function(){PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3()};$("#addFaZhi").click(function(){var one=$("#oneFaZhi").val();var day=$("#dayFaZhi").val();if(one==""){Toast.makeText("单笔限额不能为空",LENGTHLONG);return}if(day==""){Toast.makeText("累积限额不能为空",LENGTHLONG);return}if($("#oneFaZhi").val()>(ONEFAZHI*1/100)){Toast.makeText("单笔限额最高只能设置为"+(ONEFAZHI*1/100)+"元",LENGTHLONG);return}if($("#dayFaZhi").val()>(MONTHFAZHI*1/100)){Toast.makeText("累积限额最高只能设置为"+(MONTHFAZHI*1/100)+"元",LENGTHLONG);return}PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.AF,val)});PasswordKeyBoard.popKeyboardUI3()});$("#updateFaZhi").click(function(){$("#oneFaZhi").attr("placeholder","单笔阀值:最高可设置为"+(parseInt(ONEFAZHI)/100)+"元");$("#dayFaZhi").attr("placeholder","累计阀值:最高可设置为"+(parseInt(MONTHFAZHI)/100)+"元");PasswordKeyBoard.initPwdId("paypwdAddZhiFu");$("#oneFaZhi").val("");$("#dayFaZhi").val("");$_id("fazhkDelBtn").className="del";Utils.toNextPage("addFaZhiPage")});$("#goBalanQuery").click(function(){App.goBalanQuery()});initKeyBord()});function hiddenDelBtns(){$(".containterborderall .del_1").removeClass("del_1").addClass("del");$(".containterborderall-select .del_1").removeClass("del_1").addClass("del")}function initRechargeUi(){$("#bankRecharge").show();$("#yiChKRecharge").hide();$("#re_money_1").val("");$("#cardNo").val("");$("#cardPwd").val("");$("#re_money_2").val("");$("#re_money_3").val("");$("#zijpwd").val("");hiddenDelBtns()}function initKeyBord(){$("#paypwdUpdateZhiFu").click(function(){PasswordKeyBoard.keyInputId="paypwdUpdateZhiFu";PasswordKeyBoard.popPswKeyboard()});$("#paypwdAddZhiFu").click(function(){$("#setFzhPwd").removeClass("containterborderall").addClass("containterborderall-select");PasswordKeyBoard.keyInputId="paypwdAddZhiFu";PasswordKeyBoard.popPswKeyboard()});$("#paypwd").click(function(){$("#bankPwdLine").removeClass("containterborderall").addClass("containterborderall-select");PasswordKeyBoard.keyInputId="paypwd";PasswordKeyBoard.popPswKeyboard()});$("#paypwdRenZheng").click(function(){PasswordKeyBoard.keyInputId="paypwdRenZheng";PasswordKeyBoard.popPswKeyboard()});$("#zijpwd").click(function(){$("#zijRecInput").removeClass("containterborderall-select").addClass("containterborderall");$("#zijPwdInput").removeClass("containterborderall").addClass("containterborderall-select");PasswordKeyBoard.popPswKeyboard();PasswordKeyBoard.keyInputId="zijpwd"});$("#passwordPlaceholder").click(function(){PasswordKeyBoard.popPswKeyboard();PasswordKeyBoard.keyInputId="passwordPlaceholder"})}function pswVail(psw,JSONResult2){var params={bisChannel:bisChannel,bluemac:"",channelCode:"20",clientVersion:deviceInfo.clientVersion,custCode:custCode,imei:"",keep:Utils.getKeep(),password:psw,staffCode:staffCode,tmnNum:"440106003094",merId:merId,vender:"Android",verifyLevel:"001",verifyType:"0001",wifimac:""};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var psw_call_back=function(JSONResult){PasswordKeyBoard.hideKeyboardUI3();Utils.dismissDialog();console.log("outprint:"+JSON.stringify(JSONResult));if(JSONResult.code=="000000"){$("#paypwdRenZheng").val("");if(prinType=="PT901"){console.log("走向绑卡界面");var loadingCb=function(JResult){console.log("刷新------------------------");if(JResult=="2"){App.exitApp()}else{if(JResult=="1"){location.reload()}}};App.jumpToNewH5View(BK_URl,loadingCb)}else{if(RZPassWordType=="A01"){console.log("走向认证界面");var loadingCb=function(JResult){location.reload()};App.jumpToNewH5View(RZ_Url,loadingCb)}else{if(RZPassWordType=="A02"){console.log("走向绑卡界面");var loadingCb=function(JResult){console.log("刷新------------------------"+JResult);if(JResult=="2"){App.exitApp()}else{if(JResult=="1"){location.reload()}}};App.jumpToNewH5View(BK_URl,loadingCb)}else{goAddFaZhi(JSONResult2)}}}}else{vailPsw=false;if(JSONResult.code=="002136"){Dialog.showAlertDialog("提醒",JSONResult.content,"确定","",function(){App.exitCompleteApp();return})}else{Dialog.showAlertDialog("提醒",JSONResult.content,"确定","")}}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+"MLgn001",params,psw_call_back,null)}function inputVerifyMoney(){var patrn=/^(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,2})?$/;this.value=this.value.replace(/[^\d.]/g,"");var id=this.id;id=id.substring(id.length-1,id.length);var errorId="errorNotice"+id;if(this.value.indexOf(".")!=-1){this.value=this.value.substring(0,this.value.indexOf(".")+3)}var va=this.value;if(patrn.test(va)){errorNotice(errorId,true)}else{errorNotice(errorId,false)}}function inputVerify(){this.value=this.value.replace(/[^\d]/g,"");var patrn=/^(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,2})?$/;var id=this.id;id=id.substring(id.length-1,id.length);var errorId="errorNotice"+id;var va=this.value;errorNotice(errorId,true);if(this.id=="cardPwd"&&this.value.length>6){this.value=this.value.substring(0,6)}else{if(this.id=="cardNo"&&this.value.length>16){this.value=this.value.substring(0,16)}}}function errorNotice(id,flag){trueFlag[id]=flag;if(flag){$("#"+id).hide()}else{$("#"+id).show()}}function getBindCardState(from){var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),bisChannel:bisChannel,staffCode:staffCode,custCode:custCode};Utils.getDeviceInfo(params);var sign=Security.getSign(params);console.log("sign---------------- = "+sign);params.sign=sign;params.signVer="2";var callback=function(json){console.log("绑卡状态查询 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}faZhState=false;bindBankState=false;App.setThresholdBtnIsVisable(false);if(json.code=="000000"){Utils.dismissDialog();var bindStat=json.bindStat;if(from==COMEFROM.JFY){if(bindStat=="0"){$("#outertabchange").hide();hasOrNoBankChange("hasBank","hasnoBank");$("#bindCardState").html("未绑卡");Utils.toNextPage("jiaoFeiYiRechargePage");document.title="绑卡";App.setTitle("绑卡");$("#bindCardNowBtn").click(function(){bindCard(from)})}else{if(bindStat=="1"){bindBankState=true;faZhState=true;getUserBankInfo(from)}else{$("#outertabchange").hide();hasOrNoBankChange("hasBank","hasnoBank");$("#zijbindCardState").html("绑卡中");$("#bindCardNowBtn").click(function(){Dialog.showAlertDialog("提醒",json.content,"确定","")});Dialog.showAlertDialog("提醒","绑卡中","确定","")}}}else{if(from==COMEFROM.ZJ){if(bindStat=="0"){hasOrNoBankChange("haszijBank","hasnozijBank");$("#zijbindCardState").html("未绑卡");Utils.toNextPage("zijRchargePage");$("#zijbindCardNowBtn").click(function(){if(info.productType=="3"){RZPassWordType="A02";PasswordKeyBoard.initPwdId("paypwdRenZheng");$("#paypwdRenZheng").val("");PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3();console.log("绑卡")}else{bindCard(from)}})}else{if(bindStat=="1"){bindBankState=true;faZhState=true;getUserBankInfo(from)}else{Dialog.showAlertDialog("提醒","绑卡中","确定","")}}}}}else{if(json.code==TOKENLOST){Utils.dismissDialog();var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{if(json.code=="011006"){console.log(json.code+"-------------------");Dialog.showAlertDialog("提醒",json.content,"确定",json.code,function(){App.exitApp()})}else{Utils.dismissDialog();Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}}return};console.log("绑卡状态查询 入参："+JSON.stringify(params));Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.SBinCrd004,params,callback,null)}function bindCard(from){if(prinType=="PT901"){RZPassWordType="A01";$("#paypwdRenZheng").val("");PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3();console.log("认证")}else{getUserInfo(from)}}var vailPsw=false;function selectFaZhi(){var params={staffCode:staffCode,channelCode:"20",custCode:custCode,merId:merId,tmnNum:tmnNum,bisChannel:bisChannel,keep:Utils.getKeep()};Utils.getDeviceInfo(params);var sign=Security.getSign(params);console.log("sign---------------- = "+sign);params.sign=sign;params.signVer="2";var faZhiSelect_vall_back=function(JSONResult){Utils.dismissDialog();console.log("查询阀值------------>"+JSON.stringify(JSONResult));if(JSONResult.code=="000000"){ONEFAZHI=JSONResult.oneMaxOfLevel;MONTHFAZHI=JSONResult.dayMaxOfLevel;if(JSONResult.chkCode=="0"){openOrModify=true;$("#selectOneFaZhi").val("单笔限额 : "+(parseInt(JSONResult.oneMax)/100)+"元");$("#selectDayFaZhi").val("累积限额 : "+(parseInt(JSONResult.dayMax)/100)+"元");App.setThresholdBtnIsVisable(false);PasswordKeyBoard.initPwdId("paypwdUpdateZhiFu");Utils.toNextPage("updateFaZhiPage")}else{App.setThresholdBtnIsVisable(false);openOrModify=false;goAddFaZhi(JSONResult)}}else{if(JSONResult.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code)}}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+"SThm005",params,faZhiSelect_vall_back,null)}var str="";function addFaZhiEveInput(input_id,max){$_id(input_id).addEventListener("input",function(){var patrn=/^(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,2})?$/;var va=this.value;if(patrn.test(va)){if(parseInt(va)>max&&input_id=="oneFaZhi"){Toast.makeText("单笔限额最高只能设置为"+max+"元",LENGTHLONG)}else{if(parseInt(va)>max&&input_id=="dayFaZhi"){Toast.makeText("累积限额最高只能设置为"+max+"元",LENGTHLONG)}}str=va}else{if(va!=""){$("#"+this.id).val(str)}}},false)}function goAddFaZhi(JSONResult){var oneMaxOfLevel=JSONResult.oneMaxOfLevel;var dayMaxOfLevel=JSONResult.dayMaxOfLevel;ONEFAZHI=oneMaxOfLevel;MONTHFAZHI=dayMaxOfLevel;$("#oneFaZhi").attr("placeholder","单笔阀值：最高可设置为"+(oneMaxOfLevel*1/100)+"元");$("#dayFaZhi").attr("placeholder","累积阀值：最高可设置为"+(dayMaxOfLevel*1/100)+"元");addFaZhiEveInput("oneFaZhi",(oneMaxOfLevel*1/100));addFaZhiEveInput("dayFaZhi",(dayMaxOfLevel*1/100));Utils.toNextPage("addFaZhiPage")}function addFaZhi(random,val){var pwd=Security.encryptPassword(productNo,val,random);var oneFaZhi=$("#oneFaZhi").val();var dayFaZhi=$("#dayFaZhi").val();var params={staffCode:staffCode,channelCode:"20",custCode:custCode,oneMax:parseInt(oneFaZhi*100),dayMax:parseInt(dayFaZhi*100),keep:Utils.getKeep(),payPassword:pwd,merId:merId,bisChannel:bisChannel,tmnNum:tmnNum};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";console.log("打开阀值入参："+JSON.stringify(params));var openFaZhi_call_back=function(JSONResult){console.log("打开阀值出参："+JSON.stringify(JSONResult));PasswordKeyBoard.hideKeyboardUI3();Utils.dismissDialog();if(JSONResult.code=="000000"){var back;if(openOrModify){back=function(){console.log("modify fazhi------------------two back");hiddenDelBtns();Utils.back();Utils.back()}}else{back=function(){console.log("open fazhi------------------one back");hiddenDelBtns();Utils.back()}}$("#paypwdUpdateZhiFu").val("");$("#oneFaZhi").val("");$("#dayFaZhi").val("");$("#paypwdAddZhiFu").val("");Utils.alert("单 笔 限 额："+oneFaZhi+"元\n日累积限额："+dayFaZhi+"元",back)}else{if(JSONResult.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{if(JSONResult.code==LockPed){Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code,function(){App.exitCompleteApp()})}else{Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code)}}}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+"MThm001",params,openFaZhi_call_back,null)}function closeFaZhi(random,val){var pwd=Security.encryptPassword(productNo,val,random);var params={staffCode:staffCode,channelCode:"20",custCode:custCode,merId:merId,tmnNum:tmnNum,keep:Utils.getKeep(),bisChannel:bisChannel,payPassword:pwd};Utils.getDeviceInfo(params);var sign=Security.getSign(params);console.log("sign---------------- = "+sign);params.sign=sign;params.signVer="2";console.log("关闭阀值入参："+JSON.stringify(params));var closeFaZhi_call_back=function(JSONResult){console.log("关闭阀值出参："+JSON.stringify(JSONResult));PasswordKeyBoard.hideKeyboardUI3();Utils.dismissDialog();if(JSONResult.code=="000000"){Dialog.showAlertDialog("提醒","进行充值时不需要输入短信验证码","确定","",function(){Utils.back()})}else{if(JSONResult.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{if(JSONResult.code==ErrorPwd){Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code);return}else{if(JSONResult.code==LockPed){Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code,function(){App.exitCompleteApp()})}else{Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code)}}}}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+"MThm002",params,closeFaZhi_call_back,null)}function faZhiVail(bankCode){var rechargeMoney=$("#re_money_1").val();var params={staffCode:staffCode,channelCode:"20",custCode:custCode,merId:merId,tmnNum:tmnNum,keep:Utils.getKeep(),bisChannel:bisChannel,rechargeMoney:yuan2fen(rechargeMoney),bankCode:bankCode};Utils.getDeviceInfo(params);var sign=Security.getSign(params);console.log("sign---------------- = "+sign);params.sign=sign;params.signVer="2";console.log("判断阀值- params -------------->"+JSON.stringify(params));var faZhiVail_vall_back=function(JSONResult){Utils.dismissDialog();console.log("判断阀值------------------>"+JSON.stringify(JSONResult));if(JSONResult.code=="000000"){var code=JSONResult.chkCode;faZhiVailResult.chkCode=code;faZhiVailResult.bankMobile=JSONResult.bankMobile;if(code=="0"||code=="4"){$("#faZhiPhone").hide();$("#faZhiMsm").hide()}else{if(code=="3"){$("#faZhiPhone").show();$("#faZhiMsm").show()}else{if(code=="1"||code=="2"){$("#faZhiPhone").hide();$("#faZhiMsm").show()}}}nextStepBtn()}else{if(JSONResult.code==TOKENLOST){$("#con_yan_zheng_ma").text("获取验证码");var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code)}}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.SThm003,params,faZhiVail_vall_back,null)}function getUserBankInfo(from){var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,bisChannel:bisChannel,custCode:custCode};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){Utils.dismissDialog();console.log("银行卡绑定信息 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){bankNum=json.bankCode;var bankNo=json.bankAcctNbr;accId=json.accId;if(from==COMEFROM.JFY){if(bankNum==BANK.bankInfo.zgbank.bankNum||bankNum==BANK.bankInfo.nybank.bankNum||bankNum==BANK.bankInfo.jsbank.bankNum||bankNum==BANK.bankInfo.yzbank.bankNum||bankNum==BANK.bankInfo.gfbank.bankNum){$("#re_money_1").attr("placeholder","500元以上免手续费")}if(hadEpt=="1"){accountInformationInterface()}Utils.logoToBank("bankLogo",json.bankCode);$_id("bankName").innerHTML=json.bankName;$_id("bankCardNo").innerHTML=bankNo.substr(bankNo.length-4,4);var name=json.bankAcctName;name="*"+name.substring(1,name.length);$_id("userName").innerHTML=name;$("#re_money_1").val("");App.setThresholdBtnIsVisable(true);Utils.toNextPage("jiaoFeiYiRechargePage");$_id("nextStepBtn").onclick=function(){if(indexTianyibaoValue=="1"){if(!submitOpen){return}if(trueFlag.errorNotice1){if(!Utils.isNumber($("#re_money_1").val(),100000,10)){Toast.makeText(ERROR.moneyError2,LENGTHLONG);return}faZhiVail(json.bankCode)}else{Toast.makeText(ERROR.moneyError2,LENGTHLONG)}}}}else{Utils.logoToBank("zijbankLogo",json.bankCode);$_id("zijbankName").innerHTML=json.bankName;$_id("zijbankCardNo").innerHTML=bankNo.substr(bankNo.length-4,4);var name=json.bankAcctName;name=name.substring(1,name.length);$_id("zijuserName").innerHTML="*"+name;hasOrNoBankChange("hasnozijBank","haszijBank");PasswordKeyBoard.initPwdId("zijpwd");$("#re_money_3").val("");Utils.toNextPage("zijRchargePage");$_id("zijRechargeBtn").onclick=function(){var money=$("#re_money_3").val();var pwd=PasswordKeyBoard.keyStr;if(money==""){Toast.makeText(ERROR.moneyError3,LENGTHLONG);return}if(pwd.length<6){Toast.makeText(ERROR.pwdError,LENGTHLONG);return}if(trueFlag.errorNotice3){getRandom(COMEFROM.ZJ)}else{Toast.makeText(ERROR.moneyError2,LENGTHLONG)}}}}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}return};console.log("银行卡绑定信息 入参："+JSON.stringify(params));Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.SCbk001,params,callback,null)}function textT(id,text){$(id).html(text)}function sortNumber(a,b){return a-b}function comparefour(){var more_value_zu="";var arrbank=[otherSelfrMaxvalue,otherSelfsingleMaxvalue,otherSelfyMaxvalue];arrbank.sort(sortNumber);if(indexTianyibaoValue==1){}else{more_value_zu=arrbank[0];$("#re_money_TYB").attr("placeholder","最多可转入"+getThausand(fen2yuan(more_value_zu),1)+"元")}}String.prototype.startWith=function(s){if(s==null||s==""||this.length==0||s.length>this.length){return false}if(this.substr(0,s.length)==s){return true}else{return false}};function fen2yuan(fen){fen=fen+"";if(fen==null||fen.length<1){return"0.00"}else{if(fen.length==1){return"0.0"+fen}else{if(fen.length==2){return"0."+fen}else{var f=fen.substring(fen.length-2);var y=fen.substring(0,fen.length-2);return y+"."+f}}}}function yuan2fen(yuan){var yuanStr=yuan+"";if(yuanStr.startWith(".")){yuanStr="0"+yuanStr}yuan=new Number(yuanStr).toFixed(2);var currency=Math.round((yuan*100)*1000)/1000;if((currency+"").indexOf(".")>0){currency=currency.substring(0,currency.indexOf("."))}return currency}$("#re_money_One_Parent_TYB_input").after("<div class='bank_span' style='color: red;margin:20px 0'></div>");$("#nextStepBtn").on("click",function(){if(indexTianyibaoValue==2){getapplyforBuySecretInterface()}});function purchaseAndVerification(){var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,bisChannel:bisChannel,custCode:custCode,productId:productId};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){Utils.dismissDialog();console.log("5企业理财申购预校验 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){zhuanru_money_text_val=document.getElementById("re_money_TYB").value;var rMaxvalue=json.rMaxvalue;var rMax=json.rMax;var singleLimitvalue=json.singleLimitvalue;var singleMaxvalue=json.singleMaxvalue;var yMaxvalue=json.yMaxvalue;var yMax=json.yMax;otherSelfrMaxvalue=json.rMaxvalue;otherSelfsingleMaxvalue=json.singleMaxvalue;otherSelfyMaxvalue=json.yMaxvalue;if(singleMaxvalue==null||singleMaxvalue==""||singleMaxvalue=="undefined"||(typeof singleLimitvalue==="undefined")||rMaxvalue==null||rMaxvalue==""||rMaxvalue=="undefined"||(typeof rMaxvalue==="undefined")||yMaxvalue==null||yMaxvalue==""||yMaxvalue=="undefined"||(typeof yMaxvalue==="undefined")){if(indexTianyibaoValue==1){$("#re_money_1").attr("placeholder","充值金额:（以元位单位）")}else{$("#re_money_TYB").attr("placeholder","")}}else{comparefour()}console.log("002接口"+indexTianyibaoValue);function bank_text(){zhuangru_true=false;zhuanru_money_text_val=document.getElementById("re_money_TYB").value;zhuanru_money_text_val=yuan2fen(zhuanru_money_text_val);if(zhuanru_money_text_val!=null||zhuanru_money_text_val.length!=0){$("#jy_btn_show").addClass("cont_btn_blue")}else{$("#jy_btn_show").addClass("cont_btn_gray").removeClass("cont_btn_blue")}if(zhuanru_money_text_val*1==0){textT(".bank_span","输入金额不能为0");return}if(rMax!=null&&rMax!=""&&rMax!=undefined){if(rMax>0){textT(".bank_span","")}else{textT(".bank_span","转入次数已超过单日最大笔数");return}}if(yMax!=null&&yMax!=""&&yMax!=undefined){if(yMax>0){textT(".bank_span","")}else{textT(".bank_span","当月最大笔数转入次数超限");return}}if(singleMaxvalue!=null&&singleMaxvalue!=""&&singleMaxvalue!=undefined){if(zhuanru_money_text_val*1>singleMaxvalue){textT(".bank_span","单笔最高金额超过有效数");return}else{textT(".bank_span","")}}if(rMaxvalue!=null&&rMaxvalue!=""&&rMaxvalue!=undefined){if(zhuanru_money_text_val*1>rMaxvalue){textT(".bank_span","转入金额超过单日最高金额，请重新输入");return}else{textT(".bank_span","")}}if(yMaxvalue!=null&&yMaxvalue!=""&&yMaxvalue!=undefined){if(zhuanru_money_text_val*1>yMaxvalue){textT(".bank_span","转入金额超过月最高金额");return}else{textT(".bank_span","")}}if(singleLimitvalue!=null&&singleLimitvalue!=""&&singleLimitvalue!=undefined){if(zhuanru_money_text_val*1<singleLimitvalue){textT(".bank_span","单笔最低金额必须大于"+(singleLimitvalue/100).toFixed(0)+"元");return}else{textT(".bank_span","")}}zhuangru_true=true}$_id("re_money_TYB").addEventListener("input",bank_text)}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}return};console.log("5企业理财申购预校验 入参："+JSON.stringify(params));Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.MEpt002,params,callback,null)}$_id("pay_soon").onclick=function(){PasswordKeyBoard.initPwdUI3(function(val){getapplyforBuySuccess(val)});PasswordKeyBoard.popKeyboardUI3()};function getapplyforBuySecretInterface(){zhuanru_money_text_val+="";if(!zhuanru_money_text_val){Toast.makeText("金额不能为空",LENGTHLONG);return}if(zhuangru_true!=true){return}var re_money_TYB=$_id("re_money_TYB").value+"";if(!re_money_TYB){Toast.makeText("金额不能为空",LENGTHLONG);return}$_id("txnAmountRuBankTYB").innerHTML=getThausand(fen2yuan(zhuanru_money_text_val),1);var confirmWorkDayStr=confirmWorkDay;var confirmWorkWeekStr=confirmWorkWeek;var year=confirmWorkDayStr.substring(0,4);var month=confirmWorkDayStr.substring(4,6);var day=confirmWorkDayStr.substring(confirmWorkDayStr.length-2);var week=confirmWorkWeekStr.substring(confirmWorkWeekStr.length-1);$_id("WorkDayAndWorkWeek").innerHTML=year+"-"+month+"-"+day+"(周"+week+")";PasswordKeyBoard.initPwdId("zhuanru_passWord");Utils.toNextPage("page_change_can_pay");App.setThresholdBtnIsVisable(false)}$_id("zhuanru_passWord").onclick=function(){PasswordKeyBoard.popPswKeyboard();PasswordKeyBoard.keyInputId="zhuanru_passWord"};function getapplyforBuySuccess(val){zhuanru_passWord=val;getRandom(COMEFROM.TYB,val)}function financialPurchase(random,val){var pwd=Security.encryptPassword(productNo,val,random);var params={merId:merId,channelCode:"20",bisChannel:bisChannel,tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,custCode:custCode,payPassword:pwd,txnAmount:zhuanru_money_text_val,txnType:"1",productId:productId,userId:userId};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){PasswordKeyBoard.hideKeyboardUI3();Utils.dismissDialog();console.log("企业理财申购 (TEpt004) 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){console.log("3.6企业理财申购 (TEpt004)出参===="+JSON.stringify(json));$_id("transSeq").innerHTML=json.transSeq;$_id("txnAmountZRU").innerHTML=$_id("txnAmountRuBankTYB").innerHTML;$_id("interestDate").innerHTML=json.interestDate+"("+json.interestWeek+")";Utils.toNextPage("page_zhuangrusuccess");document.title="充值成功";App.setTitle("充值成功")}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{if(json.code=="002135"){var back=function(){$("#ch_alert1").hide()};var back2=function(){App.exitApp()};Dialog.showAlertTwoBtnDialog("交易结果",json.content,"继续","取消",json.code,function(result){if(result=="1"){back()}else{back2()}})}else{if(json.code=="002136"){Dialog.showAlertDialog("提醒",json.content,"确定",json.code,function(){App.exitCompleteApp()})}else{if(json.code=="010054"){Dialog.showAlertDialog("提醒","登录失效","确定",json.code)}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}}}}return};console.log("企业理财申购 (TEpt004) 入参："+JSON.stringify(params));Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.TEpt004,params,callback,null)}function getThausand(s,type){if(/[^0-9\.]/.test(s)){return"0"}if(s==null||s==""){return"0"}s=s.toString().replace(/^(\d*)$/,"$1.");s=(s+"00").replace(/(\d*\.\d\d)\d*/,"$1");s=s.replace(".",",");var re=/(\d)(\d{3},)/;while(re.test(s)){s=s.replace(re,"$1,$2")}s=s.replace(/,(\d\d)$/,".$1");if(type==0){var a=s.split(".");if(a[1]=="00"){s=a[0]}}return s}function accountInformationInterface(){var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,bisChannel:bisChannel,custCode:custCode,productId:productId};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){Utils.dismissDialog();console.log("企业理财申购 (SEpt006) 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){userId=json.userId;balance=getThausand(fen2yuan(json.balance),1);confirmWorkDay=json.confirmWorkDay;confirmWorkWeek=json.confirmWorkWeek;purchaseAndVerification()}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}return};console.log("企业理财申购 (SEpt006) 入参："+JSON.stringify(params));Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.SEpt006,params,callback,null)}function handlingCharge(){var txnAmount=$_id("re_money_1").value;$_id("rechargeAcc").innerHTML=(txnAmount*1).toFixed(2);var params={staffCode:staffCode,channelCode:"20",custCode:custCode,bisChannel:bisChannel,merId:merId,tmnNum:tmnNum,keep:Utils.getKeep(),txnAmount:(txnAmount*100).toFixed(0),acctType:"0007"};Utils.getDeviceInfo(params);var sign=Security.getSign(params);console.log("sign---------------- = "+sign);params.sign=sign;params.signVer="2";console.log("账户手续费充值- params -------------->"+JSON.stringify(params));var callback=function(json){Utils.dismissDialog();console.log("账户手续费充值 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){$_id("fees").innerHTML=json.poundage/100;$_id("id_Handling_Charge").innerHTML=json.poundage/100;var chargeAmount=(json.txnAmount-json.poundage)/100;$_id("getAcc").innerHTML=chargeAmount.toFixed(2)}else{$_id("id_Handling_Charge").innerHTML="0"}};Utils.showDialog("请稍候...");Utils.sendPostRequest(URL+Method.SAcc009,params,callback,null)}function nextStepBtn(){$("#bankPwdLine").hide();$("#rechargeNo").hide();$_id("rechargeWay").innerHTML="银行账户";PasswordKeyBoard.initPwdId("paypwd");App.setThresholdBtnIsVisable(false);msgShowTime=30;$("#con_yan_zheng_ma").text("获取验证码");clearInterval(stopMsgVail);$("#msgVerifyCode").val("");$("#quickBankPrePhone").val("");$_id("confdel1").className="del";$_id("confdel2").className="del";$("#shouxuFees").hide();$("#toAccount").hide();Utils.toNextPage("rechargeConfirmPage");$_id("rechargeNow").onclick=rechargeNow}function rechargeNow(){console.log("-----------------交费易 bank------------------");var code=faZhiVailResult.chkCode;if(code=="3"){if(!Utils.phoneNumVail("quickBankPrePhone")){return}}if(code!="0"&&code!="4"){if($("#msgVerifyCode").val()==""||$("#msgVerifyCode").val().length!=6){Toast.makeText("请输入正确的验证码！",LENGTHLONG);return}}if(!submitOpen){return}PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.JFY,val)});PasswordKeyBoard.popKeyboardUI3()}var msgShowTime=30;$("#con_yan_zheng_ma").click(function(){getVailNo()});var stopMsgVail;function getVailNo(){var phoneNum;if(faZhiVailResult.bankMobile==null){if(!Utils.phoneNumVail("quickBankPrePhone",ERROR.openBankPhoneEmptyError)){return}phoneNum=$("#quickBankPrePhone").val()}else{phoneNum=faZhiVailResult.bankMobile}if(msgShowTime!=30){Toast.makeText("短信已下发，若30秒没收到，请重新点击获取！",LENGTHLONG);return}console.log("000000000000000000= "+phoneNum);clearInterval(stopMsgVail);var params={bisChannel:bisChannel,clientVersion:deviceInfo.clientVersion,sendType:6,staffCode:staffCode,custCode:custCode,phone:phoneNum,channelCode:"20",merId:merId,keep:Utils.getKeep(),serviceType:"PAYEAST_HTML5_BANK_RECHARGE",tmnNum:tmnNum};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var sendMsg_callback=function(JSONResult){Utils.dismissDialog();console.log("info:Method:Sreg003  出参： Result --> "+JSON.stringify(JSONResult));if(JSONResult.code==TOKENLOST){$("#con_yan_zheng_ma").text("获取验证码");clearInterval(stopMsgVail);msgShowTime=30;var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}});return}else{if(JSONResult.code!="000000"){Dialog.showAlertDialog("提醒",JSONResult.content,"确定",JSONResult.code);$("#con_yan_zheng_ma").text("获取验证码");clearInterval(stopMsgVail);msgShowTime=30;return}}Toast.makeText("验证码已成功下发到尾数为"+phoneNum.substring((phoneNum.length-4),phoneNum.length)+"的手机号码上！",LENGTHLONG);stopMsgVail=setInterval(function(){$("#con_yan_zheng_ma").text(msgShowTime+"秒");msgShowTime--;if(msgShowTime<0){$("#con_yan_zheng_ma").text("获取验证码");clearInterval(stopMsgVail);msgShowTime=30}},1000)};Utils.showDialog("获取短信中...");Utils.sendPostRequest(URL+"MSms001",params,sendMsg_callback,null)}function reChargeByBank(random,val){var pwd="";var txnAmount=$_id("rechargeAcc").innerHTML;pwd=Security.encryptPassword(productNo,val,random);var orderSeq=Utils.getOrderSeq();var params={bisChannel:bisChannel,merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,custCode:custCode,operType:"1",txnAmount:(txnAmount*100).toFixed(0),orderSeq:orderSeq,password:pwd,acctType:"0007"};console.log("faZhiVailResult.bankMobile===="+faZhiVailResult.bankMobile);console.log("faZhiVailResult.chkCode=========="+faZhiVailResult.chkCode+" ;typeof======"+typeof faZhiVailResult.chkCode);console.log("chkCode------------------>"+faZhiVailResult.chkCode);if(faZhiVailResult.chkCode=="3"){params.bankMobile=$("#quickBankPrePhone").val()}if(faZhiVailResult.chkCode=="1"||faZhiVailResult.chkCode=="2"||faZhiVailResult.chkCode=="3"){if(faZhiVailResult.chkCode=="1"||faZhiVailResult.chkCode=="2"){params.phone=faZhiVailResult.bankMobile}else{params.phone=$("#quickBankPrePhone").val()}var msgVerifyCodeVal=$("#msgVerifyCode").val();console.log("verifyCodeEncrypt1："+msgVerifyCodeVal);var Vcode=App.verifyCodeEncrypt(msgVerifyCodeVal);console.log("verifyCodeEncrypt2："+Vcode);params.verifyCode=Vcode;params.serviceType="PAYEAST_HTML5_BANK_RECHARGE"}Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){PasswordKeyBoard.hideKeyboardUI3();Utils.dismissDialog();console.log("银行账户充值 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");submitOpen=true;return}if(json.code=="000000"){var handleAmount;if(!json.handleAmount){handleAmount=json.tradeAmount-json.tradeAmount;handleAmount=(handleAmount/100).toFixed(2)}else{handleAmount=(json.handleAmount/100).toFixed(2)}$_id("orderNumber").innerHTML=json.transSeq;$_id("toTheAccount").innerHTML=(json.txnAmount/100).toFixed(2);$_id("tradeMoney").innerHTML=(json.tradeAmount/100).toFixed(2);$_id("handingCharge").innerHTML=handleAmount;Utils.toNextPage("rechargeSuccessPage");document.title="充值成功";App.setTitle("充值成功");console.log("hadEpt==ABC=="+hadEpt);console.log("regType==ABC=="+regType);console.log("productType=="+productType);if(hadEpt=="0"&&(regType=="0"||regType=="-1")&&productType!="3"){$("#kaotong_tianyibao").show()}else{$("#kaotong_tianyibao").hide()}$("#btnContinue").click(function(){$("#rechargeSuccessPage").hide();hiddenDelBtns();console.log("Utils.pageIds====================="+JSON.stringify(Utils.pageIds));Utils.back();console.log("Utils.pageIds====================="+JSON.stringify(Utils.pageIds));$("#re_money_1").val("");$("#paypwd").val("");getAccount()});$("#btnBack").click(function(){App.exitApp()})}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}});submitOpen=true}else{if(json.code=="002135"){var back=function(){$_id("rechargeNow").onclick=rechargeNow;$("#ch_alert1").hide()};var back2=function(){App.exitApp()};Dialog.showAlertTwoBtnDialog("交易结果",json.content,"继续","取消",json.code,function(result){if(result=="1"){back()}else{back2()}});submitOpen=true}else{if(json.code=="002136"){Dialog.showAlertDialog("提醒",json.content,"确定",json.code,function(){App.exitCompleteApp()});submitOpen=true}else{if(json.code=="010054"){Dialog.showAlertDialog("提醒","登录失效","确定",json.code);submitOpen=true}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code);submitOpen=true}}}}}};console.log("银行账户充值 入参："+JSON.stringify(params));Utils.sendPostRequest(URL+Method.TAcc002,params,callback,null)}function getAccount(){var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,custCode:custCode,bisChannel:bisChannel,bankMode:"BT1001"};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){console.log("账户余额 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){var list=json.accountItems;for(var i=0;i<list.length;i++){var acct=list[i]["acctType"];if(acct!=null||acct!="null"||acct!="undefined"||acct!=""){if("0007"==acct){var balance=list[i].balance;$_id("accountYue").innerHTML=(balance/100).toFixed(2);break}}else{$_id("accountYue").innerHTML="暂无查询到余额"}}}else{if(json.code==TOKENLOST){Utils.dismissDialog();var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Utils.dismissDialog();$_id("accountYue").innerHTML="暂无查询到余额"}}getBindCardState(COMEFROM.JFY)};console.log("账户余额 入参："+JSON.stringify(params));Utils.showDialog("请稍等..");Utils.sendPostRequest(URL+Method.SAcc003,params,callback,null)}function getUserInfo(from){var params={staffCode:staffCode,channelCode:"20",custCode:custCode,merId:merId,tmnNum:tmnNum,bisChannel:bisChannel,keep:Utils.getKeep()};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";console.log("账户信息查询接口 入参："+JSON.stringify((params)));var callback=function(json){Utils.dismissDialog();console.log("账户信息查询接口 出参： Result --> "+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){if(from==COMEFROM.JFY){console.log("交费易绑卡-----------》from = "+COMEFROM.JFY)}else{if(from==COMEFROM.ZJ){console.log("资金归集绑卡-----------》from = "+COMEFROM.ZJ)}else{console.log("------------------解绑流程----------------");set1=json.authenStatus;if(set1=="A02"||set1=="A03"){PasswordKeyBoard.initPwdId("passwordPlaceholder");hiddenDelBtns();$("#bankLogo1").attr("src",$("#bankLogo").attr("src"));$("#bankName1").html($("#bankName").html());$("#bankCardNo1").html($("#bankCardNo").html());$("#userName1").html($("#userName").html());App.setThresholdBtnIsVisable(false);if(prinType=="PT901"){Toast.makeText("代理商信息修改请联系代理商Q群312912075.",LENGTHLONG);return}Utils.toNextPage("unbundling")}else{var back=function(){Utils.back()};Dialog.showAlertDialog("提醒","体验商户不支持解绑功能！","确定","",function(){back()})}return}}if(json.authenStatus=="A01"){if(prinType=="PT901"){RZPassWordType="A01";PasswordKeyBoard.initPwdId("paypwdRenZheng");$("#paypwdRenZheng").val("");PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3();console.log("认证");return}var cb=function(result){if(result=="1"){RZPassWordType="A01";PasswordKeyBoard.initPwdId("paypwdRenZheng");$("#paypwdRenZheng").val("");PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3();console.log("认证");return}};Dialog.showAlertTwoBtnDialog("您好",ERROR.authState1,"立即认证","返回","",cb)}else{if(json.authenStatus=="A02"||json.authenStatus=="A03"){RZPassWordType="A02";PasswordKeyBoard.initPwdId("paypwdRenZheng");$("#paypwdRenZheng").val("");PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.RZ,val)});PasswordKeyBoard.popKeyboardUI3()}else{if(json.authenStatus=="A99"){Dialog.showAlertDialog("提醒",ERROR.authState3,"确定","")}else{if(json.authenStatus=="A00"){Dialog.showAlertDialog("提醒",ERROR.authState2,"确定","")}else{console.log("666666");Dialog.showAlertDialog("提醒","您当前认证状态为认证中，暂不能绑卡，请联系客服解除认证状态。","确定","")}}}}}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}};Utils.showDialog("请稍等..");Utils.sendPostRequest(URL+Method.SAcc001,params,callback,null)}function loadToNewUrl(from){if(from=="Auth"){App.jumpToNewH5View(RZ_Url)}else{if(from=="bindBank"){App.jumpToNewH5View(BK_URl)}}}$("#sure_unbundling").click(function(){if(hadEpt=="1"){Dialog.showAlertDialog("提醒","已开通添益宝无法解绑","确定","");return}PasswordKeyBoard.initPwdUI3(function(val){getRandom(COMEFROM.JB,val)});PasswordKeyBoard.popKeyboardUI3()});function getRandom(from,JSONResult1){submitOpen=false;var callback=function(json){Utils.dismissDialog();submitOpen=true;console.log("获取随机数 出参："+JSON.stringify(json));if(json.code=="000000"){var random=json.randNum;if(COMEFROM.ZJ==from){zijRecharge(random)}else{if(COMEFROM.JFY==from){$_id("rechargeNow").onclick=function(){};reChargeByBank(random,JSONResult1)}else{if(COMEFROM.TYB==from){financialPurchase(random,JSONResult1)}else{if(COMEFROM.ReC==from){reChargeByCard(random)}else{if(COMEFROM.JB==from){setTInfo(random,JSONResult1)}else{if(COMEFROM.RZ==from){Utils.showDialog("请稍候...");var pwsMD=Security.encryptPassword(productNo,JSONResult1,random);pswVail(pwsMD)}else{if(COMEFROM.AF==from){addFaZhi(random,JSONResult1)}else{if(COMEFROM.CF==from){closeFaZhi(random,JSONResult1)}}}}}}}}}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}};console.log("获取随机数 入参："+JSON.stringify(Utils.getRandomParams()));var Params=Utils.getRandomParams();Params.signType="RSA";Utils.showDialog("请稍等....");Utils.sendPostRequest(URL+Method.MRdcMake,Params,callback,null)}function reChargeByCard(random){var cardNo=$_id("cardNo").value;var cardPwd=$_id("cardPwd").value;cardPwd=Security.encryptPassword(productNo,cardPwd,random);var txnAmount=$_id("rechargeAcc").innerHTML;var getAcc=$_id("getAcc").innerHTML;var orderSeq=Utils.getOrderSeq();var params={merId:merId,bisChannel:bisChannel,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,custCode:custCode,txnAmount:(txnAmount*100).toFixed(0),orderSeq:orderSeq,payPassword:cardPwd,cardNo:cardNo,sPayAmount:(getAcc*100).toFixed(0)};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){Utils.dismissDialog();console.log("翼充卡充值 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){if(json.transseq!="undefined"||json.transseq!=undefined){Dialog.showAlertDialog("提醒","交易处理中，为避免损失，请到收支查询确认","确定","",function(){App.exitApp()});return}$_id("orderNumber").innerHTML=json.transseq;$_id("tradeMoney").innerHTML=(json.txnAmount/100).toFixed(2);$_id("toTheAccount").innerHTML=(json.sPayAmount/100).toFixed(2);$_id("handingCharge").innerHTML=((json.txnAmount-json.sPayAmount)/100).toFixed(2);console.log("hadEpt==ABC=="+hadEpt);console.log("regType==ABC=="+regType);console.log("productType=="+productType);if(hadEpt=="0"&&(regType=="0"||regType=="-1")&&productType!="3"){$("#kaotong_tianyibao").show()}else{$("#kaotong_tianyibao").hide()}Utils.toNextPage("rechargeSuccessPage");$("#btnContinue").click(function(){$("#rechargeSuccessPage").hide();App.setThresholdBtnIsVisable(false);hiddenDelBtns();Utils.back();$("#cardNo").val("");$("#cardPwd").val("");$("#re_money_2").val("");getAccount()});$("#btnBack").click(function(){App.exitApp()})}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}};console.log("翼充卡充值 入参："+JSON.stringify(params));Utils.showDialog("请稍等..");Utils.sendPostRequest(URL+Method.TCard002,params,callback,null)}function appreciationQuery(){var account=$_id("re_money_2").value;var cardNo=$_id("cardNo").value;var cardPwd=$_id("cardPwd").value;console.log("cardNo.length = "+cardNo.length);console.log("cardNo.length = "+(cardNo.length!=16));console.log("cardNo.length = "+(cardNo.length!=12));if(cardNo.length!=16&&cardNo.length!=12){Toast.makeText(ERROR.cardNoError,LENGTHLONG);return}if(cardPwd.length<6){Toast.makeText(ERROR.cardPwdError,LENGTHLONG);return}if(!Utils.isNumber(account,1000,1)){Toast.makeText(ERROR.moneyError1,LENGTHLONG);return}var params={merId:merId,channelCode:"20",tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,bisChannel:bisChannel,custCode:custCode,actionCode:"18010209",prodCode:"2004",faceAmount:(account*100).toFixed(0)};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";var callback=function(json){Utils.dismissDialog();console.log("溢价查询 出参："+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){var m=$_id("re_money_2").value;$_id("rechargeAcc").innerHTML=(m*1).toFixed(2);$("#rechargeNo").show();$("#rechCardNo").html($("#cardNo").val());$("#bankPwdLine").hide();$("#faZhiPhone").hide();$("#faZhiMsm").css("display","none");$_id("rechargeWay").innerHTML="翼支付卡";$_id("getAcc").innerHTML=(m-(concession/100).toFixed(2)).toFixed(2);App.setThresholdBtnIsVisable(false);$("#shouxuFees").show();$("#toAccount").show();Utils.toNextPage("rechargeConfirmPage");$_id("rechargeNow").onclick=function(){getRandom(COMEFROM.ReC)}}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{Dialog.showAlertDialog("提醒",json.content,"确定",json.code)}}};console.log("溢价查询 入参："+JSON.stringify(params));Utils.showDialog("请稍等..");Utils.sendPostRequest(URL+Method.SPrm001,params,callback,null)}function zijRecharge(random){var money=$_id("re_money_3").value;var pwd=PasswordKeyBoard.keyStr;pwd=Security.encryptPassword(productNo,pwd,random);Utils.showDialog("请稍候...");sendPetTypes(pwd,money)}function setT(){getUserInfo()}function setTInfo(random,val){var pwd=Security.encryptPassword(productNo,val,random);var params={merId:merId,channelCode:"20",bisChannel:bisChannel,tmnNum:tmnNum,keep:Utils.getKeep(),staffCode:staffCode,custCode:custCode,payPassWord:pwd,accId:accId};Utils.getDeviceInfo(params);var sign=Security.getSign(params);params.sign=sign;params.signVer="2";console.log("解绑 入参："+JSON.stringify((params)));var callback=function(json){PasswordKeyBoard.hideKeyboardUI3();$_id("unlockDelBtn").className="del";PasswordKeyBoard.initPwdId("passwordPlaceholder");Utils.dismissDialog();console.log("解绑接口 出参： Result --> "+JSON.stringify(json));if(json=="null"||json==null||json==""){Dialog.showAlertDialog("提醒",ERROR.fail,"确定","");return}if(json.code=="000000"){App.updateUserInfo("0");Dialog.showAlertDialog("提醒","您成功解绑了尾号为"+$_id("bankCardNo1").innerHTML+"的银行卡！","确定","",function(){App.exitApp()})}else{if(json.code==TOKENLOST){var back=function(){User.login(productNo)};var back2=function(){App.exitCompleteApp()};Dialog.showAlertTwoBtnDialog("登录失效",ERROR.tokenLost,"确定","取消","",function(result){if(result=="1"){back()}else{back2()}})}else{if(json.code=="020004"){Dialog.showAlertDialog("提醒",json.content,"确定",json.code,function(){App.exitCompleteApp()})}else{var back=function(){$("#ch_alert1").hide();hiddenDelBtns();PasswordKeyBoard.initPwdId("passwordPlaceholder")};var back2=function(){Utils.back()};Dialog.showAlertTwoBtnDialog("解绑失败",json.content,"确定","返回",json.code,function(result){if(result=="1"){back()}else{back2()}})}}}};Utils.showDialog("请稍等..");Utils.sendPostRequest(URL+Method.MBinCrd005,params,callback,null)}function hasOrNoBankChange(id1,id2){$_id(id1).style.display="none";$_id(id2).style.display="block"}function createXML(pwd,money){var keep=Utils.getKeep();var requesttime=Utils.getTime();var alltime=Utils.getOrderSeq();var token=info.tokenCode;var zjMerId=info.prtnCode;var params={ACCTTYPE:"0001",AGENTCODE:productNo,OPERTYPE:"1",KEEP:keep,ORDERSEQ:alltime,REQUESTTIME:requesttime,PASSWORD:pwd,STAFFCODE:productNo,TXNAMOUNT:(money*100).toFixed(0),KEY:token,WEBSVRNAME:"账户管理接口",WEBSVRCODE:"01_004"};var sign=Security.getSignINF(params);var xml='<?xml version="1.0" encoding="utf-8"?><soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:impl="http://impl.websvc"><soapenv:Header/><soapenv:Body> <impl:dispatchCommandEXT soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><in0 xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xs="http://www.w3.org/2000/XMLSchema-instance" xsi:type="soapenc:string" xs:type="type:string">01_004|440000-BestPayEEClient_V2.9.2-292-127.0.0.1|292|127.0.0.1|</in0><in1 xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xs="http://www.w3.org/2000/XMLSchema-instance" xsi:type="soapenc:string" xs:type="type:string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?><Request><VerifyParameter><CER></CER><CHANNELCODE>20</CHANNELCODE><MERID>'+zjMerId+"</MERID><SIGN>"+sign+"</SIGN><TMNNUM>"+zjTmnNum+'</TMNNUM></VerifyParameter><PayPlatRequestParameter><CTRL-INFO APPFROM="440000-BestPayEEClient_V2.9.2-292-127.0.0.1" KEEP="'+keep+'" REQUESTTIME="'+requesttime+'" WEBSVRCODE="01_004" WEBSVRNAME="账户管理接口"/><PARAMETERS><ACCTTYPE>0001</ACCTTYPE><AGENTCODE>'+productNo+"</AGENTCODE><OPERTYPE>1</OPERTYPE><ORDERSEQ>"+alltime+"</ORDERSEQ><PASSWORD>"+pwd+"</PASSWORD><STAFFCODE>"+productNo+"</STAFFCODE><TXNAMOUNT>"+(money*100).toFixed(0)+'</TXNAMOUNT></PARAMETERS></PayPlatRequestParameter></Request>]]></in1></impl:dispatchCommandEXT><in0 xmlns:xs="http://www.w3.org/2000/XMLSchema-instance" xs:type="type:string"></in0><in1 xmlns:xs="http://www.w3.org/2000/XMLSchema-instance" xs:type="type:string"></in1></soapenv:Body></soapenv:Envelope>';return xml}function sendPetTypes(pwd,money){var xml=createXML(pwd,money);console.log("xml params------------------------>"+xml);var url=ZjUrl;var callback=function(xml){Utils.dismissDialog();xml=xml.replace(/&lt;/g,"<").replace(/&gt;/g,">");console.log("xml------------------------>"+xml);var responsecode=xml.substring(xml.indexOf("<RESPONSECODE>")+14,xml.indexOf("</RESPONSECODE>"));var responsecontent=xml.substring(xml.indexOf("<RESPONSECONTENT>")+17,xml.indexOf("</RESPONSECONTENT>"));responsecontent=eval("'"+responsecontent.replace(/&#x/g,"\\u").replace(/\;/g,"")+"'");responsecontent=unescape(responsecontent.replace(/\\u/g,"%u"));if(responsecode=="000000"){var transseq=xml.substring(xml.indexOf("<TRANSSEQ>")+10,xml.indexOf("</TRANSSEQ>"));var txnamount=xml.substring(xml.indexOf("<TXNAMOUNT>")+11,xml.indexOf("</TXNAMOUNT>"));var tradeamount=xml.substring(xml.indexOf("<TRADEAMOUNT>")+13,xml.indexOf("</TRADEAMOUNT>"));var shouxu=txnamount-tradeamount;console.log("txnamount----------------->"+txnamount);console.log("transseq----------------->"+transseq);console.log("shouxu----------------->"+shouxu);$_id("orderNumber").innerHTML=transseq;$_id("tradeMoney").innerHTML=(tradeamount/100).toFixed(2);$_id("toTheAccount").innerHTML=(txnamount/100).toFixed(2);$_id("handingCharge").innerHTML=(shouxu/100).toFixed(2);$("#zijRchargePage").hide();$("#rechargeSuccessPage").show();$("#btnContinue").click(function(){$("#rechargeSuccessPage").hide();hiddenDelBtns();PasswordKeyBoard.initPwdId("zijpwd");$("#re_money_3").val("")});$("#btnBack").click(function(){App.exitApp()})}else{Dialog.showAlertDialog("提醒",responsecontent,"确定",responsecode)}};Utils.sendPostXmlRequest(url+"bppf_inf/services/DealProcessor",xml,callback,null)}});